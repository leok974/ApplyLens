# v0.4.22 Production Testing Guide
## Running Smoke Tests Against applylens.app

**Created**: October 24, 2025
**Version**: v0.4.22

---

## Quick Start

```bash
cd d:\ApplyLens\apps\web

# Run production-safe smoke tests
npm run test:prod-safe
```

This will:
- Test against https://applylens.app
- Validate v0.4.22 features (tooltip, filters, scores)
- Only perform safe read operations
- Take ~5 seconds to complete

---

## What Gets Tested

### 1. ✅ Search Page Loads
- Search input renders
- Filter section visible
- Results header shows
- At least one result present
- Scoring pill visible

### 2. ✅ Tooltip (v0.4.22 Feature)
- Scoring pill tooltip appears on hover
- Contains boost/recency/scale info
- TooltipProvider fix validated

### 3. ✅ Active Filters (v0.4.22 Feature)
- Filter buttons highlight when clicked
- Active filters summary bar appears
- "Clear all" button visible
- Visual feedback working

### 4. ✅ Score Display (v0.4.22 Feature)
- Scores shown only when > 0
- No `score: 0` clutter
- Format is correct

---

## Safety Guarantees

All tests are tagged `@prodSafe`:

- ✅ Only GET requests (no mutations)
- ✅ No sync/import clicks
- ✅ No data modifications
- ✅ Client-side interactions only
- ✅ Generic assertions (works with any dataset)
- ✅ No personal data screenshots

---

## Expected Output

```
Running 4 tests using 1 worker

  ✓  search page loads and shows results list (1.2s)
  ✓  tooltip appears on scoring pill (850ms)
  ✓  active filters show visual feedback (920ms)
  ✓  scores are displayed correctly (780ms)

  4 passed (4.2s)
```

---

## Alternative Commands

### Run with manual environment variable

**PowerShell**:
```powershell
$env:E2E_BASE_URL="https://applylens.app"
npx playwright test tests/e2e/prod-search-smoke.spec.ts --reporter=list
```

**Bash**:
```bash
E2E_BASE_URL=https://applylens.app npx playwright test tests/e2e/prod-search-smoke.spec.ts --reporter=list
```

### Run all @prodSafe tests

```bash
npm run test:e2e:prod
```

### Debug mode (headed browser)

```bash
$env:E2E_BASE_URL="https://applylens.app"
npx playwright test tests/e2e/prod-search-smoke.spec.ts --headed
```

---

## Troubleshooting

### Issue: Test times out

**Cause**: Production might be slow or down

**Solution**: Check https://applylens.app manually, or run in headed mode:
```bash
npm run test:prod-safe -- --headed
```

### Issue: Authentication error

**Cause**: Missing or expired production cookies

**Solution**: Log in to production manually and ensure session is active

### Issue: Elements not found

**Cause**: Selectors changed or feature broken

**Solution**: Run in headed mode to see what's happening, check if production is on correct version

---

## Post-Deployment Workflow

After deploying v0.4.22 (or any version):

```bash
# 1. Deploy to production
docker-compose -f docker-compose.prod.yml up -d --force-recreate --no-deps web

# 2. Wait 30 seconds for container to be healthy
Start-Sleep -Seconds 30

# 3. Run production smoke tests
cd apps\web
npm run test:prod-safe

# 4. Check results
# ✅ All passing = deployment successful
# ❌ Any failures = investigate/rollback
```

---

## Files Created

1. ✅ `tests/e2e/prod-search-smoke.spec.ts` - Test suite
2. ✅ `playwright.config.ts` - Updated with prod-search-smoke in testMatch
3. ✅ `package.json` - Added `test:prod-safe` script
4. ✅ `docs/v0.4.22-production-testing.md` - This guide

---

## Summary

**Command**: `npm run test:prod-safe`

**Tests**: 4 smoke tests for v0.4.22 features

**Duration**: ~5 seconds

**Safety**: 100% read-only, no mutations

**Status**: ✅ Ready to use

---

**Created**: October 24, 2025
**Version**: v0.4.22
**Safe for Production**: YES ✓
