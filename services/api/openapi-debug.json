{
  "openapi": "3.1.0",
  "info": {
    "title": "ApplyLens API",
    "version": "0.1.0"
  },
  "paths": {
    "/metrics": {
      "get": {
        "tags": [
          "metrics"
        ],
        "summary": "Metrics",
        "description": "Prometheus metrics endpoint for backfill health.\n\nReturns metrics in Prometheus exposition format.\nRefreshes metrics on every scrape (lazy refresh).\n\nExample response:\n    # HELP bills_missing_dates Bills missing dates[] field\n    # TYPE bills_missing_dates gauge\n    bills_missing_dates 0.0\n    # HELP bills_with_dates Bills with dates[] populated\n    # TYPE bills_with_dates gauge\n    bills_with_dates 1243.0\n    ...",
        "operationId": "metrics_metrics_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        }
      }
    },
    "/config": {
      "get": {
        "summary": "Get Runtime Config",
        "description": "Get runtime configuration for frontend feature flags.\n\nReturns:\n    - readOnly: Whether destructive actions (mute/delete/archive) are disabled\n    - version: Current API version (e.g., \"v0.4.35\")",
        "operationId": "get_runtime_config_config_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        }
      }
    },
    "/healthz": {
      "get": {
        "tags": [
          "health"
        ],
        "summary": "Healthz",
        "description": "Liveness probe - basic health check.\n\nReturns 200 if the application is running.\nThis should NOT check external dependencies.",
        "operationId": "healthz_healthz_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        }
      }
    },
    "/live": {
      "get": {
        "tags": [
          "health"
        ],
        "summary": "Live",
        "description": "Alias for liveness probe (alternative naming convention).",
        "operationId": "live_live_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        }
      }
    },
    "/ready": {
      "get": {
        "tags": [
          "health"
        ],
        "summary": "Ready",
        "description": "Readiness probe - checks if app can serve traffic.\n\nVerifies:\n- Database connectivity\n- Elasticsearch connectivity\n- Current migration version\n\nNEVER returns 5xx - always returns 200 with structured state.\nThis prevents frontend reload loops on 502/503 errors.\n\nReturns 200 with {\"status\": \"ready\"} if ready,\nor 200 with {\"status\": \"degraded\", \"errors\": [...]} if dependencies are down.",
        "operationId": "ready_ready_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        }
      }
    },
    "/status": {
      "get": {
        "tags": [
          "health"
        ],
        "summary": "Status",
        "description": "Application status endpoint (alias for /ready with simpler response).\n\nNEVER returns 5xx - always returns 200 with structured state.\nThis prevents frontend reload loops on 502/503 errors.\n\nReturns:\n    - {\"ok\": true, \"gmail\": \"ok\"} when healthy\n    - {\"ok\": false, \"gmail\": \"degraded\", \"message\": \"...\"} when degraded",
        "operationId": "status_status_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        }
      }
    },
    "/metrics/health": {
      "get": {
        "tags": [
          "metrics"
        ],
        "summary": "Metrics Health",
        "description": "Health check for metrics system.\n\nReturns 200 if metrics exporter is functioning.",
        "operationId": "metrics_health_metrics_health_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        }
      }
    },
    "/debug/500": {
      "get": {
        "summary": "Debug 500",
        "description": "Debug endpoint to test 5xx error alerting (dev/testing only)",
        "operationId": "debug_500_debug_500_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        }
      }
    },
    "/api/dev/seed-threads-simple": {
      "post": {
        "tags": [
          "dev"
        ],
        "summary": "Seed Threads Simple",
        "description": "Simplified seed endpoint that generates N threads with realistic job-search content.\n\nSecurity:\n- Only available when ALLOW_DEV_ROUTES=1 environment variable is set.\n- Requires authenticated user.",
        "operationId": "seed_threads_simple_api_dev_seed_threads_simple_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/SeedCountRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SeedResult"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/api/dev/seed-threads": {
      "post": {
        "tags": [
          "dev"
        ],
        "summary": "Seed Threads",
        "description": "Insert mock thread rows for E2E tests so /inbox isn't empty.\n\nRequirements:\n- DOES NOT send real Gmail calls.\n- Writes to the same backing store the Inbox page queries (Postgres+ES doc, whatever you're listing in Inbox).\n- Safe to call repeatedly; either upsert, or just overwrite in-memory cache if you're faking it.\n\nSecurity:\n- Only available when ALLOW_DEV_ROUTES=1 environment variable is set.\n- Requires authenticated user.",
        "operationId": "seed_threads_api_dev_seed_threads_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "items": {
                  "$ref": "#/components/schemas/SeedThread"
                },
                "type": "array",
                "title": "Threads"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SeedResult"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/security/rescan": {
      "post": {
        "tags": [
          "security",
          "dev"
        ],
        "summary": "Rescan Risk",
        "description": "Dev stub for email risk rescanning - returns mock data for testing",
        "operationId": "rescan_risk_security_rescan_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/RiskRescanRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/RiskResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/security/emails/{email_id}/risk": {
      "get": {
        "tags": [
          "security",
          "dev"
        ],
        "summary": "Get Email Risk",
        "description": "Dev stub for getting email risk assessment (legacy /security/emails path)",
        "operationId": "get_email_risk_security_emails__email_id__risk_get",
        "parameters": [
          {
            "name": "email_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "title": "Email Id"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/RiskResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/emails/{email_id}/risk-advice": {
      "get": {
        "tags": [
          "emails"
        ],
        "summary": "Get Risk Advice",
        "description": "Get suspicious email risk assessment with actionable guidance.\n\nReturns phishing detection scores, explanations, and agentic verification steps\ncomputed by the applylens_emails_v3 ingest pipeline.\n\nArgs:\n    email_id: Email document ID\n    index: Optional index name (defaults to 'gmail_emails' alias)",
        "operationId": "get_risk_advice_emails__email_id__risk_advice_get",
        "parameters": [
          {
            "name": "email_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "title": "Email Id"
            }
          },
          {
            "name": "index",
            "in": "query",
            "required": false,
            "schema": {
              "anyOf": [
                {
                  "type": "string"
                },
                {
                  "type": "null"
                }
              ],
              "title": "Index"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/emails/{email_id}/risk-feedback": {
      "post": {
        "tags": [
          "emails"
        ],
        "summary": "Risk Feedback",
        "description": "Submit user feedback on email risk assessment for training and refinement.\n\nBody: { verdict: \"scam\"|\"legit\"|\"unsure\", note?: str }\n\n- Updates email labels in Elasticsearch\n- Increments Prometheus metrics: applylens_email_risk_feedback_total{verdict=...}\n- Helps improve phishing detection heuristics over time",
        "operationId": "risk_feedback_emails__email_id__risk_feedback_post",
        "parameters": [
          {
            "name": "email_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "title": "Email Id"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "additionalProperties": true,
                "title": "Body"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/gmail/backfill/start": {
      "post": {
        "tags": [
          "gmail"
        ],
        "summary": "Start Backfill",
        "description": "Start async Gmail backfill job.\n\nReturns immediately with job_id. Use /status to poll for completion.",
        "operationId": "start_backfill_gmail_backfill_start_post",
        "parameters": [
          {
            "name": "days",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "maximum": 365,
              "minimum": 1,
              "default": 60,
              "title": "Days"
            }
          },
          {
            "name": "user_email",
            "in": "query",
            "required": false,
            "schema": {
              "anyOf": [
                {
                  "type": "string"
                },
                {
                  "type": "null"
                }
              ],
              "title": "User Email"
            }
          }
        ],
        "responses": {
          "202": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/StartResp"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/gmail/backfill/status": {
      "get": {
        "tags": [
          "gmail"
        ],
        "summary": "Get Status",
        "description": "Get job status and progress.\n\nStates:\n- queued: Job is waiting to start\n- running: Job is currently executing\n- done: Job completed successfully\n- error: Job failed with error\n- canceled: Job was canceled by user",
        "operationId": "get_status_gmail_backfill_status_get",
        "parameters": [
          {
            "name": "job_id",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string",
              "description": "Job ID from /start",
              "title": "Job Id"
            },
            "description": "Job ID from /start"
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/StatusResp"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/emails/": {
      "get": {
        "tags": [
          "emails"
        ],
        "summary": "List Emails",
        "description": "List emails for the current user, newest first.",
        "operationId": "list_emails_emails__get",
        "parameters": [
          {
            "name": "limit",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "maximum": 500,
              "minimum": 1,
              "description": "Maximum number of emails to return",
              "default": 50,
              "title": "Limit"
            },
            "description": "Maximum number of emails to return"
          },
          {
            "name": "offset",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "minimum": 0,
              "description": "Number of emails to skip",
              "default": 0,
              "title": "Offset"
            },
            "description": "Number of emails to skip"
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/EmailOut"
                  },
                  "title": "Response List Emails Emails  Get"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/emails/{email_id}/prime-advice": {
      "post": {
        "tags": [
          "emails"
        ],
        "summary": "Prime Advice",
        "description": "Prime risk advice cache for instant UI loading (agentic nudge).\n\nFire-and-forget endpoint to pre-compute risk advice for high-risk emails.\nCan be called from UI after message open or via scheduled cron sweep.\n\nArgs:\n    email_id: Email document ID\n    index: Optional index name (defaults to 'gmail_emails' alias)\n    background_tasks: FastAPI background tasks",
        "operationId": "prime_advice_emails__email_id__prime_advice_post",
        "parameters": [
          {
            "name": "email_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "title": "Email Id"
            }
          },
          {
            "name": "index",
            "in": "query",
            "required": false,
            "schema": {
              "anyOf": [
                {
                  "type": "string"
                },
                {
                  "type": "null"
                }
              ],
              "title": "Index"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/emails/risk/summary-24h": {
      "get": {
        "tags": [
          "emails"
        ],
        "summary": "Risk Summary 24H",
        "description": "Get 24-hour risk summary for dashboards/monitoring.\n\nReturns:\n- high: count of emails with suspicion_score >= 40\n- warn: count of emails with 25 <= suspicion_score < 40\n- low: count of emails with suspicion_score < 25\n- top_reasons: top 5 phishing signals detected\n\nUseful for Grafana JSON datasource panels, Kibana Canvas, or CLI monitoring.",
        "operationId": "risk_summary_24h_emails_risk_summary_24h_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        }
      }
    },
    "/search/": {
      "get": {
        "tags": [
          "search"
        ],
        "summary": "Search",
        "description": "Smart search with:\n- Multi-user support (always scoped to current user)\n- ATS synonym expansion (Lever, Workday, SmartRecruiters, Greenhouse)\n- Label boost scoring (offer^4, interview^3, rejection^0.5)\n- 7-day recency decay (Gaussian)\n- Field boosting (subject^3, sender^1.5)\n- Phrase + prefix matching",
        "operationId": "search_search__get",
        "parameters": [
          {
            "name": "q",
            "in": "query",
            "required": false,
            "schema": {
              "anyOf": [
                {
                  "type": "string"
                },
                {
                  "type": "null"
                }
              ],
              "description": "Search query (defaults to '*' for match_all)",
              "title": "Q"
            },
            "description": "Search query (defaults to '*' for match_all)"
          },
          {
            "name": "size",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "maximum": 100,
              "minimum": 1,
              "description": "Number of results",
              "default": 25,
              "title": "Size"
            },
            "description": "Number of results"
          },
          {
            "name": "scale",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string",
              "description": "Recency scale: 3d|7d|14d",
              "default": "7d",
              "title": "Scale"
            },
            "description": "Recency scale: 3d|7d|14d"
          },
          {
            "name": "labels",
            "in": "query",
            "required": false,
            "schema": {
              "anyOf": [
                {
                  "type": "array",
                  "items": {
                    "type": "string"
                  }
                },
                {
                  "type": "null"
                }
              ],
              "description": "Filter by labels (repeatable)",
              "title": "Labels"
            },
            "description": "Filter by labels (repeatable)"
          },
          {
            "name": "date_from",
            "in": "query",
            "required": false,
            "schema": {
              "anyOf": [
                {
                  "type": "string"
                },
                {
                  "type": "null"
                }
              ],
              "description": "ISO date/time (e.g. 2025-10-01 or 2025-10-01T00:00:00Z)",
              "title": "Date From"
            },
            "description": "ISO date/time (e.g. 2025-10-01 or 2025-10-01T00:00:00Z)"
          },
          {
            "name": "date_to",
            "in": "query",
            "required": false,
            "schema": {
              "anyOf": [
                {
                  "type": "string"
                },
                {
                  "type": "null"
                }
              ],
              "description": "ISO date/time",
              "title": "Date To"
            },
            "description": "ISO date/time"
          },
          {
            "name": "replied",
            "in": "query",
            "required": false,
            "schema": {
              "anyOf": [
                {
                  "type": "boolean"
                },
                {
                  "type": "null"
                }
              ],
              "description": "Filter replied threads: true|false",
              "title": "Replied"
            },
            "description": "Filter replied threads: true|false"
          },
          {
            "name": "sort",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string",
              "description": "relevance|received_desc|received_asc|ttr_asc|ttr_desc",
              "default": "relevance",
              "title": "Sort"
            },
            "description": "relevance|received_desc|received_asc|ttr_asc|ttr_desc"
          },
          {
            "name": "label_filter",
            "in": "query",
            "required": false,
            "schema": {
              "anyOf": [
                {
                  "type": "string"
                },
                {
                  "type": "null"
                }
              ],
              "description": "Filter by label_heuristics: interview, offer, rejection, application_receipt, newsletter_ads",
              "title": "Label Filter"
            },
            "description": "Filter by label_heuristics: interview, offer, rejection, application_receipt, newsletter_ads"
          },
          {
            "name": "company",
            "in": "query",
            "required": false,
            "schema": {
              "anyOf": [
                {
                  "type": "string"
                },
                {
                  "type": "null"
                }
              ],
              "description": "Filter by company name",
              "title": "Company"
            },
            "description": "Filter by company name"
          },
          {
            "name": "source",
            "in": "query",
            "required": false,
            "schema": {
              "anyOf": [
                {
                  "type": "string"
                },
                {
                  "type": "null"
                }
              ],
              "description": "Filter by source (e.g., lever, workday)",
              "title": "Source"
            },
            "description": "Filter by source (e.g., lever, workday)"
          },
          {
            "name": "categories",
            "in": "query",
            "required": false,
            "schema": {
              "anyOf": [
                {
                  "type": "array",
                  "items": {
                    "type": "string"
                  }
                },
                {
                  "type": "null"
                }
              ],
              "description": "Filter by ML category (ats, bills, banks, events, promotions)",
              "title": "Categories"
            },
            "description": "Filter by ML category (ats, bills, banks, events, promotions)"
          },
          {
            "name": "hide_expired",
            "in": "query",
            "required": false,
            "schema": {
              "type": "boolean",
              "description": "Hide expired emails (expires_at < now) and past events (event_start_at < now)",
              "default": false,
              "title": "Hide Expired"
            },
            "description": "Hide expired emails (expires_at < now) and past events (event_start_at < now)"
          },
          {
            "name": "risk_min",
            "in": "query",
            "required": false,
            "schema": {
              "anyOf": [
                {
                  "type": "integer",
                  "maximum": 100,
                  "minimum": 0
                },
                {
                  "type": "null"
                }
              ],
              "description": "Minimum risk score (0-100)",
              "title": "Risk Min"
            },
            "description": "Minimum risk score (0-100)"
          },
          {
            "name": "risk_max",
            "in": "query",
            "required": false,
            "schema": {
              "anyOf": [
                {
                  "type": "integer",
                  "maximum": 100,
                  "minimum": 0
                },
                {
                  "type": "null"
                }
              ],
              "description": "Maximum risk score (0-100)",
              "title": "Risk Max"
            },
            "description": "Maximum risk score (0-100)"
          },
          {
            "name": "quarantined",
            "in": "query",
            "required": false,
            "schema": {
              "anyOf": [
                {
                  "type": "boolean"
                },
                {
                  "type": "null"
                }
              ],
              "description": "Filter by quarantine status: true|false",
              "title": "Quarantined"
            },
            "description": "Filter by quarantine status: true|false"
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SearchResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/search/explain/{doc_id}": {
      "get": {
        "tags": [
          "search"
        ],
        "summary": "Explain",
        "description": "Explain why an email was categorized/scored the way it was.\n\nReturns reasoning based on:\n- Gmail labels (CATEGORY_*)\n- Label heuristics (offer, interview, rejection, etc.)\n- List-Unsubscribe header presence\n- Promo/newsletter flags and keywords",
        "operationId": "explain_search_explain__doc_id__get",
        "parameters": [
          {
            "name": "doc_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "title": "Doc Id"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/app__routers__search__ExplainResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/search/actions/archive": {
      "post": {
        "tags": [
          "search"
        ],
        "summary": "Archive",
        "description": "Archive email (dry-run mode).\n\nRecords intent to applylens_audit index without mutating Gmail.\nIn production, this would remove the INBOX label via Gmail API.",
        "operationId": "archive_search_actions_archive_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/app__routers__search__ActionRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/app__routers__search__ActionResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/search/actions/mark_safe": {
      "post": {
        "tags": [
          "search"
        ],
        "summary": "Mark Safe",
        "description": "Mark email as safe (dry-run mode).\n\nRecords intent to applylens_audit index without mutating Gmail.\nIn production, this would add a custom 'safe' label via Gmail API.",
        "operationId": "mark_safe_search_actions_mark_safe_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/app__routers__search__ActionRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/app__routers__search__ActionResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/search/actions/mark_suspicious": {
      "post": {
        "tags": [
          "search"
        ],
        "summary": "Mark Suspicious",
        "description": "Mark email as suspicious (dry-run mode).\n\nRecords intent to applylens_audit index without mutating Gmail.\nIn production, this would add a custom 'suspicious' label via Gmail API.",
        "operationId": "mark_suspicious_search_actions_mark_suspicious_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/app__routers__search__ActionRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/app__routers__search__ActionResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/search/actions/unsubscribe_dryrun": {
      "post": {
        "tags": [
          "search"
        ],
        "summary": "Unsubscribe Dryrun",
        "description": "Unsubscribe from email list (dry-run mode).\n\nRecords intent to applylens_audit index without performing actual unsubscribe.\nIn production, this would parse list_unsubscribe header and make HTTP request.",
        "operationId": "unsubscribe_dryrun_search_actions_unsubscribe_dryrun_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/app__routers__search__ActionRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/app__routers__search__ActionResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/search/health": {
      "get": {
        "tags": [
          "search"
        ],
        "summary": "Search Health",
        "description": "Get search health diagnostics for current user.\n\nReturns:\n- alias: The ES index/alias being queried\n- alias_total: Total document count across all users\n- owner: Current user's email\n- owner_total: Document count for current user\n- sample: Sample document for current user (if any)\n\nUseful for debugging \"0 results\" issues.",
        "operationId": "search_health_search_health_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "additionalProperties": true,
                  "type": "object",
                  "title": "Response Search Health Search Health Get"
                }
              }
            }
          }
        }
      }
    },
    "/suggest/": {
      "get": {
        "tags": [
          "suggest"
        ],
        "summary": "Suggest",
        "description": "Unified suggest: completion over subject + phrase spell-correct + body prefix.\n\nCRITICAL: NEVER throws 500 - always returns empty suggestions on error\nto prevent blocking search results UI.",
        "operationId": "suggest_suggest__get",
        "parameters": [
          {
            "name": "q",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string",
              "minLength": 1,
              "title": "Q"
            }
          },
          {
            "name": "limit",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "default": 8,
              "title": "Limit"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "additionalProperties": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    }
                  },
                  "title": "Response Suggest Suggest  Get"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/applications": {
      "get": {
        "tags": [
          "applications"
        ],
        "summary": "List Applications",
        "description": "List applications with cursor-based pagination and sorting.\n\n- **limit**: Max items per page (1-200, default 25)\n- **status**: Filter by status (applied, interview, offer, rejected, etc.)\n- **sort**: Sort field (updated_at, applied_at, company, status)\n- **order**: Sort order (asc or desc)\n- **cursor**: Opaque token from previous page's next_cursor\n\nReturns items with next_cursor for subsequent pages.",
        "operationId": "list_applications_applications_get",
        "parameters": [
          {
            "name": "limit",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "maximum": 200,
              "minimum": 1,
              "default": 25,
              "title": "Limit"
            }
          },
          {
            "name": "status",
            "in": "query",
            "required": false,
            "schema": {
              "anyOf": [
                {
                  "type": "string"
                },
                {
                  "type": "null"
                }
              ],
              "description": "Filter by status",
              "title": "Status"
            },
            "description": "Filter by status"
          },
          {
            "name": "sort",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string",
              "description": "One of: applied_at, company, status, updated_at",
              "default": "updated_at",
              "title": "Sort"
            },
            "description": "One of: applied_at, company, status, updated_at"
          },
          {
            "name": "order",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string",
              "description": "asc|desc",
              "default": "desc",
              "title": "Order"
            },
            "description": "asc|desc"
          },
          {
            "name": "cursor",
            "in": "query",
            "required": false,
            "schema": {
              "anyOf": [
                {
                  "type": "string"
                },
                {
                  "type": "null"
                }
              ],
              "description": "Opaque cursor from previous page",
              "title": "Cursor"
            },
            "description": "Opaque cursor from previous page"
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApplicationListResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/applications/tracker": {
      "get": {
        "tags": [
          "applications"
        ],
        "summary": "Get Tracker Applications",
        "description": "Get application rows for the Tracker page derived from Gmail emails.\n\nThis is a read-only endpoint that groups job-related emails by company\nand returns them as application rows for the Tracker UI.\n\nSafe for production - no mutations, graceful fallback to empty list.",
        "operationId": "get_tracker_applications_applications_tracker_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "items": {
                    "$ref": "#/components/schemas/TrackerRow"
                  },
                  "type": "array",
                  "title": "Response Get Tracker Applications Applications Tracker Get"
                }
              }
            }
          }
        }
      }
    },
    "/auth/csrf": {
      "get": {
        "tags": [
          "auth"
        ],
        "summary": "Get Csrf Token",
        "description": "Issue CSRF token cookie for frontend JavaScript to read.",
        "operationId": "get_csrf_token_auth_csrf_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        }
      }
    },
    "/auth/google/login": {
      "get": {
        "tags": [
          "auth"
        ],
        "summary": "Google Login",
        "description": "Redirect to Google OAuth login page.",
        "operationId": "google_login_auth_google_login_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        }
      }
    },
    "/auth/google/callback": {
      "get": {
        "tags": [
          "auth"
        ],
        "summary": "Google Callback",
        "description": "Handle Google OAuth callback.",
        "operationId": "google_callback_auth_google_callback_get",
        "parameters": [
          {
            "name": "code",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string",
              "title": "Code"
            }
          },
          {
            "name": "state",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string",
              "title": "State"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/auth/logout": {
      "post": {
        "tags": [
          "auth"
        ],
        "summary": "Logout",
        "description": "Logout current user by clearing session.",
        "operationId": "logout_auth_logout_post",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SessionResponse"
                }
              }
            }
          }
        }
      }
    },
    "/auth/demo/start": {
      "post": {
        "tags": [
          "auth"
        ],
        "summary": "Demo Start",
        "description": "Start a demo session with read-only access.",
        "operationId": "demo_start_auth_demo_start_post",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SessionResponse"
                }
              }
            }
          }
        }
      }
    },
    "/auth/me": {
      "get": {
        "tags": [
          "auth"
        ],
        "summary": "Get Current User Info",
        "description": "Get current authenticated user information.",
        "operationId": "get_current_user_info_auth_me_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UserSchema"
                }
              }
            }
          }
        }
      }
    },
    "/auth/status": {
      "get": {
        "tags": [
          "auth"
        ],
        "summary": "Auth Status",
        "description": "Check authentication status.",
        "operationId": "auth_status_auth_status_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        }
      }
    },
    "/admin/demo/reset": {
      "post": {
        "tags": [
          "admin"
        ],
        "summary": "Reset Demo",
        "description": "Reset demo user data with fresh seed.\n\nRequires authentication. Only allowed for specific admin users.\n\nReturns:\n    Success message",
        "operationId": "reset_demo_admin_demo_reset_post",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        }
      }
    },
    "/admin/health": {
      "get": {
        "tags": [
          "admin"
        ],
        "summary": "Admin Health",
        "description": "Health check for admin endpoints.\n\nReturns:\n    Status information",
        "operationId": "admin_health_admin_health_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        }
      }
    },
    "/auth2/google/csrf": {
      "get": {
        "tags": [
          "auth-legacy"
        ],
        "summary": "Get Csrf Token",
        "description": "Issue CSRF token cookie for frontend JavaScript to read",
        "operationId": "get_csrf_token_auth2_google_csrf_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        }
      }
    },
    "/auth2/google/login": {
      "get": {
        "tags": [
          "auth-legacy"
        ],
        "summary": "Login",
        "description": "Initiate OAuth flow with Google",
        "operationId": "login_auth2_google_login_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        }
      }
    },
    "/auth2/google/callback": {
      "get": {
        "tags": [
          "auth-legacy"
        ],
        "summary": "Callback",
        "description": "Handle OAuth callback from Google",
        "operationId": "callback_auth2_google_callback_get",
        "parameters": [
          {
            "name": "state",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string",
              "title": "State"
            }
          },
          {
            "name": "code",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string",
              "title": "Code"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/gmail/status": {
      "get": {
        "tags": [
          "gmail"
        ],
        "summary": "Get Connection Status",
        "description": "Check if user has connected their Gmail account",
        "operationId": "get_connection_status_gmail_status_get",
        "parameters": [
          {
            "name": "user_email",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string",
              "default": "leoklemet.pa@gmail.com",
              "title": "User Email"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ConnectionStatus"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/gmail/inbox": {
      "get": {
        "tags": [
          "gmail"
        ],
        "summary": "Get Inbox",
        "description": "Get paginated list of Gmail emails from database",
        "operationId": "get_inbox_gmail_inbox_get",
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "minimum": 1,
              "default": 1,
              "title": "Page"
            }
          },
          {
            "name": "limit",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "maximum": 200,
              "minimum": 1,
              "default": 50,
              "title": "Limit"
            }
          },
          {
            "name": "label_filter",
            "in": "query",
            "required": false,
            "schema": {
              "anyOf": [
                {
                  "type": "string"
                },
                {
                  "type": "null"
                }
              ],
              "description": "Filter by label_heuristics",
              "title": "Label Filter"
            },
            "description": "Filter by label_heuristics"
          },
          {
            "name": "user_email",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string",
              "default": "leoklemet.pa@gmail.com",
              "title": "User Email"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/InboxResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/gmail/backfill": {
      "post": {
        "tags": [
          "gmail"
        ],
        "summary": "Backfill",
        "description": "Backfill Gmail messages from the last N days",
        "operationId": "backfill_gmail_backfill_post",
        "parameters": [
          {
            "name": "days",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "maximum": 365,
              "minimum": 1,
              "default": 60,
              "title": "Days"
            }
          },
          {
            "name": "user_email",
            "in": "query",
            "required": false,
            "schema": {
              "anyOf": [
                {
                  "type": "string"
                },
                {
                  "type": "null"
                }
              ],
              "title": "User Email"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/BackfillResp"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/oauth/google/init": {
      "get": {
        "tags": [
          "oauth"
        ],
        "summary": "Init Oauth",
        "description": "Initialize OAuth flow for a user.\n\nReturns:\n    {\"authUrl\": \"https://accounts.google.com/o/oauth2/auth?...\"}\n\nFrontend should redirect user to authUrl.",
        "operationId": "init_oauth_oauth_google_init_get",
        "parameters": [
          {
            "name": "user_email",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string",
              "description": "User email address for OAuth",
              "title": "User Email"
            },
            "description": "User email address for OAuth"
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/oauth/google/callback": {
      "get": {
        "tags": [
          "oauth"
        ],
        "summary": "Oauth Callback",
        "description": "Handle OAuth callback from Google.\n\nExchanges authorization code for tokens and stores in database.\n\nReturns:\n    HTML page with success message",
        "operationId": "oauth_callback_oauth_google_callback_get",
        "parameters": [
          {
            "name": "code",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string",
              "description": "Authorization code from Google",
              "title": "Code"
            },
            "description": "Authorization code from Google"
          },
          {
            "name": "state",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string",
              "description": "State parameter with user_email",
              "title": "State"
            },
            "description": "State parameter with user_email"
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/oauth/google/status": {
      "get": {
        "tags": [
          "oauth"
        ],
        "summary": "Check Oauth Status",
        "description": "Check if user has connected their Gmail account.\n\nReturns:\n    {\"connected\": bool, \"user_email\": str, \"expires_at\": int|null}",
        "operationId": "check_oauth_status_oauth_google_status_get",
        "parameters": [
          {
            "name": "user_email",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string",
              "description": "User email to check",
              "title": "User Email"
            },
            "description": "User email to check"
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/oauth/google/disconnect": {
      "delete": {
        "tags": [
          "oauth"
        ],
        "summary": "Disconnect Gmail",
        "description": "Disconnect user's Gmail account (delete stored tokens).\n\nReturns:\n    {\"success\": bool}",
        "operationId": "disconnect_gmail_oauth_google_disconnect_delete",
        "parameters": [
          {
            "name": "user_email",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string",
              "description": "User email to disconnect",
              "title": "User Email"
            },
            "description": "User email to disconnect"
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/applications/extract": {
      "post": {
        "tags": [
          "applications"
        ],
        "summary": "Extract Endpoint",
        "description": "Extract company, role, and source from email content.\n\nIf gmail_thread_id is provided, attempts to fetch email from Gmail.\nOtherwise, uses provided email fields (subject, from, text, etc.).\n\nSupports multi-user OAuth via X-User-Email header or user_email in body.",
        "operationId": "extract_endpoint_applications_extract_post",
        "parameters": [
          {
            "name": "X-User-Email",
            "in": "header",
            "required": false,
            "schema": {
              "anyOf": [
                {
                  "type": "string"
                },
                {
                  "type": "null"
                }
              ],
              "title": "X-User-Email"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ExtractPayload"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ExtractResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/applications/backfill-from-email": {
      "post": {
        "tags": [
          "applications"
        ],
        "summary": "Backfill Endpoint",
        "description": "Extract fields from email and create/update application.\n\nIf gmail_thread_id is provided, fetches from Gmail.\nOtherwise, uses provided email fields.\n\nLogic:\n1. Fetch email content (Gmail or body)\n2. Extract company/role/source\n3. Find existing application (by thread_id or company+role)\n4. Update existing or create new",
        "operationId": "backfill_endpoint_applications_backfill_from_email_post",
        "parameters": [
          {
            "name": "X-User-Email",
            "in": "header",
            "required": false,
            "schema": {
              "anyOf": [
                {
                  "type": "string"
                },
                {
                  "type": "null"
                }
              ],
              "title": "X-User-Email"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/BackfillPayload"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/BackfillResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/gmail/backfill/cancel": {
      "post": {
        "tags": [
          "gmail"
        ],
        "summary": "Cancel Job",
        "description": "Cancel a running or queued job.\n\nNote: This sets a flag but may not stop immediately if already running.",
        "operationId": "cancel_job_gmail_backfill_cancel_post",
        "parameters": [
          {
            "name": "job_id",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string",
              "description": "Job ID to cancel",
              "title": "Job Id"
            },
            "description": "Job ID to cancel"
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CancelResp"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/gmail/backfill/jobs": {
      "get": {
        "tags": [
          "gmail"
        ],
        "summary": "List Jobs",
        "description": "List all jobs (optionally filtered by user_email).\n\nUseful for debugging and monitoring.",
        "operationId": "list_jobs_gmail_backfill_jobs_get",
        "parameters": [
          {
            "name": "user_email",
            "in": "query",
            "required": false,
            "schema": {
              "anyOf": [
                {
                  "type": "string"
                },
                {
                  "type": "null"
                }
              ],
              "title": "User Email"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "additionalProperties": {
                    "$ref": "#/components/schemas/StatusResp"
                  },
                  "title": "Response List Jobs Gmail Backfill Jobs Get"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/labels/apply": {
      "post": {
        "tags": [
          "labels"
        ],
        "summary": "Apply Labels",
        "description": "Apply category labels to all emails matching query.\n\nProcess:\n    1. Scroll through all matching documents\n    2. Apply rule-based labels (high precision)\n    3. Fall back to ML model if no rule matches\n    4. Write category, confidence, reason, and features to ES\n\nArgs:\n    query: Elasticsearch query (default: match all)\n    batch_size: Documents per scroll batch (default: 200)\n\nReturns:\n    Dict with:\n        - updated: Number of documents updated\n        - by_category: Breakdown by category\n        - by_method: Breakdown by labeling method (rule vs ML)\n\nExample:\n    POST /labels/apply\n    {\n        \"query\": {\"range\": {\"received_at\": {\"gte\": \"now-7d\"}}},\n        \"batch_size\": 100\n    }\n\n    Response:\n    {\n        \"updated\": 1234,\n        \"by_category\": {\"promo\": 456, \"newsletter\": 321, ...},\n        \"by_method\": {\"rule\": 890, \"ml\": 344}\n    }",
        "operationId": "apply_labels_labels_apply_post",
        "parameters": [
          {
            "name": "batch_size",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "default": 200,
              "title": "Batch Size"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "additionalProperties": true,
                "default": {
                  "match_all": {}
                },
                "title": "Query"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "additionalProperties": true,
                  "title": "Response Apply Labels Labels Apply Post"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/labels/apply-batch": {
      "post": {
        "tags": [
          "labels"
        ],
        "summary": "Apply Labels Batch",
        "description": "Apply labels to a specific batch of documents by ID.\n\nUseful for re-labeling specific emails or handling updates.\n\nArgs:\n    doc_ids: List of Elasticsearch document IDs\n\nReturns:\n    Dict with updated count and category breakdown\n\nExample:\n    POST /labels/apply-batch\n    {\n        \"doc_ids\": [\"abc123\", \"def456\", \"ghi789\"]\n    }",
        "operationId": "apply_labels_batch_labels_apply_batch_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "items": {
                  "type": "string"
                },
                "type": "array",
                "title": "Doc Ids",
                "description": "List of document IDs to label"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "additionalProperties": true,
                  "type": "object",
                  "title": "Response Apply Labels Batch Labels Apply Batch Post"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/labels/stats": {
      "get": {
        "tags": [
          "labels"
        ],
        "summary": "Label Stats",
        "description": "Get statistics about labeled emails.\n\nReturns breakdown by category, confidence distribution, etc.\n\nReturns:\n    Dict with:\n        - total: Total documents\n        - by_category: Count by category\n        - avg_confidence: Average confidence score\n        - low_confidence: Count with confidence < 0.5",
        "operationId": "label_stats_labels_stats_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "additionalProperties": true,
                  "type": "object",
                  "title": "Response Label Stats Labels Stats Get"
                }
              }
            }
          }
        }
      }
    },
    "/profile/summary": {
      "get": {
        "tags": [
          "profile"
        ],
        "summary": "Profile Summary",
        "description": "Get summary of user's email profile over time window.\n\nReturns aggregated stats:\n- Total email count\n- Breakdown by category\n- Top senders by volume\n- Average emails per day\n\nArgs:\n    days: Time window in days (default: 60, max: 365)\n\nReturns:\n    {\n        \"total\": 1234,\n        \"days\": 60,\n        \"avg_per_day\": 20.5,\n        \"by_category\": [\n            {\"category\": \"newsletter\", \"count\": 456, \"percent\": 37.0},\n            {\"category\": \"promo\", \"count\": 321, \"percent\": 26.0},\n            ...\n        ],\n        \"top_senders\": [\n            {\"sender_domain\": \"example.com\", \"count\": 42},\n            ...\n        ]\n    }",
        "operationId": "profile_summary_profile_summary_get",
        "parameters": [
          {
            "name": "days",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "maximum": 365,
              "minimum": 1,
              "default": 60,
              "title": "Days"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "additionalProperties": true,
                  "title": "Response Profile Summary Profile Summary Get"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/profile/senders": {
      "get": {
        "tags": [
          "profile"
        ],
        "summary": "Profile Senders",
        "description": "Get detailed sender breakdown with optional category filter.\n\nUseful for:\n- Finding all newsletter senders\n- Identifying promotional email sources\n- Analyzing recruiting email patterns\n\nArgs:\n    category: Filter by specific category (e.g., \"newsletter\", \"promo\")\n    days: Time window in days (default: 60)\n    size: Max senders to return (default: 100)\n\nReturns:\n    {\n        \"category\": \"newsletter\",  # or null if no filter\n        \"days\": 60,\n        \"senders\": [\n            {\n                \"sender_domain\": \"example.com\",\n                \"count\": 42,\n                \"latest\": \"2024-12-15T10:00:00Z\"\n            },\n            ...\n        ]\n    }",
        "operationId": "profile_senders_profile_senders_get",
        "parameters": [
          {
            "name": "category",
            "in": "query",
            "required": false,
            "schema": {
              "anyOf": [
                {
                  "type": "string"
                },
                {
                  "type": "null"
                }
              ],
              "description": "Filter by category",
              "title": "Category"
            },
            "description": "Filter by category"
          },
          {
            "name": "days",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "maximum": 365,
              "minimum": 1,
              "default": 60,
              "title": "Days"
            }
          },
          {
            "name": "size",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "maximum": 500,
              "minimum": 1,
              "default": 100,
              "title": "Size"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "additionalProperties": true,
                  "title": "Response Profile Senders Profile Senders Get"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/profile/categories/{category}": {
      "get": {
        "tags": [
          "profile"
        ],
        "summary": "Category Details",
        "description": "Get detailed breakdown for a specific category.\n\nArgs:\n    category: Category name (e.g., \"newsletter\", \"promo\", \"recruiting\")\n    days: Time window in days (default: 60)\n\nReturns:\n    {\n        \"category\": \"newsletter\",\n        \"total\": 456,\n        \"days\": 60,\n        \"avg_per_day\": 7.6,\n        \"top_senders\": [...],\n        \"recent_subjects\": [...]\n    }",
        "operationId": "category_details_profile_categories__category__get",
        "parameters": [
          {
            "name": "category",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "title": "Category"
            }
          },
          {
            "name": "days",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "maximum": 365,
              "minimum": 1,
              "default": 60,
              "title": "Days"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "additionalProperties": true,
                  "title": "Response Category Details Profile Categories  Category  Get"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/profile/time-series": {
      "get": {
        "tags": [
          "profile"
        ],
        "summary": "Time Series",
        "description": "Get email volume over time (time series data).\n\nUseful for visualizing email patterns and trends.\n\nArgs:\n    days: Time window in days (default: 30, max: 90)\n    interval: Bucket interval (1h, 6h, 12h, 1d, 1w)\n\nReturns:\n    {\n        \"interval\": \"1d\",\n        \"buckets\": [\n            {\n                \"timestamp\": \"2024-12-01T00:00:00Z\",\n                \"count\": 42,\n                \"by_category\": {\"newsletter\": 20, \"promo\": 15, ...}\n            },\n            ...\n        ]\n    }",
        "operationId": "time_series_profile_time_series_get",
        "parameters": [
          {
            "name": "days",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "maximum": 90,
              "minimum": 1,
              "default": 30,
              "title": "Days"
            }
          },
          {
            "name": "interval",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string",
              "pattern": "^(1h|6h|12h|1d|1w)$",
              "default": "1d",
              "title": "Interval"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "additionalProperties": true,
                  "title": "Response Time Series Profile Time Series Get"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/profile/rebuild": {
      "post": {
        "tags": [
          "profile"
        ],
        "summary": "Profile Rebuild V2",
        "description": "Rebuild profile for current user from email history (database-backed).\n\nAutomatically uses the authenticated user's email.\nAdmin can override by passing X-User-Email header.\n\nAggregates:\n- Sender statistics (volume, categories, open rate)\n- Category statistics (volume per category)\n- Interests (extracted keywords with scores)\n\nArgs:\n    lookback_days: Days of history to analyze (default 90)\n\nReturns:\n    Dict with rebuild stats",
        "operationId": "profile_rebuild_v2_profile_rebuild_post",
        "parameters": [
          {
            "name": "lookback_days",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "description": "Days of email history to analyze",
              "default": 90,
              "title": "Lookback Days"
            },
            "description": "Days of email history to analyze"
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/profile/db-summary": {
      "get": {
        "tags": [
          "profile"
        ],
        "summary": "Profile Summary V2",
        "description": "Get profile summary for current user (database-backed).\n\nAutomatically uses the authenticated user's email.\nAdmin can override by passing X-User-Email header.\n\nReturns:\n    Dict with top senders, categories, and interests",
        "operationId": "profile_summary_v2_profile_db_summary_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        }
      }
    },
    "/profile/db-interests": {
      "get": {
        "tags": [
          "profile"
        ],
        "summary": "Get Interests V2",
        "description": "Get user interests with scores (database-backed).\n\nArgs:\n    user_email: User email address\n    limit: Max number of interests (default 50)\n\nReturns:\n    List of interests with scores",
        "operationId": "get_interests_v2_profile_db_interests_get",
        "parameters": [
          {
            "name": "user_email",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string",
              "description": "User email",
              "title": "User Email"
            },
            "description": "User email"
          },
          {
            "name": "limit",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "description": "Max interests to return",
              "default": 50,
              "title": "Limit"
            },
            "description": "Max interests to return"
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/profile/db-senders": {
      "get": {
        "tags": [
          "profile"
        ],
        "summary": "Get Top Senders V2",
        "description": "Get top senders by volume (database-backed).\n\nArgs:\n    user_email: User email address\n    limit: Max number of senders (default 20)\n\nReturns:\n    List of sender domains with stats",
        "operationId": "get_top_senders_v2_profile_db_senders_get",
        "parameters": [
          {
            "name": "user_email",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string",
              "description": "User email",
              "title": "User Email"
            },
            "description": "User email"
          },
          {
            "name": "limit",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "description": "Max senders to return",
              "default": 20,
              "title": "Limit"
            },
            "description": "Max senders to return"
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/profile/db-categories": {
      "get": {
        "tags": [
          "profile"
        ],
        "summary": "Get Categories V2",
        "description": "Get category breakdown for user (database-backed).\n\nArgs:\n    user_email: User email address\n\nReturns:\n    List of categories with counts",
        "operationId": "get_categories_v2_profile_db_categories_get",
        "parameters": [
          {
            "name": "user_email",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string",
              "description": "User email",
              "title": "User Email"
            },
            "description": "User email"
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/ml/label/rebuild": {
      "post": {
        "tags": [
          "ml"
        ],
        "summary": "Label Rebuild",
        "description": "Rebuild labels for recent emails using ML model + rules.\n\nArgs:\n    limit: Max number of emails to process (default 2000)\n    user_email: Optional - only process emails for this user\n\nReturns:\n    Dict with updated count and category breakdown",
        "operationId": "label_rebuild_ml_label_rebuild_post",
        "parameters": [
          {
            "name": "limit",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "default": 2000,
              "title": "Limit"
            }
          },
          {
            "name": "user_email",
            "in": "query",
            "required": false,
            "schema": {
              "anyOf": [
                {
                  "type": "string"
                },
                {
                  "type": "null"
                }
              ],
              "title": "User Email"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/ml/label/preview": {
      "get": {
        "tags": [
          "ml"
        ],
        "summary": "Label Preview",
        "description": "Preview emails by category.\n\nArgs:\n    category: Category to preview (promotions, ats, bills, banks, events, other)\n    limit: Max number of results (default 20)\n    user_email: Optional - filter by user\n\nReturns:\n    List of email objects",
        "operationId": "label_preview_ml_label_preview_get",
        "parameters": [
          {
            "name": "category",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string",
              "title": "Category"
            }
          },
          {
            "name": "limit",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "default": 20,
              "title": "Limit"
            }
          },
          {
            "name": "user_email",
            "in": "query",
            "required": false,
            "schema": {
              "anyOf": [
                {
                  "type": "string"
                },
                {
                  "type": "null"
                }
              ],
              "title": "User Email"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/ml/label/email/{email_id}": {
      "post": {
        "tags": [
          "ml"
        ],
        "summary": "Label Single Email",
        "description": "Label a single email by ID.\n\nArgs:\n    email_id: Database ID of email\n\nReturns:\n    Updated email with category and scores",
        "operationId": "label_single_email_ml_label_email__email_id__post",
        "parameters": [
          {
            "name": "email_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer",
              "title": "Email Id"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/ml/stats": {
      "get": {
        "tags": [
          "ml"
        ],
        "summary": "Get Labeling Stats",
        "description": "Get labeling statistics.\n\nArgs:\n    user_email: Optional - filter by user\n\nReturns:\n    Dict with category counts and coverage",
        "operationId": "get_labeling_stats_ml_stats_get",
        "parameters": [
          {
            "name": "user_email",
            "in": "query",
            "required": false,
            "schema": {
              "anyOf": [
                {
                  "type": "string"
                },
                {
                  "type": "null"
                }
              ],
              "title": "User Email"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/ux/heartbeat": {
      "post": {
        "tags": [
          "ux"
        ],
        "summary": "Heartbeat",
        "description": "Client heartbeat ping.\n\nFrontend calls this every 30s while user is active on a page.\nHelps distinguish \"no activity\" from \"no users connected\".\n\nCSRF-exempt: This is a non-sensitive UX metric endpoint.\n\nReturns minimal response to keep overhead low.",
        "operationId": "heartbeat_ux_heartbeat_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/Heartbeat"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/ux/chat/opened": {
      "post": {
        "tags": [
          "ux"
        ],
        "summary": "Chat Opened",
        "description": "Track when users open the chat interface.\n\nUseful for funnel analysis and engagement metrics.",
        "operationId": "chat_opened_ux_chat_opened_post",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        }
      }
    },
    "/api/security/rescan/{email_id}": {
      "post": {
        "tags": [
          "security"
        ],
        "summary": "Rescan Email",
        "description": "Rescan an email for security risks and update its risk score, flags, and quarantine status.",
        "operationId": "rescan_email_api_security_rescan__email_id__post",
        "parameters": [
          {
            "name": "email_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "title": "Email Id"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/api/security/stats": {
      "get": {
        "tags": [
          "security"
        ],
        "summary": "Get Security Stats",
        "description": "Get overall security statistics across all emails.",
        "operationId": "get_security_stats_api_security_stats_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        }
      }
    },
    "/api/security/risk-top3": {
      "get": {
        "tags": [
          "security"
        ],
        "summary": "Get Risk Top3",
        "description": "AI Feature: Smart Risk Badge\nReturns top 3 risk signals sorted by weight for a given message.\n\nReturns:\n    {\n        \"score\": 45,\n        \"signals\": [\n            {\"id\": \"DMARC_FAIL\", \"label\": \"DMARC Failed\", \"explain\": \"...\"},\n            {\"id\": \"SPF_FAIL\", \"label\": \"SPF Failed\", \"explain\": \"...\"},\n            {\"id\": \"NEW_DOMAIN\", \"label\": \"New Domain\", \"explain\": \"...\"}\n        ]\n    }",
        "operationId": "get_risk_top3_api_security_risk_top3_get",
        "parameters": [
          {
            "name": "message_id",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string",
              "title": "Message Id"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/api/security/bulk/rescan": {
      "post": {
        "tags": [
          "security"
        ],
        "summary": "Bulk Rescan",
        "description": "Rescan multiple emails for security risks.\nReturns count of successfully rescanned emails.",
        "operationId": "bulk_rescan_api_security_bulk_rescan_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "items": {
                  "type": "string"
                },
                "type": "array",
                "title": "Email Ids"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/api/security/bulk/quarantine": {
      "post": {
        "tags": [
          "security"
        ],
        "summary": "Bulk Quarantine",
        "description": "Quarantine multiple emails by ID.\nReturns count of quarantined emails.",
        "operationId": "bulk_quarantine_api_security_bulk_quarantine_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "items": {
                  "type": "string"
                },
                "type": "array",
                "title": "Email Ids"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/api/security/bulk/release": {
      "post": {
        "tags": [
          "security"
        ],
        "summary": "Bulk Release",
        "description": "Release multiple emails from quarantine.\nReturns count of released emails.",
        "operationId": "bulk_release_api_security_bulk_release_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "items": {
                  "type": "string"
                },
                "type": "array",
                "title": "Email Ids"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/api/security/events": {
      "get": {
        "tags": [
          "security"
        ],
        "summary": "Security Events",
        "description": "Server-Sent Events (SSE) endpoint for real-time security notifications.\n\nStreams events like:\n- High-risk email detected\n- Bulk quarantine operations\n- Policy changes\n\nUsage:\n    const es = new EventSource('/api/security/events', { withCredentials: true });\n    es.onmessage = (event) => {\n        const data = JSON.parse(event.data);\n        console.log('Security event:', data);\n    };",
        "operationId": "security_events_api_security_events_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        }
      }
    },
    "/policy/security": {
      "get": {
        "tags": [
          "policy"
        ],
        "summary": "Get Security Policy",
        "description": "Get security policy configuration.\nCreates default policy if none exists.",
        "operationId": "get_security_policy_policy_security_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SecurityPoliciesOut"
                }
              }
            }
          }
        }
      },
      "put": {
        "tags": [
          "policy"
        ],
        "summary": "Put Security Policy",
        "description": "Update security policy configuration.\nCreates policy if none exists.",
        "operationId": "put_security_policy_policy_security_put",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/SecurityPoliciesIn"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SecurityPoliciesOut"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/policy/stats": {
      "get": {
        "tags": [
          "policy"
        ],
        "summary": "Policy Stats",
        "description": "Get policy performance statistics for the current user.\n\nReturns list of policies with their performance metrics:\n- policy_id: Policy ID\n- name: Policy name\n- precision: Ratio of approved to fired proposals\n- approved: Total approved proposals\n- rejected: Total rejected proposals\n- fired: Total times policy proposed an action\n\nSorted by fired count (most active first).",
        "operationId": "policy_stats_policy_stats_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "items": {
                    "additionalProperties": true,
                    "type": "object"
                  },
                  "type": "array",
                  "title": "Response Policy Stats Policy Stats Get"
                }
              }
            }
          }
        }
      }
    },
    "/actions/propose": {
      "post": {
        "tags": [
          "actions"
        ],
        "summary": "Propose Actions",
        "description": "Propose actions for a set of emails based on enabled policies.\n\nProcess:\n1. Load emails (by IDs or query)\n2. Load enabled policies (ordered by priority)\n3. For each email:\n    - Evaluate policies in priority order\n    - Create ProposedAction for first matching policy\n    - Stop at first match (short-circuit)\n\nReturns:\n    {\"created\": [action_ids], \"count\": N}",
        "operationId": "propose_actions_actions_propose_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ProposeRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/actions/{action_id}/approve": {
      "post": {
        "tags": [
          "actions"
        ],
        "summary": "Approve Action",
        "description": "Approve and execute a proposed action.\n\nProcess:\n1. Validate action is pending\n2. Mark as approved\n3. Execute the action\n4. Write audit trail\n5. Update status (executed/failed)\n\nReturns:\n    {\"ok\": bool, \"outcome\": str}",
        "operationId": "approve_action_actions__action_id__approve_post",
        "parameters": [
          {
            "name": "action_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer",
              "title": "Action Id"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ApproveRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/actions/{action_id}/reject": {
      "post": {
        "tags": [
          "actions"
        ],
        "summary": "Reject Action",
        "description": "Reject a proposed action.\n\nProcess:\n1. Validate action is pending\n2. Mark as rejected\n3. Write audit trail (outcome=noop)\n\nReturns:\n    {\"ok\": true}",
        "operationId": "reject_action_actions__action_id__reject_post",
        "parameters": [
          {
            "name": "action_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer",
              "title": "Action Id"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/actions/{action_id}/always": {
      "post": {
        "tags": [
          "actions"
        ],
        "summary": "Always Do This",
        "description": "Create a policy based on this action (\"Always do this\" button).\n\nProcess:\n1. Load the proposed action\n2. Extract stable features from rationale\n3. Create a new policy with learned condition\n4. Set appropriate priority and confidence threshold\n\nReturns:\n    {\"ok\": true, \"policy_id\": N}",
        "operationId": "always_do_this_actions__action_id__always_post",
        "parameters": [
          {
            "name": "action_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer",
              "title": "Action Id"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/AlwaysRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/actions/tray": {
      "get": {
        "tags": [
          "actions"
        ],
        "summary": "Get Tray",
        "description": "Get pending actions for UI tray.\n\nReturns list of proposed actions with email details.",
        "operationId": "get_tray_actions_tray_get",
        "parameters": [
          {
            "name": "limit",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "maximum": 200,
              "minimum": 1,
              "default": 50,
              "title": "Limit"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/actions/policies": {
      "get": {
        "tags": [
          "actions"
        ],
        "summary": "List Policies",
        "description": "List all policies.",
        "operationId": "list_policies_actions_policies_get",
        "parameters": [
          {
            "name": "enabled_only",
            "in": "query",
            "required": false,
            "schema": {
              "type": "boolean",
              "default": false,
              "title": "Enabled Only"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": [
          "actions"
        ],
        "summary": "Create Policy",
        "description": "Create a new policy.",
        "operationId": "create_policy_actions_policies_post",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/PolicyCreate"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/actions/policies/{policy_id}": {
      "put": {
        "tags": [
          "actions"
        ],
        "summary": "Update Policy",
        "description": "Update an existing policy.",
        "operationId": "update_policy_actions_policies__policy_id__put",
        "parameters": [
          {
            "name": "policy_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer",
              "title": "Policy Id"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/PolicyUpdate"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": [
          "actions"
        ],
        "summary": "Delete Policy",
        "description": "Delete a policy.",
        "operationId": "delete_policy_actions_policies__policy_id__delete",
        "parameters": [
          {
            "name": "policy_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer",
              "title": "Policy Id"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/actions/policies/{policy_id}/test": {
      "post": {
        "tags": [
          "actions"
        ],
        "summary": "Test Policy",
        "description": "Test a policy against emails without creating proposals.\n\nReturns:\n    {\"matches\": [email_ids], \"count\": N}",
        "operationId": "test_policy_actions_policies__policy_id__test_post",
        "parameters": [
          {
            "name": "policy_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer",
              "title": "Policy Id"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/PolicyTestRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/actions/inbox": {
      "get": {
        "tags": [
          "inbox_actions"
        ],
        "summary": "Get Inbox Actions",
        "description": "Get actionable emails that need cleanup/attention.\n\nArgs:\n    mode: Filter mode - \"review\" (default), \"quarantined\", or \"archived\"\n    user_email: Current user's email\n\nReturns:\n    - review: Emails needing triage (not archived/muted/safe, excluding quarantined)\n    - quarantined: Emails marked suspicious or high-risk\n    - archived: Emails user has handled (archived/safe/muted)",
        "operationId": "get_inbox_actions_actions_inbox_get",
        "parameters": [
          {
            "name": "mode",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string",
              "default": "review",
              "title": "Mode"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/ActionRow"
                  },
                  "title": "Response Get Inbox Actions Actions Inbox Get"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/actions/explain": {
      "post": {
        "tags": [
          "inbox_actions"
        ],
        "summary": "Explain Action",
        "description": "Explain why an email needs action.\n\nReturns a human-readable summary based on email metadata using deterministic heuristics.",
        "operationId": "explain_action_actions_explain_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ExplainRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/app__routers__inbox_actions__ExplainResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/actions/message/{message_id}": {
      "get": {
        "tags": [
          "inbox_actions"
        ],
        "summary": "Get Message Detail",
        "description": "Get full message detail for drawer view.\n\nReturns complete email information including body (HTML/text) for display.",
        "operationId": "get_message_detail_actions_message__message_id__get",
        "parameters": [
          {
            "name": "message_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "title": "Message Id"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/MessageDetailResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/actions/mark_safe": {
      "post": {
        "tags": [
          "inbox_actions"
        ],
        "summary": "Mark Safe",
        "description": "Mark an email as safe (user-approved).\n\nUpdates the email's risk score, clears quarantine, and marks as archived.\nSafe emails go to the Archived view.\n\nAlso records a sender-level override in Postgres so future emails from\nthis sender are trusted and won't clutter Needs Review (adaptive classification).",
        "operationId": "mark_safe_actions_mark_safe_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/app__routers__inbox_actions__ActionRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/app__routers__inbox_actions__ActionResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/actions/mark_suspicious": {
      "post": {
        "tags": [
          "inbox_actions"
        ],
        "summary": "Mark Suspicious",
        "description": "Mark an email as suspicious (user-flagged).\n\nRaises risk score and sets quarantine flag.",
        "operationId": "mark_suspicious_actions_mark_suspicious_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/app__routers__inbox_actions__ActionRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/app__routers__inbox_actions__ActionResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/actions/archive": {
      "post": {
        "tags": [
          "inbox_actions"
        ],
        "summary": "Archive Email",
        "description": "Archive an email (hide from inbox).\n\nMarks the email as archived in our local mirror.",
        "operationId": "archive_email_actions_archive_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/app__routers__inbox_actions__ActionRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/app__routers__inbox_actions__ActionResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/actions/unsubscribe": {
      "post": {
        "tags": [
          "inbox_actions"
        ],
        "summary": "Unsubscribe",
        "description": "Unsubscribe from sender (mark as muted).\n\nMarks the email as muted/unsubscribed and archives it.\nFor now, just marks sender as unsubscribed in our DB.\nDoesn't actually click unsubscribe links yet.",
        "operationId": "unsubscribe_actions_unsubscribe_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/app__routers__inbox_actions__ActionRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/app__routers__inbox_actions__ActionResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/actions/restore": {
      "post": {
        "tags": [
          "inbox_actions"
        ],
        "summary": "Restore To Review",
        "description": "Restore an email back to Needs Review.\n\nClears all lifecycle flags so email appears in review mode again.\nUseful for undoing accidental actions.",
        "operationId": "restore_to_review_actions_restore_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/app__routers__inbox_actions__ActionRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/app__routers__inbox_actions__ActionResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/actions/metrics/summary": {
      "get": {
        "tags": [
          "inbox_actions"
        ],
        "summary": "Inbox Actions Summary",
        "description": "Return high-level triage stats for this user.\n\nThese values come from Elasticsearch (archived/quarantined counts) and\nPostgres (sender override counts). Provides at-a-glance visibility into\nuser's classification behavior.",
        "operationId": "inbox_actions_summary_actions_metrics_summary_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/InboxSummary"
                }
              }
            }
          }
        }
      }
    },
    "/actions/summary-feedback": {
      "post": {
        "tags": [
          "inbox_actions"
        ],
        "summary": "Post Summary Feedback",
        "description": "Record whether the AI summary for a thread was helpful.\nThis is used for tuning/improvement, not user-facing state.",
        "operationId": "post_summary_feedback_actions_summary_feedback_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/SummaryFeedbackRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SummaryFeedbackResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/actions/bulk/archive": {
      "post": {
        "tags": [
          "inbox_actions"
        ],
        "summary": "Bulk Archive",
        "description": "Bulk archive multiple emails.\nMarks user_archived=true in the search index.",
        "operationId": "bulk_archive_actions_bulk_archive_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/BulkActionRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/BulkActionResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/actions/bulk/mark-safe": {
      "post": {
        "tags": [
          "inbox_actions"
        ],
        "summary": "Bulk Mark Safe",
        "description": "Bulk mark multiple emails as safe.\nClears quarantined flag, sets user_overrode_safe=true.",
        "operationId": "bulk_mark_safe_actions_bulk_mark_safe_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/BulkActionRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/BulkActionResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/actions/bulk/quarantine": {
      "post": {
        "tags": [
          "inbox_actions"
        ],
        "summary": "Bulk Quarantine",
        "description": "Bulk quarantine multiple emails.\nSets quarantined=true in the search index.",
        "operationId": "bulk_quarantine_actions_bulk_quarantine_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/BulkActionRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/BulkActionResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/settings/senders": {
      "get": {
        "tags": [
          "sender_overrides"
        ],
        "summary": "List Overrides",
        "description": "List all sender overrides for current user.\n\nReturns both muted and safe senders from Postgres.",
        "operationId": "list_overrides_settings_senders_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SenderOverrideListResponse"
                }
              }
            }
          }
        }
      }
    },
    "/settings/senders/mute": {
      "post": {
        "tags": [
          "sender_overrides"
        ],
        "summary": "Mute Sender",
        "description": "Mute a sender (auto-archive future emails).\n\nCreates or updates an override with muted=true in Postgres.",
        "operationId": "mute_sender_settings_senders_mute_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/SenderOverrideCreateRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SenderOverride"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/settings/senders/safe": {
      "post": {
        "tags": [
          "sender_overrides"
        ],
        "summary": "Safe Sender",
        "description": "Mark a sender as safe (trusted, not spammy).\n\nCreates or updates an override with safe=true in Postgres.",
        "operationId": "safe_sender_settings_senders_safe_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/SenderOverrideCreateRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SenderOverride"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/settings/senders/{override_id}": {
      "delete": {
        "tags": [
          "sender_overrides"
        ],
        "summary": "Delete Override",
        "description": "Remove a sender override.\n\nReturns 404 if override not found for this user.",
        "operationId": "delete_override_settings_senders__override_id__delete",
        "parameters": [
          {
            "name": "override_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "title": "Override Id"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SenderOverrideDeleteResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/tracker": {
      "get": {
        "tags": [
          "tracker"
        ],
        "summary": "Get Tracker",
        "description": "List all job applications for the current user.\n\nReturns applications sorted by most recent activity first.\nThis is the stable public contract for the UI - frontend should call /api/tracker.\n\nNOTE: Currently returns demo data. Will query real applications table\nafter migration adds user_id column.",
        "operationId": "get_tracker_tracker_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/TrackerListResponse"
                }
              }
            }
          }
        }
      }
    },
    "/chat": {
      "post": {
        "tags": [
          "chat"
        ],
        "summary": "Chat",
        "description": "Chat with your mailbox.\n\nProcess natural language queries about emails and return:\n- Detected intent (what you're trying to do)\n- Natural language answer\n- Proposed actions (if applicable)\n- Citations (source emails)\n\nExample queries:\n- \"Summarize recent emails about job applications\"\n- \"What bills are due before Friday? Create calendar reminders.\"\n- \"Clean up promos older than a week unless they're from Best Buy\"\n- \"Show suspicious emails from new domains this week\"\n- \"Unsubscribe from newsletters I haven't opened in 60 days\"",
        "operationId": "chat_chat_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ChatRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ChatResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/chat/intents": {
      "get": {
        "tags": [
          "chat"
        ],
        "summary": "List Intents",
        "description": "List all available intents and their descriptions.\n\nUseful for UI to show quick-action buttons.",
        "operationId": "list_intents_chat_intents_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        }
      }
    },
    "/chat/health": {
      "get": {
        "tags": [
          "chat"
        ],
        "summary": "Health",
        "description": "Health check for chat service.",
        "operationId": "health_chat_health_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        }
      }
    },
    "/chat/stream": {
      "get": {
        "tags": [
          "chat"
        ],
        "summary": "Chat Stream",
        "description": "Stream chat responses with Server-Sent Events (SSE).\n\n**Canary Toggle**: Can be disabled via CHAT_STREAMING_ENABLED=false for rollback/testing.\n\nQuery params:\n- q: The user query text\n- propose: If 1, file actions to Approvals tray\n- remember: If 1, learn exceptions from the query (e.g., \"unless Best Buy\")\n- window_days: Time window in days to search (default: 30, max: 365)\n- mode: Optional mode (networking|money) for specialized boosts\n\nEvents emitted:\n- intent: {\"intent\": \"clean\", \"explanation\": \"...\"}\n- intent_explain: {\"tokens\": [\"clean\", \"before friday\", \"unless best buy\"]}\n- tool: {\"tool\": \"clean\", \"matches\": 42, \"actions\": 5}\n- answer: {\"answer\": \"Here's what I found...\"}\n- memory: {\"kept_brands\": [\"best buy\"]} - Only if remember=1\n- filed: {\"proposed\": 5} - Only if propose=1\n- done: {\"ok\": true}\n- error: {\"error\": \"message\"}",
        "operationId": "chat_stream_chat_stream_get",
        "parameters": [
          {
            "name": "q",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string",
              "title": "Q"
            }
          },
          {
            "name": "propose",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "default": 0,
              "title": "Propose"
            }
          },
          {
            "name": "remember",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "default": 0,
              "title": "Remember"
            }
          },
          {
            "name": "window_days",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "maximum": 365,
              "minimum": 1,
              "description": "Time window in days",
              "default": 30,
              "title": "Window Days"
            },
            "description": "Time window in days"
          },
          {
            "name": "mode",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string",
              "description": "Special mode: networking|money",
              "title": "Mode"
            },
            "description": "Special mode: networking|money"
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/assistant/query": {
      "post": {
        "tags": [
          "assistant"
        ],
        "summary": "Assistant Query",
        "description": "Core entry point for Mailbox Assistant.\n\n1. Classify intent from payload.user_query (or chip text) - now with LLM fallback\n2. Run intent-specific query planners\n3. (optional) run mutations if mode==\"run\"\n4. Generate polished summary with LLM (if available)\n5. Return structured answer",
        "operationId": "assistant_query_assistant_query_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/AssistantQueryRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AssistantQueryResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/assistant/draft-reply": {
      "post": {
        "tags": [
          "assistant"
        ],
        "summary": "Draft Reply",
        "description": "Generate a polite follow-up reply draft for a specific email.\n\nThis is the \"close the loop\" feature that bridges:\nInbox  Tracker  Reply\n\nPerfect for job seekers to stay in the \"I'm actively interviewing\" loop.",
        "operationId": "draft_reply_assistant_draft_reply_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/DraftReplyRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/DraftReplyResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/emails/count": {
      "get": {
        "tags": [
          "emails"
        ],
        "summary": "Emails Count",
        "description": "Get total email count for current user.\n\nReturns:\n    {\"owner_email\": str, \"count\": int}",
        "operationId": "emails_count_emails_count_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        }
      }
    },
    "/emails/stats": {
      "get": {
        "tags": [
          "emails"
        ],
        "summary": "Emails Stats",
        "description": "Get detailed email statistics for current user.\n\nCached for 60 seconds. Returns:\n- total: Total email count\n- last_30d: Emails received in last 30 days\n- by_day: Daily counts for last 30 days\n- top_senders: Top 10 senders by email count\n- top_categories: Top 10 categories by email count",
        "operationId": "emails_stats_emails_stats_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        }
      }
    },
    "/flags/{flag}": {
      "get": {
        "tags": [
          "Feature Flags"
        ],
        "summary": "Get Flag",
        "description": "Get current feature flag configuration",
        "operationId": "get_flag_flags__flag__get",
        "parameters": [
          {
            "name": "flag",
            "in": "path",
            "required": true,
            "schema": {
              "enum": [
                "EmailRiskBanner",
                "EmailRiskDetails",
                "EmailRiskAdvice"
              ],
              "type": "string",
              "title": "Flag"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/FlagConfig"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/flags/": {
      "get": {
        "tags": [
          "Feature Flags"
        ],
        "summary": "List Flags",
        "description": "List all feature flags and their configurations",
        "operationId": "list_flags_flags__get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "additionalProperties": {
                    "$ref": "#/components/schemas/FlagConfig"
                  },
                  "type": "object",
                  "title": "Response List Flags Flags  Get"
                }
              }
            }
          }
        }
      }
    },
    "/flags/{flag}/ramp": {
      "post": {
        "tags": [
          "Feature Flags"
        ],
        "summary": "Ramp Flag",
        "description": "Ramp a feature flag to a new rollout percentage.\n\nArgs:\n    flag: Feature flag name (EmailRiskBanner, EmailRiskDetails, EmailRiskAdvice)\n    to: Target rollout percentage (0-100)\n\nReturns:\n    Audit event with before/after percentages\n\nExample:\n    POST /flags/EmailRiskBanner/ramp?to=25",
        "operationId": "ramp_flag_flags__flag__ramp_post",
        "parameters": [
          {
            "name": "flag",
            "in": "path",
            "required": true,
            "schema": {
              "enum": [
                "EmailRiskBanner",
                "EmailRiskDetails",
                "EmailRiskAdvice"
              ],
              "type": "string",
              "title": "Flag"
            }
          },
          {
            "name": "to",
            "in": "query",
            "required": true,
            "schema": {
              "type": "integer",
              "maximum": 100,
              "minimum": 0,
              "title": "To"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/RampEvent"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/flags/{flag}/enable": {
      "post": {
        "tags": [
          "Feature Flags"
        ],
        "summary": "Enable Flag",
        "description": "Enable a feature flag globally",
        "operationId": "enable_flag_flags__flag__enable_post",
        "parameters": [
          {
            "name": "flag",
            "in": "path",
            "required": true,
            "schema": {
              "enum": [
                "EmailRiskBanner",
                "EmailRiskDetails",
                "EmailRiskAdvice"
              ],
              "type": "string",
              "title": "Flag"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/FlagConfig"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/flags/{flag}/disable": {
      "post": {
        "tags": [
          "Feature Flags"
        ],
        "summary": "Disable Flag",
        "description": "Disable a feature flag globally (emergency kill switch)",
        "operationId": "disable_flag_flags__flag__disable_post",
        "parameters": [
          {
            "name": "flag",
            "in": "path",
            "required": true,
            "schema": {
              "enum": [
                "EmailRiskBanner",
                "EmailRiskDetails",
                "EmailRiskAdvice"
              ],
              "type": "string",
              "title": "Flag"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/FlagConfig"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/flags/{flag}/audit": {
      "get": {
        "tags": [
          "Feature Flags"
        ],
        "summary": "Get Audit Log",
        "description": "Get audit log for a specific feature flag",
        "operationId": "get_audit_log_flags__flag__audit_get",
        "parameters": [
          {
            "name": "flag",
            "in": "path",
            "required": true,
            "schema": {
              "enum": [
                "EmailRiskBanner",
                "EmailRiskDetails",
                "EmailRiskAdvice"
              ],
              "type": "string",
              "title": "Flag"
            }
          },
          {
            "name": "limit",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "default": 50,
              "title": "Limit"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/RampEvent"
                  },
                  "title": "Response Get Audit Log Flags  Flag  Audit Get"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/flags/audit/all": {
      "get": {
        "tags": [
          "Feature Flags"
        ],
        "summary": "Get All Audit Logs",
        "description": "Get audit log for all feature flags",
        "operationId": "get_all_audit_logs_flags_audit_all_get",
        "parameters": [
          {
            "name": "limit",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "default": 100,
              "title": "Limit"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/RampEvent"
                  },
                  "title": "Response Get All Audit Logs Flags Audit All Get"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/money/receipts.csv": {
      "get": {
        "tags": [
          "money"
        ],
        "summary": "Receipts Csv",
        "description": "Export all receipt emails as CSV.\n\nFinds emails that match receipt heuristics:\n- Subject contains: receipt, invoice, order, payment\n- Category is finance\n- Sender is known payment processor\n\nReturns:\n    CSV file with columns: date, merchant, amount, email_id, subject, category",
        "operationId": "receipts_csv_money_receipts_csv_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        }
      }
    },
    "/money/duplicates": {
      "get": {
        "tags": [
          "money"
        ],
        "summary": "Find Duplicates",
        "description": "Find potential duplicate charges.\n\nA duplicate is defined as:\n- Same merchant (sender_domain)\n- Same amount\n- Within N days of each other\n\nArgs:\n    window_days: Time window for duplicate detection (default 7 days)\n\nReturns:\n    {\n        \"duplicates\": [\n            {\n                \"merchant\": \"amazon.com\",\n                \"amount\": 49.99,\n                \"earlier\": {...},\n                \"later\": {...},\n                \"days_apart\": 2\n            }\n        ],\n        \"count\": 5\n    }",
        "operationId": "find_duplicates_money_duplicates_get",
        "parameters": [
          {
            "name": "window_days",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "default": 7,
              "title": "Window Days"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "additionalProperties": true,
                  "title": "Response Find Duplicates Money Duplicates Get"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/money/summary": {
      "get": {
        "tags": [
          "money"
        ],
        "summary": "Spending Summary",
        "description": "Get spending summary from receipt emails.\n\nReturns:\n    {\n        \"total_amount\": 1234.56,\n        \"count\": 42,\n        \"by_merchant\": {\"amazon.com\": 500.0, \"uber.com\": 234.56},\n        \"by_month\": {\"2025-10\": 800.0, \"2025-09\": 434.56},\n        \"avg_amount\": 29.39\n    }",
        "operationId": "spending_summary_money_summary_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "additionalProperties": true,
                  "type": "object",
                  "title": "Response Spending Summary Money Summary Get"
                }
              }
            }
          }
        }
      }
    },
    "/metrics/profile/activity_daily": {
      "get": {
        "tags": [
          "metrics",
          "warehouse"
        ],
        "summary": "Get Activity Daily",
        "description": "Get daily email activity metrics.\n\nReturns:\n- day: Date\n- messages_count: Total messages\n- unique_senders: Count of unique senders\n- avg_size_kb: Average message size in KB\n- total_size_mb: Total size in MB\n\nCache: 5 minutes\nSource: mart_email_activity_daily (dbt model)",
        "operationId": "get_activity_daily_metrics_profile_activity_daily_get",
        "parameters": [
          {
            "name": "days",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "maximum": 365,
              "minimum": 1,
              "default": 90,
              "title": "Days"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/metrics/profile/top_senders_30d": {
      "get": {
        "tags": [
          "metrics",
          "warehouse"
        ],
        "summary": "Get Top Senders 30D",
        "description": "Get top email senders in the last 30 days.\n\nReturns:\n- from_email: Sender email\n- messages_30d: Message count\n- total_size_mb: Total size\n- first_message_at: First message timestamp\n- last_message_at: Last message timestamp\n- active_days: Days between first and last message\n\nCache: 5 minutes\nSource: mart_top_senders_30d (dbt model)",
        "operationId": "get_top_senders_30d_metrics_profile_top_senders_30d_get",
        "parameters": [
          {
            "name": "limit",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "maximum": 100,
              "minimum": 1,
              "default": 20,
              "title": "Limit"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/metrics/profile/categories_30d": {
      "get": {
        "tags": [
          "metrics",
          "warehouse"
        ],
        "summary": "Get Categories 30D",
        "description": "Get email category distribution in the last 30 days.\n\nReturns:\n- category: Gmail category (promotions, updates, social, forums, primary)\n- messages_30d: Message count\n- pct_of_total: Percentage of total\n- total_size_mb: Total size\n\nCache: 5 minutes\nSource: mart_categories_30d (dbt model)",
        "operationId": "get_categories_30d_metrics_profile_categories_30d_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        }
      }
    },
    "/metrics/profile/freshness": {
      "get": {
        "tags": [
          "metrics",
          "warehouse"
        ],
        "summary": "Get Data Freshness",
        "description": "Get data freshness metrics from Fivetran sync.\n\nReturns:\n- last_sync_at: Last Fivetran sync timestamp\n- minutes_since_sync: Minutes since last sync\n- is_fresh: True if synced within 30 minutes (SLO)\n\nCache: 1 minute",
        "operationId": "get_data_freshness_metrics_profile_freshness_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        }
      }
    },
    "/metrics/profile/summary": {
      "get": {
        "tags": [
          "metrics",
          "warehouse"
        ],
        "summary": "Get Profile Summary",
        "description": "Unified profile summary aggregating warehouse mart data.\n\nReturns:\n- account: User email address\n- last_sync_at: ISO8601 timestamp of most recent warehouse sync (from BigQuery data)\n- dataset: Dataset/table prefix being queried for debugging\n- totals: all_time_emails, last_30d_emails\n- top_senders_30d: Top 3 senders (sender, email, count)\n- top_categories_30d: Top 3 categories (category, count)\n- top_interests: Top 3 interests/keywords (keyword, count)\n\nCache: 60 seconds\nError handling: Returns 200 with empty arrays on failure (graceful degradation)",
        "operationId": "get_profile_summary_metrics_profile_summary_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        }
      }
    },
    "/warehouse/profile/top-senders": {
      "get": {
        "tags": [
          "warehouse",
          "analytics"
        ],
        "summary": "Top email senders (30 days)",
        "description": "Get top email senders in the last 30 days from BigQuery warehouse.\n\nRequires USE_WAREHOUSE=1 environment variable.\nResults are cached for 60 seconds.\n\nArgs:\n    limit: Maximum number of senders to return (default: 10, max: 100)\n\nReturns:\n    List of sender metrics with keys:\n    - from_email: Sender email address\n    - messages_30d: Number of messages in last 30 days\n    - total_size_mb: Total size in MB\n    - first_message_at: Timestamp of first message\n    - last_message_at: Timestamp of last message\n    - active_days: Number of days between first and last message\n\nExample:\n    ```\n    GET /api/warehouse/profile/top-senders?limit=5\n\n    [\n        {\n            \"from_email\": \"jobs-noreply@linkedin.com\",\n            \"messages_30d\": 42,\n            \"total_size_mb\": 1.5,\n            \"first_message_at\": \"2025-09-18T10:00:00+00:00\",\n            \"last_message_at\": \"2025-10-18T15:30:00+00:00\",\n            \"active_days\": 30\n        },\n        ...\n    ]\n    ```",
        "operationId": "top_senders_warehouse_profile_top_senders_get",
        "parameters": [
          {
            "name": "limit",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "default": 10,
              "title": "Limit"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "additionalProperties": true
                  },
                  "title": "Response Top Senders Warehouse Profile Top Senders Get"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/warehouse/profile/activity-daily": {
      "get": {
        "tags": [
          "warehouse",
          "analytics"
        ],
        "summary": "Daily email activity",
        "description": "Get daily email activity from BigQuery warehouse.\n\nRequires USE_WAREHOUSE=1 environment variable.\nResults are cached for 60 seconds.\n\nArgs:\n    days: Number of days to retrieve (default: 14, max: 90)\n\nReturns:\n    List of daily metrics with keys:\n    - day: Date string (YYYY-MM-DD)\n    - messages_count: Number of messages received\n    - unique_senders: Number of unique senders\n    - avg_size_kb: Average message size in KB\n    - total_size_mb: Total size in MB\n\nExample:\n    ```\n    GET /api/warehouse/profile/activity-daily?days=7\n\n    [\n        {\n            \"day\": \"2025-10-18\",\n            \"messages_count\": 35,\n            \"unique_senders\": 12,\n            \"avg_size_kb\": 45.2,\n            \"total_size_mb\": 1.5\n        },\n        ...\n    ]\n    ```",
        "operationId": "activity_daily_warehouse_profile_activity_daily_get",
        "parameters": [
          {
            "name": "days",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "default": 14,
              "title": "Days"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "additionalProperties": true
                  },
                  "title": "Response Activity Daily Warehouse Profile Activity Daily Get"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/warehouse/profile/categories-30d": {
      "get": {
        "tags": [
          "warehouse",
          "analytics"
        ],
        "summary": "Email category distribution (30 days)",
        "description": "Get email category distribution in last 30 days from BigQuery warehouse.\n\nRequires USE_WAREHOUSE=1 environment variable.\nResults are cached for 60 seconds.\n\nArgs:\n    limit: Maximum number of categories to return (default: 10)\n\nReturns:\n    List of category metrics with keys:\n    - category: Category name (primary, promotions, updates, social, forums)\n    - messages_30d: Number of messages in last 30 days\n    - pct_of_total: Percentage of total messages\n    - total_size_mb: Total size in MB\n\nExample:\n    ```\n    GET /api/warehouse/profile/categories-30d?limit=5\n\n    [\n        {\n            \"category\": \"promotions\",\n            \"messages_30d\": 150,\n            \"pct_of_total\": 45.5,\n            \"total_size_mb\": 12.3\n        },\n        ...\n    ]\n    ```",
        "operationId": "categories_30d_warehouse_profile_categories_30d_get",
        "parameters": [
          {
            "name": "limit",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "default": 10,
              "title": "Limit"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "additionalProperties": true
                  },
                  "title": "Response Categories 30D Warehouse Profile Categories 30D Get"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/warehouse/profile/divergence-24h": {
      "get": {
        "tags": [
          "warehouse",
          "analytics"
        ],
        "summary": "Data divergence between ES and BQ",
        "description": "Check data consistency between Elasticsearch and BigQuery for last 24 hours.\n\nRequires USE_WAREHOUSE=1 environment variable.\nResults are cached for 300 seconds (5 minutes).\n\nReturns:\n    Dict with divergence metrics:\n    - es_count: Count from Elasticsearch\n    - bq_count: Count from BigQuery warehouse\n    - divergence: Absolute divergence ratio\n    - divergence_pct: Divergence as percentage\n    - slo_met: Boolean, True if divergence < 2% (SLO)\n    - status: \"healthy\" | \"warning\" | \"critical\"\n    - message: Human-readable status message\n\nExample:\n    ```\n    GET /api/warehouse/profile/divergence-24h\n\n    {\n        \"es_count\": 100,\n        \"bq_count\": 98,\n        \"divergence\": 0.02,\n        \"divergence_pct\": 2.0,\n        \"slo_met\": True,\n        \"status\": \"healthy\",\n        \"message\": \"Divergence: 2.00% (within SLO)\"\n    }\n    ```\n\nSLO Thresholds:\n    - < 2%: healthy (green)\n    - 2-5%: warning (amber)\n    - > 5%: critical (red)",
        "operationId": "divergence_24h_warehouse_profile_divergence_24h_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "additionalProperties": true,
                  "type": "object",
                  "title": "Response Divergence 24H Warehouse Profile Divergence 24H Get"
                }
              }
            }
          }
        }
      }
    },
    "/agents/feedback": {
      "post": {
        "tags": [
          "agents"
        ],
        "summary": "Submit Feedback",
        "description": "Submit user feedback on an agent run.\n\nThis helps track user satisfaction and quality signals.",
        "operationId": "submit_feedback_agents_feedback_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/FeedbackRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/FeedbackResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/agents/metrics/{agent}": {
      "get": {
        "tags": [
          "agents"
        ],
        "summary": "Get Agent Metrics",
        "description": "Get aggregated metrics for an agent over a date range.",
        "operationId": "get_agent_metrics_agents_metrics__agent__get",
        "parameters": [
          {
            "name": "agent",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "title": "Agent"
            }
          },
          {
            "name": "start_date",
            "in": "query",
            "required": false,
            "schema": {
              "anyOf": [
                {
                  "type": "string",
                  "format": "date-time"
                },
                {
                  "type": "null"
                }
              ],
              "description": "Start date (default: 7 days ago)",
              "title": "Start Date"
            },
            "description": "Start date (default: 7 days ago)"
          },
          {
            "name": "end_date",
            "in": "query",
            "required": false,
            "schema": {
              "anyOf": [
                {
                  "type": "string",
                  "format": "date-time"
                },
                {
                  "type": "null"
                }
              ],
              "description": "End date (default: today)",
              "title": "End Date"
            },
            "description": "End date (default: today)"
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AgentMetricsResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/agents/health": {
      "get": {
        "tags": [
          "agents"
        ],
        "summary": "Get All Agents Health",
        "description": "Get health status across all agents.\n\nReturns overall health and per-agent status.",
        "operationId": "get_all_agents_health_agents_health_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AllAgentsHealthResponse"
                }
              }
            }
          }
        }
      }
    },
    "/agents/redteam/run": {
      "post": {
        "tags": [
          "agents"
        ],
        "summary": "Run Redteam Evaluation",
        "description": "Run red-team adversarial evaluation.\n\nTests agent robustness against:\n- Edge cases\n- Evasion attacks\n- Boundary conditions\n- Stress tests",
        "operationId": "run_redteam_evaluation_agents_redteam_run_post",
        "parameters": [
          {
            "name": "agent",
            "in": "query",
            "required": false,
            "schema": {
              "anyOf": [
                {
                  "type": "string"
                },
                {
                  "type": "null"
                }
              ],
              "description": "Specific agent to test (default: all)",
              "title": "Agent"
            },
            "description": "Specific agent to test (default: all)"
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/RedTeamRunResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/budgets/": {
      "get": {
        "tags": [
          "budgets"
        ],
        "summary": "List Budgets",
        "description": "List all agent budgets.\n\nReturns default budgets (customization not implemented yet).",
        "operationId": "list_budgets_budgets__get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "additionalProperties": {
                    "$ref": "#/components/schemas/BudgetResponse"
                  },
                  "type": "object",
                  "title": "Response List Budgets Budgets  Get"
                }
              }
            }
          }
        }
      }
    },
    "/budgets/{agent}": {
      "get": {
        "tags": [
          "budgets"
        ],
        "summary": "Get Budget",
        "description": "Get budget for specific agent.\n\nArgs:\n    agent: Agent identifier\n    \nReturns:\n    Budget configuration",
        "operationId": "get_budget_budgets__agent__get",
        "parameters": [
          {
            "name": "agent",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "title": "Agent"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/BudgetResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/budgets/evaluate": {
      "post": {
        "tags": [
          "budgets"
        ],
        "summary": "Evaluate Gates",
        "description": "Run gate evaluation against budgets.\n\nEvaluates agent metrics against budget thresholds and baseline.\nUsed in CI to fail builds on regressions.\n\nArgs:\n    request: Evaluation parameters\n    db: Database session\n    \nReturns:\n    Evaluation results with violations",
        "operationId": "evaluate_gates_budgets_evaluate_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/EvaluateRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EvaluationResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/budgets/violations/recent": {
      "get": {
        "tags": [
          "budgets"
        ],
        "summary": "Get Recent Violations",
        "description": "Get recent budget violations.\n\nArgs:\n    agent: Optional agent filter\n    severity: Optional severity filter (critical, error, warning)\n    days: Days to look back\n    db: Database session\n    \nReturns:\n    List of recent violations",
        "operationId": "get_recent_violations_budgets_violations_recent_get",
        "parameters": [
          {
            "name": "agent",
            "in": "query",
            "required": false,
            "schema": {
              "anyOf": [
                {
                  "type": "string"
                },
                {
                  "type": "null"
                }
              ],
              "description": "Filter by agent",
              "title": "Agent"
            },
            "description": "Filter by agent"
          },
          {
            "name": "severity",
            "in": "query",
            "required": false,
            "schema": {
              "anyOf": [
                {
                  "type": "string"
                },
                {
                  "type": "null"
                }
              ],
              "description": "Filter by severity",
              "title": "Severity"
            },
            "description": "Filter by severity"
          },
          {
            "name": "days",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "maximum": 90,
              "minimum": 1,
              "description": "Days to look back",
              "default": 7,
              "title": "Days"
            },
            "description": "Days to look back"
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/ViolationSchema"
                  },
                  "title": "Response Get Recent Violations Budgets Violations Recent Get"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/budgets/evaluate/report": {
      "post": {
        "tags": [
          "budgets"
        ],
        "summary": "Evaluate Gates Report",
        "description": "Run gate evaluation and return formatted report.\n\nReturns human-readable markdown report suitable for:\n- CI output\n- Slack notifications\n- Email alerts\n\nArgs:\n    request: Evaluation parameters\n    db: Database session\n    \nReturns:\n    Markdown formatted report",
        "operationId": "evaluate_gates_report_budgets_evaluate_report_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/EvaluateRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/intelligence/report/generate": {
      "post": {
        "tags": [
          "intelligence"
        ],
        "summary": "Generate Report",
        "description": "Generate intelligence report for specified week.\n\nReturns markdown or HTML formatted report with:\n- Quality trends\n- Budget violations\n- Invariant status\n- Red team results\n- Recommendations",
        "operationId": "generate_report_intelligence_report_generate_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ReportRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ReportResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/intelligence/report/latest": {
      "get": {
        "tags": [
          "intelligence"
        ],
        "summary": "Get Latest Report",
        "description": "Get latest intelligence report (current week).\n\nGenerates report for the current week (last Monday to today).",
        "operationId": "get_latest_report_intelligence_report_latest_get",
        "parameters": [
          {
            "name": "format",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string",
              "description": "Output format: 'markdown' or 'html'",
              "default": "markdown",
              "title": "Format"
            },
            "description": "Output format: 'markdown' or 'html'"
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ReportResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/intelligence/report/summary": {
      "get": {
        "tags": [
          "intelligence"
        ],
        "summary": "Get Report Summary",
        "description": "Get summary of report without full content.\n\nUseful for dashboard widgets showing current status.",
        "operationId": "get_report_summary_intelligence_report_summary_get",
        "parameters": [
          {
            "name": "week_start",
            "in": "query",
            "required": false,
            "schema": {
              "anyOf": [
                {
                  "type": "string",
                  "format": "date-time"
                },
                {
                  "type": "null"
                }
              ],
              "description": "Week start date (Monday)",
              "title": "Week Start"
            },
            "description": "Week start date (Monday)"
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ReportSummary"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/intelligence/report/history": {
      "get": {
        "tags": [
          "intelligence"
        ],
        "summary": "Get Report History",
        "description": "Get historical report summaries.\n\nReturns summary statistics for the past N weeks.\nUseful for trending and historical analysis.",
        "operationId": "get_report_history_intelligence_report_history_get",
        "parameters": [
          {
            "name": "weeks",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "maximum": 52,
              "minimum": 1,
              "description": "Number of weeks to retrieve",
              "default": 4,
              "title": "Weeks"
            },
            "description": "Number of weeks to retrieve"
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/ReportSummary"
                  },
                  "title": "Response Get Report History Intelligence Report History Get"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/intelligence/report/notify": {
      "post": {
        "tags": [
          "intelligence"
        ],
        "summary": "Notify Report",
        "description": "Generate and send report via Slack/email.\n\nRequires either slack_webhook or email_recipients.",
        "operationId": "notify_report_intelligence_report_notify_post",
        "parameters": [
          {
            "name": "week_start",
            "in": "query",
            "required": false,
            "schema": {
              "anyOf": [
                {
                  "type": "string",
                  "format": "date-time"
                },
                {
                  "type": "null"
                }
              ],
              "title": "Week Start"
            }
          },
          {
            "name": "slack_webhook",
            "in": "query",
            "required": false,
            "schema": {
              "anyOf": [
                {
                  "type": "string"
                },
                {
                  "type": "null"
                }
              ],
              "title": "Slack Webhook"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "anyOf": [
                  {
                    "type": "array",
                    "items": {
                      "type": "string"
                    }
                  },
                  {
                    "type": "null"
                  }
                ],
                "title": "Email Recipients"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/metrics/export": {
      "post": {
        "tags": [
          "metrics"
        ],
        "summary": "Export Metrics",
        "description": "Export agent evaluation metrics to Prometheus.\n\nThis endpoint updates Prometheus gauges and counters with the latest\nagent metrics from the database. Call this periodically (e.g., every 30s)\nor trigger on-demand.\n\nThe metrics are then scraped by Prometheus and displayed in Grafana.",
        "operationId": "export_metrics_metrics_export_post",
        "parameters": [
          {
            "name": "lookback_days",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "maximum": 30,
              "minimum": 1,
              "description": "Days to export",
              "default": 1,
              "title": "Lookback Days"
            },
            "description": "Days to export"
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/MetricsExportResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/metrics/dashboard/status": {
      "get": {
        "tags": [
          "metrics"
        ],
        "summary": "Get Dashboard Status",
        "description": "Get current dashboard status for UI widgets.\n\nReturns summary statistics for displaying in web dashboards\nor status pages.",
        "operationId": "get_dashboard_status_metrics_dashboard_status_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/DashboardStatus"
                }
              }
            }
          }
        }
      }
    },
    "/metrics/alerts/summary": {
      "get": {
        "tags": [
          "metrics"
        ],
        "summary": "Get Alert Summary",
        "description": "Get summary of active alerts.\n\nNote: This is a simplified version. In production, you'd query\nPrometheus Alertmanager API for actual active alerts.\n\nFor now, we derive alerts from budget violations.",
        "operationId": "get_alert_summary_metrics_alerts_summary_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AlertSummary"
                }
              }
            }
          }
        }
      }
    },
    "/api/active/stats/labeled": {
      "get": {
        "tags": [
          "active_learning"
        ],
        "summary": "Get Labeled Stats",
        "description": "Get statistics on labeled training data.",
        "operationId": "get_labeled_stats_api_active_stats_labeled_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/LabeledStatsResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/active/feeds/load": {
      "post": {
        "tags": [
          "active_learning"
        ],
        "summary": "Load Feeds",
        "description": "Manually trigger feed loading from all sources.",
        "operationId": "load_feeds_api_active_feeds_load_post",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        }
      }
    },
    "/api/active/bundles/create": {
      "post": {
        "tags": [
          "active_learning"
        ],
        "summary": "Create Bundle",
        "description": "Train a new config bundle for an agent.",
        "operationId": "create_bundle_api_active_bundles_create_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/BundleCreateRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/BundleCreateResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/api/active/bundles/propose": {
      "post": {
        "tags": [
          "active_learning"
        ],
        "summary": "Propose Bundle",
        "description": "Propose a bundle for approval.",
        "operationId": "propose_bundle_api_active_bundles_propose_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/BundleProposeRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/BundleProposeResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/api/active/bundles/{agent}/active": {
      "get": {
        "tags": [
          "active_learning"
        ],
        "summary": "Get Active Bundle",
        "description": "Get the currently active bundle for an agent.",
        "operationId": "get_active_bundle_api_active_bundles__agent__active_get",
        "parameters": [
          {
            "name": "agent",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "title": "Agent"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/api/active/approvals/pending": {
      "get": {
        "tags": [
          "active_learning"
        ],
        "summary": "List Pending Approvals",
        "description": "List all pending bundle approvals.",
        "operationId": "list_pending_approvals_api_active_approvals_pending_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        }
      }
    },
    "/api/active/approvals/{approval_id}/approve": {
      "post": {
        "tags": [
          "active_learning"
        ],
        "summary": "Approve Bundle",
        "description": "Approve a pending bundle.",
        "operationId": "approve_bundle_api_active_approvals__approval_id__approve_post",
        "parameters": [
          {
            "name": "approval_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "title": "Approval Id"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ApprovalActionRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApprovalActionResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/api/active/approvals/{approval_id}/reject": {
      "post": {
        "tags": [
          "active_learning"
        ],
        "summary": "Reject Bundle",
        "description": "Reject a pending bundle.",
        "operationId": "reject_bundle_api_active_approvals__approval_id__reject_post",
        "parameters": [
          {
            "name": "approval_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "title": "Approval Id"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ApprovalActionRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApprovalActionResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/api/active/approvals/{approval_id}/apply": {
      "post": {
        "tags": [
          "active_learning"
        ],
        "summary": "Apply Bundle",
        "description": "Apply an approved bundle (with optional canary deployment).",
        "operationId": "apply_bundle_api_active_approvals__approval_id__apply_post",
        "parameters": [
          {
            "name": "approval_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "title": "Approval Id"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/BundleApplyRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/BundleApplyResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/api/active/canaries/active": {
      "get": {
        "tags": [
          "active_learning"
        ],
        "summary": "List Active Canaries",
        "description": "List all active canary deployments.",
        "operationId": "list_active_canaries_api_active_canaries_active_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        }
      }
    },
    "/api/active/canaries/{agent}/performance": {
      "get": {
        "tags": [
          "active_learning"
        ],
        "summary": "Check Canary Performance",
        "description": "Check canary performance and get recommendation.",
        "operationId": "check_canary_performance_api_active_canaries__agent__performance_get",
        "parameters": [
          {
            "name": "agent",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "title": "Agent"
            }
          },
          {
            "name": "lookback_hours",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "maximum": 168,
              "minimum": 1,
              "default": 24,
              "title": "Lookback Hours"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CanaryPerformanceResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/api/active/canaries/{agent}/promote": {
      "post": {
        "tags": [
          "active_learning"
        ],
        "summary": "Promote Canary",
        "description": "Promote canary to higher traffic percentage.",
        "operationId": "promote_canary_api_active_canaries__agent__promote_post",
        "parameters": [
          {
            "name": "agent",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "title": "Agent"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CanaryPromoteRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/api/active/canaries/{agent}/rollback": {
      "post": {
        "tags": [
          "active_learning"
        ],
        "summary": "Rollback Canary",
        "description": "Rollback canary deployment.",
        "operationId": "rollback_canary_api_active_canaries__agent__rollback_post",
        "parameters": [
          {
            "name": "agent",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "title": "Agent"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/api/active/weights": {
      "get": {
        "tags": [
          "active_learning"
        ],
        "summary": "Get All Judge Weights",
        "description": "Get judge weights for all agents.",
        "operationId": "get_all_judge_weights_api_active_weights_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        }
      }
    },
    "/api/active/weights/{agent}": {
      "get": {
        "tags": [
          "active_learning"
        ],
        "summary": "Get Judge Weights",
        "description": "Get judge weights for a specific agent.",
        "operationId": "get_judge_weights_api_active_weights__agent__get",
        "parameters": [
          {
            "name": "agent",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "title": "Agent"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/api/active/weights/update": {
      "post": {
        "tags": [
          "active_learning"
        ],
        "summary": "Update Judge Weights",
        "description": "Manually trigger judge weight update for all agents.",
        "operationId": "update_judge_weights_api_active_weights_update_post",
        "parameters": [
          {
            "name": "lookback_days",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "maximum": 90,
              "minimum": 7,
              "default": 30,
              "title": "Lookback Days"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/api/active/review/queue": {
      "get": {
        "tags": [
          "active_learning"
        ],
        "summary": "Get Review Queue",
        "description": "Get uncertain predictions for human review.",
        "operationId": "get_review_queue_api_active_review_queue_get",
        "parameters": [
          {
            "name": "agent",
            "in": "query",
            "required": false,
            "schema": {
              "anyOf": [
                {
                  "type": "string"
                },
                {
                  "type": "null"
                }
              ],
              "title": "Agent"
            }
          },
          {
            "name": "top_n",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "maximum": 500,
              "minimum": 1,
              "default": 50,
              "title": "Top N"
            }
          },
          {
            "name": "min_uncertainty",
            "in": "query",
            "required": false,
            "schema": {
              "type": "number",
              "maximum": 1.0,
              "minimum": 0.0,
              "default": 0.5,
              "title": "Min Uncertainty"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/api/active/review/stats": {
      "get": {
        "tags": [
          "active_learning"
        ],
        "summary": "Get Review Queue Stats",
        "description": "Get review queue statistics.",
        "operationId": "get_review_queue_stats_api_active_review_stats_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ReviewQueueStatsResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/active/pause": {
      "post": {
        "tags": [
          "active_learning"
        ],
        "summary": "Pause Active Learning",
        "description": "Pause active learning (stops all nightly jobs).",
        "operationId": "pause_active_learning_api_active_pause_post",
        "parameters": [
          {
            "name": "reason",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string",
              "description": "Reason for pausing",
              "title": "Reason"
            },
            "description": "Reason for pausing"
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/api/active/resume": {
      "post": {
        "tags": [
          "active_learning"
        ],
        "summary": "Resume Active Learning",
        "description": "Resume active learning.",
        "operationId": "resume_active_learning_api_active_resume_post",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        }
      }
    },
    "/api/active/status": {
      "get": {
        "tags": [
          "active_learning"
        ],
        "summary": "Get Active Learning Status",
        "description": "Get overall active learning system status.",
        "operationId": "get_active_learning_status_api_active_status_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        }
      }
    },
    "/mail/actions/preview": {
      "post": {
        "tags": [
          "mail-tools"
        ],
        "summary": "Preview Actions",
        "description": "Preview actions before execution (dry-run with safety checks)\n\nThis endpoint:\n- Validates each action\n- Applies safety guardrails\n- Returns what would happen WITHOUT making changes\n\nUse this to show users what the automation will do.",
        "operationId": "preview_actions_mail_actions_preview_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "items": {
                  "$ref": "#/components/schemas/Action"
                },
                "type": "array",
                "title": "Actions"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "additionalProperties": true,
                  "type": "object",
                  "title": "Response Preview Actions Mail Actions Preview Post"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/mail/actions/execute": {
      "post": {
        "tags": [
          "mail-tools"
        ],
        "summary": "Execute Actions",
        "description": "Execute approved actions on emails\n\nThis endpoint:\n- Re-validates actions (same safety checks as preview)\n- Applies approved actions\n- Logs everything to actions_audit table\n- Returns results\n\nIMPORTANT: This makes real changes! Use preview first.\n\nArgs:\n    actions: List of actions to execute\n    actor: Who is taking the action (\"agent\" for automation, \"user\" for manual)",
        "operationId": "execute_actions_mail_actions_execute_post",
        "parameters": [
          {
            "name": "actor",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string",
              "default": "agent",
              "title": "Actor"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "array",
                "items": {
                  "$ref": "#/components/schemas/Action"
                },
                "title": "Actions"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ActionExecuteResult"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/mail/actions/history/{email_id}": {
      "get": {
        "tags": [
          "mail-tools"
        ],
        "summary": "Get Action History",
        "description": "Get action history for a specific email\n\nReturns all actions taken on this email (manual and automated)",
        "operationId": "get_action_history_mail_actions_history__email_id__get",
        "parameters": [
          {
            "name": "email_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "title": "Email Id"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/mail/suggest-actions": {
      "post": {
        "tags": [
          "mail-tools"
        ],
        "summary": "Suggest Actions",
        "description": "Use policy engine to suggest actions for given emails\n\nThis is an AI assistant endpoint that:\n1. Fetches emails from database\n2. Runs them through the policy engine\n3. Returns recommended actions\n\nUsers can then review and approve via /actions/execute",
        "operationId": "suggest_actions_mail_suggest_actions_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "items": {
                  "type": "string"
                },
                "type": "array",
                "title": "Email Ids"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/unsubscribe/preview": {
      "post": {
        "tags": [
          "unsubscribe"
        ],
        "summary": "Preview Unsubscribe",
        "description": "Preview an unsubscribe operation without executing it.\n\nParses List-Unsubscribe headers and shows what action would be taken,\nbut does not actually perform any network operations.\n\nArgs:\n    req: UnsubRequest with email_id and headers\n\nReturns:\n    Dictionary with email_id and result showing available targets\n\nExample:\n    POST /unsubscribe/preview\n    {\n        \"email_id\": \"msg123\",\n        \"headers\": {\n            \"List-Unsubscribe\": \"<mailto:unsub@example.com>, <https://example.com/unsub?id=123>\"\n        }\n    }\n\n    Response:\n    {\n        \"email_id\": \"msg123\",\n        \"result\": {\n            \"mailto\": \"unsub@example.com\",\n            \"http\": \"https://example.com/unsub?id=123\",\n            \"performed\": null,\n            \"status\": null\n        }\n    }",
        "operationId": "preview_unsubscribe_unsubscribe_preview_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UnsubRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/unsubscribe/execute": {
      "post": {
        "tags": [
          "unsubscribe"
        ],
        "summary": "Execute Unsubscribe",
        "description": "Execute an unsubscribe operation.\n\nParses List-Unsubscribe headers and performs the unsubscribe action.\nPrefers HTTP unsubscribe (immediate), falls back to mailto (queued).\nAll operations are logged to the audit trail.\n\nArgs:\n    req: UnsubRequest with email_id and headers\n\nReturns:\n    Dictionary with email_id and result showing what was performed\n\nRaises:\n    HTTPException(400): If no List-Unsubscribe targets are found\n\nExample:\n    POST /unsubscribe/execute\n    {\n        \"email_id\": \"msg123\",\n        \"headers\": {\n            \"List-Unsubscribe\": \"<https://example.com/unsub?id=123>\"\n        }\n    }\n\n    Response:\n    {\n        \"email_id\": \"msg123\",\n        \"result\": {\n            \"mailto\": null,\n            \"http\": \"https://example.com/unsub?id=123\",\n            \"performed\": \"http\",\n            \"status\": 200\n        }\n    }",
        "operationId": "execute_unsubscribe_unsubscribe_execute_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UnsubRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/nl/run": {
      "post": {
        "tags": [
          "nl-agent"
        ],
        "summary": "Run",
        "description": "Execute a natural language command.\n\nParses the user's text, identifies the intent, and routes to the\nappropriate email automation action. Returns proposed actions that\ncan be previewed or executed.\n\nArgs:\n    query: NLQuery with text command\n\nReturns:\n    Dictionary with:\n    - intent: Identified intent\n    - proposed_actions: List of actions to take (if applicable)\n    - emails: List of matching emails (if applicable)\n    - count: Number of results\n    - message: Help text (for fallback)\n\nExamples:\n    POST /nl/run\n    {\"text\": \"clean my promos older than 7 days\"}\n\n    Response:\n    {\n        \"intent\": \"clean_promos\",\n        \"proposed_actions\": [\n            {\n                \"email_id\": \"msg123\",\n                \"action\": \"archive\",\n                \"policy_id\": \"promo-expired-archive\",\n                \"confidence\": 0.8,\n                \"rationale\": \"expired promotion\"\n            }\n        ],\n        \"count\": 1\n    }",
        "operationId": "run_nl_run_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/NLQuery"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/policies/run": {
      "post": {
        "tags": [
          "policies"
        ],
        "summary": "Run Policies",
        "description": "Run a policy set against emails matching the ES filter.\n\nThis endpoint:\n1. Queries Elasticsearch with the provided filter\n2. Applies the policy set to each matching email\n3. Returns all proposed actions for user approval\n\nExample request:\n```json\n{\n  \"policy_set\": {\n    \"id\": \"cleanup-promos\",\n    \"policies\": [{\n      \"id\": \"promo-expired-archive\",\n      \"if\": {\n        \"all\": [\n          {\"field\": \"category\", \"op\": \"=\", \"value\": \"promotions\"},\n          {\"field\": \"expires_at\", \"op\": \"<\", \"value\": \"now\"}\n        ]\n      },\n      \"then\": {\n        \"action\": \"archive\",\n        \"confidence_min\": 0.8,\n        \"rationale\": \"expired promotion\"\n      }\n    }]\n  },\n  \"es_filter\": {\"term\": {\"category\": \"promotions\"}},\n  \"limit\": 300\n}\n```\n\nExample response:\n```json\n{\n  \"policy_set_id\": \"cleanup-promos\",\n  \"evaluated\": 150,\n  \"proposed_actions\": [\n    {\n      \"email_id\": \"email_123\",\n      \"action\": \"archive\",\n      \"policy_id\": \"promo-expired-archive\",\n      \"confidence\": 0.9,\n      \"rationale\": \"expired promotion\"\n    }\n  ]\n}\n```\n\nArgs:\n    req: PolicyRunRequest with policy set, ES filter, and optional limit\n\nReturns:\n    PolicyRunResponse with evaluated count and proposed actions\n\nRaises:\n    HTTPException: If search fails or returns invalid data",
        "operationId": "run_policies_policies_run_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/PolicyRunRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PolicyRunResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/approvals/propose": {
      "post": {
        "tags": [
          "approvals"
        ],
        "summary": "Propose",
        "description": "Propose actions for approval (from policy engine).\n\nThis endpoint receives proposed actions from the policy engine\n(/policies/run) and stores them for user review. All proposals\nare written to both Postgres and Elasticsearch for tracking.\n\nArgs:\n    payload: List of proposed actions with email_id, action, policy_id, etc.\n\nReturns:\n    {\"accepted\": count} - Number of proposals stored\n\nExample:\n    POST /approvals/propose\n    {\n      \"items\": [\n        {\n          \"email_id\": \"email_123\",\n          \"action\": \"archive\",\n          \"policy_id\": \"promo-expired-archive\",\n          \"confidence\": 0.9,\n          \"rationale\": \"expired promotion\"\n        }\n      ]\n    }",
        "operationId": "propose_approvals_propose_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/BulkPropose"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/approvals/proposed": {
      "get": {
        "tags": [
          "approvals"
        ],
        "summary": "List Proposed",
        "description": "List proposed actions awaiting approval.\n\nReturns all actions with status='proposed' sorted by creation time.\n\nArgs:\n    limit: Maximum number of records to return (default: 200)\n\nReturns:\n    {\"items\": [...]} - List of proposed actions\n\nExample:\n    GET /approvals/proposed?limit=50\n\n    Response:\n    {\n      \"items\": [\n        {\n          \"id\": 1,\n          \"email_id\": \"email_123\",\n          \"action\": \"archive\",\n          \"policy_id\": \"promo-expired-archive\",\n          \"confidence\": 0.9,\n          \"rationale\": \"expired promotion\",\n          \"params\": {},\n          \"status\": \"proposed\",\n          \"created_at\": \"2025-10-10T12:00:00Z\"\n        }\n      ]\n    }",
        "operationId": "list_proposed_approvals_proposed_get",
        "parameters": [
          {
            "name": "limit",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "default": 200,
              "title": "Limit"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/approvals/approve": {
      "post": {
        "tags": [
          "approvals"
        ],
        "summary": "Approve",
        "description": "Approve selected actions.\n\nChanges status from 'proposed' to 'approved' for the given IDs.\nApproved actions can then be executed via /approvals/execute.\n\nArgs:\n    payload: List of approval record IDs to approve\n\nReturns:\n    {\"updated\": count, \"status\": \"approved\"}\n\nExample:\n    POST /approvals/approve\n    {\n      \"ids\": [1, 2, 3]\n    }",
        "operationId": "approve_approvals_approve_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ApproveReject"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/approvals/reject": {
      "post": {
        "tags": [
          "approvals"
        ],
        "summary": "Reject",
        "description": "Reject selected actions.\n\nChanges status from 'proposed' to 'rejected' for the given IDs.\nRejected actions will not be executed.\n\nArgs:\n    payload: List of approval record IDs to reject\n\nReturns:\n    {\"updated\": count, \"status\": \"rejected\"}\n\nExample:\n    POST /approvals/reject\n    {\n      \"ids\": [4, 5]\n    }",
        "operationId": "reject_approvals_reject_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ApproveReject"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/approvals/execute": {
      "post": {
        "tags": [
          "approvals"
        ],
        "summary": "Execute",
        "description": "Execute approved actions.\n\nThis endpoint executes the approved actions by calling the appropriate\naction executors (mail_tools, unsubscribe, etc.). Actions are split\nby type and routed to the correct executor.\n\nArgs:\n    payload: List of approved actions to execute\n\nReturns:\n    {\"applied\": count} - Number of actions successfully executed\n\nExample:\n    POST /approvals/execute\n    {\n      \"items\": [\n        {\n          \"email_id\": \"email_123\",\n          \"action\": \"archive\",\n          \"policy_id\": \"promo-expired-archive\",\n          \"confidence\": 0.9,\n          \"rationale\": \"expired promotion\",\n          \"params\": {}\n        }\n      ]\n    }",
        "operationId": "execute_approvals_execute_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ExecuteRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/approvals/": {
      "post": {
        "tags": [
          "approvals"
        ],
        "summary": "Create Approval Request",
        "description": "Create a new approval request for an agent action.\n\nGenerates HMAC signature and nonce for secure approval links.",
        "operationId": "create_approval_request_approvals__post",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ApprovalRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApprovalResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      },
      "get": {
        "tags": [
          "approvals"
        ],
        "summary": "List Approvals",
        "description": "List approval requests with optional filters.\n\nReturns pending, approved, rejected, canceled, and expired requests.",
        "operationId": "list_approvals_approvals__get",
        "parameters": [
          {
            "name": "status",
            "in": "query",
            "required": false,
            "schema": {
              "anyOf": [
                {
                  "type": "string"
                },
                {
                  "type": "null"
                }
              ],
              "description": "Filter by status",
              "title": "Status"
            },
            "description": "Filter by status"
          },
          {
            "name": "agent",
            "in": "query",
            "required": false,
            "schema": {
              "anyOf": [
                {
                  "type": "string"
                },
                {
                  "type": "null"
                }
              ],
              "description": "Filter by agent",
              "title": "Agent"
            },
            "description": "Filter by agent"
          },
          {
            "name": "limit",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "maximum": 100,
              "minimum": 1,
              "default": 50,
              "title": "Limit"
            }
          },
          {
            "name": "offset",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "minimum": 0,
              "default": 0,
              "title": "Offset"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApprovalsList"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/approvals/{request_id}": {
      "get": {
        "tags": [
          "approvals"
        ],
        "summary": "Get Approval",
        "description": "Get details of a specific approval request.",
        "operationId": "get_approval_approvals__request_id__get",
        "parameters": [
          {
            "name": "request_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "title": "Request Id"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApprovalResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/approvals/{request_id}/decide": {
      "post": {
        "tags": [
          "approvals"
        ],
        "summary": "Decide Approval",
        "description": "Approve or reject an approval request.\n\nValidates status and updates the approval record.",
        "operationId": "decide_approval_approvals__request_id__decide_post",
        "parameters": [
          {
            "name": "request_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "title": "Request Id"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ApprovalDecision"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApprovalResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/approvals/{request_id}/verify": {
      "post": {
        "tags": [
          "approvals"
        ],
        "summary": "Verify Approval Signature",
        "description": "Verify HMAC signature and nonce for approval link.\n\nUsed to validate approval links before processing.\nImplements nonce reuse protection.",
        "operationId": "verify_approval_signature_approvals__request_id__verify_post",
        "parameters": [
          {
            "name": "request_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "title": "Request Id"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ApprovalSignature"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "additionalProperties": true,
                  "title": "Response Verify Approval Signature Approvals  Request Id  Verify Post"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/approvals/{request_id}/cancel": {
      "post": {
        "tags": [
          "approvals"
        ],
        "summary": "Cancel Approval",
        "description": "Cancel a pending approval request.\n\nCan only cancel requests with status 'pending'.",
        "operationId": "cancel_approval_approvals__request_id__cancel_post",
        "parameters": [
          {
            "name": "request_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "title": "Request Id"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApprovalResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/approvals/{request_id}/execute": {
      "post": {
        "tags": [
          "approvals"
        ],
        "summary": "Execute Approved Action",
        "description": "Execute an approved action.\n\nPlaceholder for actual execution logic - will be implemented in PR3.",
        "operationId": "execute_approved_action_approvals__request_id__execute_post",
        "parameters": [
          {
            "name": "request_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "title": "Request Id"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApprovalResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/unsubscribe/preview_grouped": {
      "post": {
        "tags": [
          "unsubscribe"
        ],
        "summary": "Preview Grouped",
        "description": "Group unsubscribe candidates by sender domain.\n\nReturns preview of how many emails per domain can be unsubscribed.\n\nArgs:\n    candidates: List of emails with domain and unsubscribe headers\n\nReturns:\n    Dictionary with groups list, each containing domain, count, and email IDs\n\nExample:\n    POST /unsubscribe/preview_grouped\n    [\n      {\"email_id\":\"e1\",\"sender_domain\":\"news.example.com\",\"headers\":{\"List-Unsubscribe\":\"...\"}},\n      {\"email_id\":\"e2\",\"sender_domain\":\"news.example.com\",\"headers\":{\"List-Unsubscribe\":\"...\"}}\n    ]\n\n    Response:\n    {\n      \"groups\": [\n        {\n          \"domain\": \"news.example.com\",\n          \"count\": 2,\n          \"email_ids\": [\"e1\", \"e2\"],\n          \"params\": {\"headers\": {...}}\n        }\n      ]\n    }",
        "operationId": "preview_grouped_unsubscribe_preview_grouped_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "items": {
                  "$ref": "#/components/schemas/UnsubCandidate"
                },
                "type": "array",
                "title": "Candidates"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "additionalProperties": true,
                  "type": "object",
                  "title": "Response Preview Grouped Unsubscribe Preview Grouped Post"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/unsubscribe/execute_grouped": {
      "post": {
        "tags": [
          "unsubscribe"
        ],
        "summary": "Execute Grouped",
        "description": "Execute unsubscribe for all emails in a domain group.\n\nFans out to individual unsubscribe executions for each email.\n\nArgs:\n    payload: Domain group with email IDs and unsubscribe headers\n\nReturns:\n    Number of emails unsubscribed and domain name\n\nExample:\n    POST /unsubscribe/execute_grouped\n    {\n      \"domain\": \"news.example.com\",\n      \"email_ids\": [\"e1\", \"e2\"],\n      \"params\": {\"headers\": {\"List-Unsubscribe\": \"...\"}}\n    }\n\n    Response:\n    {\n      \"applied\": 2,\n      \"domain\": \"news.example.com\"\n    }",
        "operationId": "execute_grouped_unsubscribe_execute_grouped_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ExecuteGroup"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/productivity/reminders/create": {
      "post": {
        "tags": [
          "productivity"
        ],
        "summary": "Create Reminders",
        "description": "Create reminders/tasks from email content.\n\nFor MVP: stores to actions_audit_v1 audit trail.\nFuture: integrate with Google Calendar/Tasks API.\n\nArgs:\n    req: List of reminders to create\n\nReturns:\n    Count of reminders created\n\nRaises:\n    HTTPException: If no reminders provided\n\nExample:\n    POST /productivity/reminders/create\n    {\n      \"items\": [\n        {\n          \"email_id\": \"bill_123\",\n          \"title\": \"Pay electric bill\",\n          \"due_at\": \"2025-10-15T17:00:00Z\",\n          \"notes\": \"Due on 15th\"\n        }\n      ]\n    }\n\n    Response:\n    {\n      \"created\": 1\n    }",
        "operationId": "create_reminders_productivity_reminders_create_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateRemindersRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/productivity/calendar/create": {
      "post": {
        "tags": [
          "productivity"
        ],
        "summary": "Create Calendar Events",
        "description": "Create calendar events from email content.\n\nFor MVP: stores to actions_audit_v1 audit trail.\nFuture: integrate with Google Calendar API.\n\nArgs:\n    req: List of calendar events to create\n\nReturns:\n    Count of events created\n\nRaises:\n    HTTPException: If no events provided\n\nExample:\n    POST /productivity/calendar/create\n    {\n      \"items\": [\n        {\n          \"email_id\": \"invite_456\",\n          \"title\": \"Team Meeting\",\n          \"start_time\": \"2025-10-12T14:00:00Z\",\n          \"end_time\": \"2025-10-12T15:00:00Z\",\n          \"location\": \"Conference Room A\",\n          \"attendees\": [\"alice@example.com\", \"bob@example.com\"]\n        }\n      ]\n    }\n\n    Response:\n    {\n      \"created\": 1\n    }",
        "operationId": "create_calendar_events_productivity_calendar_create_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateEventsRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/productivity/reminders/list": {
      "get": {
        "tags": [
          "productivity"
        ],
        "summary": "List Reminders",
        "description": "List recent reminders created.\n\nQueries the audit trail for reminder creation events.\n\nArgs:\n    limit: Maximum number of reminders to return\n\nReturns:\n    List of reminders with metadata\n\nExample:\n    GET /productivity/reminders/list?limit=10\n\n    Response:\n    {\n      \"items\": [\n        {\n          \"email_id\": \"bill_123\",\n          \"title\": \"Pay electric bill\",\n          \"due_at\": \"2025-10-15T17:00:00Z\",\n          \"created_at\": \"2025-10-10T12:00:00Z\"\n        }\n      ],\n      \"total\": 1\n    }",
        "operationId": "list_reminders_productivity_reminders_list_get",
        "parameters": [
          {
            "name": "limit",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "default": 50,
              "title": "Limit"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/analytics/latest": {
      "get": {
        "tags": [
          "analytics"
        ],
        "summary": "Latest",
        "description": "Get the latest analytics insight summary.",
        "operationId": "latest_analytics_latest_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        }
      }
    },
    "/analytics/search/": {
      "get": {
        "tags": [
          "analytics"
        ],
        "summary": "Search",
        "description": "Search analytics vector store for relevant insights.\n\nArgs:\n    q: Search query (min 2 chars)\n    k: Number of results to return (default 6)",
        "operationId": "search_analytics_search__get",
        "parameters": [
          {
            "name": "q",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string",
              "minLength": 2,
              "title": "Q"
            }
          },
          {
            "name": "k",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "default": 6,
              "title": "K"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/analytics/dashboards/kpis.csv": {
      "get": {
        "tags": [
          "analytics"
        ],
        "summary": "Dashboards Kpis Csv",
        "description": "Get CSV preview of KPI dashboard data.",
        "operationId": "dashboards_kpis_csv_analytics_dashboards_kpis_csv_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        }
      }
    },
    "/metrics/refresh": {
      "post": {
        "tags": [
          "metrics"
        ],
        "summary": "Metrics Refresh",
        "description": "Manually trigger metrics refresh.\n\nUseful for precomputing metrics on a schedule instead of\nrefreshing on every scrape.\n\nReturns:\n    {\"ok\": True} on success",
        "operationId": "metrics_refresh_metrics_refresh_post",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        }
      }
    },
    "/metrics/divergence-24h": {
      "get": {
        "tags": [
          "metrics"
        ],
        "summary": "Risk divergence and health metrics from Prometheus",
        "description": "Summarize risk mix over the last 24h vs the prior 24h and basic health signals.\n\nReturns:\n    Dict with risk and health metrics from Prometheus:\n    - risk_served_24h: Count by risk level (last 24h)\n    - risk_served_prev24h: Count by risk level (prior 24h)\n    - suspicious_share_pp: Current % of suspicious emails\n    - suspicious_divergence_pp: Change in suspicious % (percentage points)\n    - error_rate_5m: 5xx error rate\n    - p50_latency_s: Median latency\n    - p95_latency_s: 95th percentile latency\n    - rate_limit_ratio_5m: Rate limit hit ratio\n    - ts: Timestamp\n\nCache: None (real-time from Prometheus)",
        "operationId": "divergence_24h_metrics_divergence_24h_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "additionalProperties": true,
                  "type": "object",
                  "title": "Response Divergence 24H Metrics Divergence 24H Get"
                }
              }
            }
          }
        }
      }
    },
    "/metrics/divergence-bq": {
      "get": {
        "tags": [
          "metrics"
        ],
        "summary": "Data divergence between ES and BQ",
        "description": "Check data consistency between Elasticsearch and BigQuery for last 24 hours.\n\nReturns:\n    Dict with divergence metrics:\n    - es_count: Count from Elasticsearch\n    - bq_count: Count from BigQuery warehouse\n    - divergence_pct: Divergence as percentage\n    - status: \"ok\" | \"degraded\" | \"paused\"\n    - message: Human-readable status message\n\nSLO Thresholds:\n    - < 2%: ok (green)\n    - 2-5%: degraded (amber)\n    - > 5%: paused (red)\n\nCache: 30 seconds",
        "operationId": "divergence_bq_metrics_divergence_bq_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "additionalProperties": true,
                  "type": "object",
                  "title": "Response Divergence Bq Metrics Divergence Bq Get"
                }
              }
            }
          }
        }
      }
    },
    "/metrics/activity-daily": {
      "get": {
        "tags": [
          "metrics"
        ],
        "summary": "Daily email activity",
        "description": "Get daily email activity metrics for Grafana visualization.\n\nReturns:\n    List of daily activity records with:\n    - date: ISO date string\n    - message_count: Number of messages that day\n\nCache: 30 seconds",
        "operationId": "activity_daily_metrics_activity_daily_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "items": {
                    "additionalProperties": true,
                    "type": "object"
                  },
                  "type": "array",
                  "title": "Response Activity Daily Metrics Activity Daily Get"
                }
              }
            }
          }
        }
      }
    },
    "/metrics/top-senders-30d": {
      "get": {
        "tags": [
          "metrics"
        ],
        "summary": "Top email senders (30 days)",
        "description": "Get top email senders in the last 30 days.\n\nReturns:\n    List of sender records with:\n    - sender: Email address\n    - messages: Message count\n\nCache: 30 seconds",
        "operationId": "top_senders_30d_metrics_top_senders_30d_get",
        "parameters": [
          {
            "name": "limit",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "default": 10,
              "title": "Limit"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "additionalProperties": true
                  },
                  "title": "Response Top Senders 30D Metrics Top Senders 30D Get"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/metrics/categories-30d": {
      "get": {
        "tags": [
          "metrics"
        ],
        "summary": "Email categories (30 days)",
        "description": "Get email category distribution in the last 30 days.\n\nReturns:\n    List of category records with:\n    - category: Gmail category name\n    - messages: Message count\n\nCache: 30 seconds",
        "operationId": "categories_30d_metrics_categories_30d_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "items": {
                    "additionalProperties": true,
                    "type": "object"
                  },
                  "type": "array",
                  "title": "Response Categories 30D Metrics Categories 30D Get"
                }
              }
            }
          }
        }
      }
    },
    "/automation/recompute": {
      "post": {
        "tags": [
          "automation"
        ],
        "summary": "Recompute All Risk",
        "description": "Trigger risk score recomputation for all emails.\n\nThis endpoint runs the analyze_risk.py script which:\n- Computes risk scores using heuristics\n- Updates risk_score and features_json fields\n- Returns processing statistics\n\nArgs:\n    dry_run: If True, only show what would be updated (no DB changes)\n    batch_size: Number of emails to process per batch\n\nReturns:\n    Job status and output",
        "operationId": "recompute_all_risk_automation_recompute_post",
        "parameters": [
          {
            "name": "dry_run",
            "in": "query",
            "required": false,
            "schema": {
              "type": "boolean",
              "default": false,
              "title": "Dry Run"
            }
          },
          {
            "name": "batch_size",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "default": 500,
              "title": "Batch Size"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/automation/risk-summary": {
      "get": {
        "tags": [
          "automation"
        ],
        "summary": "Get Risk Summary",
        "description": "Get risk score summary statistics.\n\nArgs:\n    category: Filter by email category (bills, promotions, etc.)\n    days: Number of days to include (default: 7)\n\nReturns:\n    Risk score distribution and statistics",
        "operationId": "get_risk_summary_automation_risk_summary_get",
        "parameters": [
          {
            "name": "category",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string",
              "title": "Category"
            }
          },
          {
            "name": "days",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "default": 7,
              "title": "Days"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/automation/risk-trends": {
      "get": {
        "tags": [
          "automation"
        ],
        "summary": "Get Risk Trends",
        "description": "Get risk score trends over time.\n\nArgs:\n    days: Number of days to include (default: 30)\n    granularity: Time granularity (day, week) (default: day)\n\nReturns:\n    Time series of risk scores",
        "operationId": "get_risk_trends_automation_risk_trends_get",
        "parameters": [
          {
            "name": "days",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "default": 30,
              "title": "Days"
            }
          },
          {
            "name": "granularity",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string",
              "default": "day",
              "title": "Granularity"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/automation/health": {
      "get": {
        "tags": [
          "automation"
        ],
        "summary": "Automation Health",
        "description": "Check automation system health.\n\nReturns:\n    Health status and statistics",
        "operationId": "automation_health_automation_health_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        }
      }
    },
    "/incidents": {
      "get": {
        "tags": [
          "incidents"
        ],
        "summary": "List Incidents",
        "description": "List incidents with optional filters.\n\nQuery params:\n- status: Filter by status (open, acknowledged, etc.)\n- severity: Filter by severity (sev1-sev4)\n- kind: Filter by kind (invariant, budget, planner, etc.)\n- assigned_to: Filter by assignee\n- page: Page number (1-indexed)\n- per_page: Results per page",
        "operationId": "list_incidents_incidents_get",
        "parameters": [
          {
            "name": "status",
            "in": "query",
            "required": false,
            "schema": {
              "anyOf": [
                {
                  "type": "string"
                },
                {
                  "type": "null"
                }
              ],
              "title": "Status"
            }
          },
          {
            "name": "severity",
            "in": "query",
            "required": false,
            "schema": {
              "anyOf": [
                {
                  "type": "string"
                },
                {
                  "type": "null"
                }
              ],
              "title": "Severity"
            }
          },
          {
            "name": "kind",
            "in": "query",
            "required": false,
            "schema": {
              "anyOf": [
                {
                  "type": "string"
                },
                {
                  "type": "null"
                }
              ],
              "title": "Kind"
            }
          },
          {
            "name": "assigned_to",
            "in": "query",
            "required": false,
            "schema": {
              "anyOf": [
                {
                  "type": "string"
                },
                {
                  "type": "null"
                }
              ],
              "title": "Assigned To"
            }
          },
          {
            "name": "page",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "minimum": 1,
              "default": 1,
              "title": "Page"
            }
          },
          {
            "name": "per_page",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "maximum": 200,
              "minimum": 1,
              "default": 50,
              "title": "Per Page"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/IncidentListResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/incidents/{incident_id}": {
      "get": {
        "tags": [
          "incidents"
        ],
        "summary": "Get Incident",
        "description": "Get incident details by ID.",
        "operationId": "get_incident_incidents__incident_id__get",
        "parameters": [
          {
            "name": "incident_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer",
              "title": "Incident Id"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/IncidentResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      },
      "patch": {
        "tags": [
          "incidents"
        ],
        "summary": "Update Incident",
        "description": "Update incident fields (summary, assigned_to, playbooks, metadata).",
        "operationId": "update_incident_incidents__incident_id__patch",
        "parameters": [
          {
            "name": "incident_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer",
              "title": "Incident Id"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/IncidentUpdate"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/incidents/{incident_id}/acknowledge": {
      "post": {
        "tags": [
          "incidents"
        ],
        "summary": "Acknowledge Incident",
        "description": "Acknowledge incident (someone is looking at it).\n\nTransition: open  acknowledged",
        "operationId": "acknowledge_incident_incidents__incident_id__acknowledge_post",
        "parameters": [
          {
            "name": "incident_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer",
              "title": "Incident Id"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/StateTransitionRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/incidents/{incident_id}/mitigate": {
      "post": {
        "tags": [
          "incidents"
        ],
        "summary": "Mitigate Incident",
        "description": "Mark incident as mitigated (temporary fix applied).\n\nTransition: acknowledged  mitigated",
        "operationId": "mitigate_incident_incidents__incident_id__mitigate_post",
        "parameters": [
          {
            "name": "incident_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer",
              "title": "Incident Id"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/StateTransitionRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/incidents/{incident_id}/resolve": {
      "post": {
        "tags": [
          "incidents"
        ],
        "summary": "Resolve Incident",
        "description": "Mark incident as resolved (root cause fixed).\n\nTransition: mitigated  resolved",
        "operationId": "resolve_incident_incidents__incident_id__resolve_post",
        "parameters": [
          {
            "name": "incident_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer",
              "title": "Incident Id"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/StateTransitionRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/incidents/{incident_id}/close": {
      "post": {
        "tags": [
          "incidents"
        ],
        "summary": "Close Incident",
        "description": "Close incident (verified no longer occurring).\n\nTransition: resolved  closed",
        "operationId": "close_incident_incidents__incident_id__close_post",
        "parameters": [
          {
            "name": "incident_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer",
              "title": "Incident Id"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/StateTransitionRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/incidents/events": {
      "get": {
        "tags": [
          "incidents"
        ],
        "summary": "Incidents Sse",
        "description": "Server-Sent Events stream for live incident updates.\n\nEmits events when incidents are created or updated.\n(Placeholder - full implementation would use pubsub)",
        "operationId": "incidents_sse_incidents_events_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        }
      }
    },
    "/playbooks/incidents/{incident_id}/actions": {
      "get": {
        "tags": [
          "playbooks"
        ],
        "summary": "List Available Actions",
        "description": "List available remediation actions for incident.\n\nReturns recommended actions based on incident type and playbooks.",
        "operationId": "list_available_actions_playbooks_incidents__incident_id__actions_get",
        "parameters": [
          {
            "name": "incident_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer",
              "title": "Incident Id"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/AvailableAction"
                  },
                  "title": "Response List Available Actions Playbooks Incidents  Incident Id  Actions Get"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/playbooks/incidents/{incident_id}/actions/dry-run": {
      "post": {
        "tags": [
          "playbooks"
        ],
        "summary": "Dry Run Action",
        "description": "Dry-run an action without making changes.\n\nShows:\n- What changes would be made\n- Estimated duration and cost\n- Potential risks",
        "operationId": "dry_run_action_playbooks_incidents__incident_id__actions_dry_run_post",
        "parameters": [
          {
            "name": "incident_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer",
              "title": "Incident Id"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/app__routers__playbooks__ActionRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/app__routers__playbooks__ActionResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/playbooks/incidents/{incident_id}/actions/execute": {
      "post": {
        "tags": [
          "playbooks"
        ],
        "summary": "Execute Action",
        "description": "Execute a remediation action.\n\nRequires approval if action is high-risk.",
        "operationId": "execute_action_playbooks_incidents__incident_id__actions_execute_post",
        "parameters": [
          {
            "name": "incident_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer",
              "title": "Incident Id"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/app__routers__playbooks__ActionRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/app__routers__playbooks__ActionResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/playbooks/incidents/{incident_id}/actions/{action_id}/rollback": {
      "post": {
        "tags": [
          "playbooks"
        ],
        "summary": "Rollback Action",
        "description": "Rollback a previous action.\n\nOnly works for reversible actions.",
        "operationId": "rollback_action_playbooks_incidents__incident_id__actions__action_id__rollback_post",
        "parameters": [
          {
            "name": "incident_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer",
              "title": "Incident Id"
            }
          },
          {
            "name": "action_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer",
              "title": "Action Id"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/app__routers__playbooks__ActionResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/playbooks/incidents/{incident_id}/actions/history": {
      "get": {
        "tags": [
          "playbooks"
        ],
        "summary": "Get Action History",
        "description": "Get execution history for incident.\n\nShows all past dry-runs and executions.",
        "operationId": "get_action_history_playbooks_incidents__incident_id__actions_history_get",
        "parameters": [
          {
            "name": "incident_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer",
              "title": "Incident Id"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/ActionHistoryItem"
                  },
                  "title": "Response Get Action History Playbooks Incidents  Incident Id  Actions History Get"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/sse/events": {
      "get": {
        "tags": [
          "sse"
        ],
        "summary": "Sse Events",
        "description": "SSE endpoint for real-time incident updates.\n\nEvents:\n- incident_created: New incident created\n- incident_updated: Incident state changed\n- action_executed: Remediation action executed\n\nUsage:\n    const eventSource = new EventSource('/api/sse/events');\n    eventSource.addEventListener('incident_created', (e) => {\n        const incident = JSON.parse(e.data);\n        console.log('New incident:', incident);\n    });",
        "operationId": "sse_events_sse_events_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        }
      }
    },
    "/ai/summarize": {
      "post": {
        "tags": [
          "ai"
        ],
        "summary": "Summarize Thread",
        "description": "Summarize an email thread using AI.\n\nGenerates 5 concise bullets and extracts supporting citations.\nUses Ollama for local-first inference.\n\nArgs:\n    request: Summarization request with thread_id\n\nReturns:\n    Summary bullets and citations\n\nRaises:\n    HTTPException: 404 if thread not found, 503 if Ollama unavailable, 504 if timeout",
        "operationId": "summarize_thread_ai_summarize_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/SummarizeRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SummarizeResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/ai/health": {
      "get": {
        "tags": [
          "ai"
        ],
        "summary": "Ai Health",
        "description": "Check AI service health.",
        "operationId": "ai_health_ai_health_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        }
      }
    },
    "/rag/query": {
      "post": {
        "tags": [
          "rag"
        ],
        "summary": "Query Rag",
        "description": "RAG-powered semantic search across email corpus.\n\nReturns ranked results with highlighted snippets showing\nwhere the query terms appear in the email content.\n\nFalls back to mock data if Elasticsearch is unavailable.",
        "operationId": "query_rag_rag_query_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/RagQueryRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/RagQueryResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/rag/health": {
      "get": {
        "tags": [
          "rag"
        ],
        "summary": "Rag Health",
        "description": "Check RAG search service health.\nReturns ES status and feature flag state.",
        "operationId": "rag_health_rag_health_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        }
      }
    },
    "/api/rag/query": {
      "post": {
        "tags": [
          "rag"
        ],
        "summary": "Query Rag",
        "description": "RAG-powered semantic search across email corpus.\n\nReturns ranked results with highlighted snippets showing\nwhere the query terms appear in the email content.\n\nFalls back to mock data if Elasticsearch is unavailable.",
        "operationId": "query_rag_api_rag_query_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/RagQueryRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/RagQueryResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/api/rag/health": {
      "get": {
        "tags": [
          "rag"
        ],
        "summary": "Rag Health",
        "description": "Check RAG search service health.\nReturns ES status and feature flag state.",
        "operationId": "rag_health_api_rag_health_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "Action": {
        "properties": {
          "email_id": {
            "type": "string",
            "title": "Email Id",
            "description": "Email ID to act on"
          },
          "action": {
            "type": "string",
            "title": "Action",
            "description": "Action type: label|archive|move|unsubscribe|quarantine|calendar|task|block|delete"
          },
          "params": {
            "anyOf": [
              {
                "additionalProperties": true,
                "type": "object"
              },
              {
                "type": "null"
              }
            ],
            "title": "Params",
            "description": "Action-specific parameters (e.g., {\"label\": \"important\"})"
          },
          "policy_id": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Policy Id",
            "description": "Policy that triggered this action"
          },
          "confidence": {
            "anyOf": [
              {
                "type": "number"
              },
              {
                "type": "null"
              }
            ],
            "title": "Confidence",
            "description": "Confidence score 0-1"
          },
          "rationale": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Rationale",
            "description": "Human-readable explanation"
          }
        },
        "type": "object",
        "required": [
          "email_id",
          "action"
        ],
        "title": "Action",
        "description": "Represents an action to take on an email"
      },
      "ActionExecuteResult": {
        "properties": {
          "applied": {
            "type": "integer",
            "title": "Applied"
          },
          "failed": {
            "type": "integer",
            "title": "Failed"
          },
          "results": {
            "items": {
              "additionalProperties": true,
              "type": "object"
            },
            "type": "array",
            "title": "Results"
          }
        },
        "type": "object",
        "required": [
          "applied",
          "failed",
          "results"
        ],
        "title": "ActionExecuteResult",
        "description": "Result of executing actions"
      },
      "ActionHistoryItem": {
        "properties": {
          "id": {
            "type": "integer",
            "title": "Id"
          },
          "action_type": {
            "type": "string",
            "title": "Action Type"
          },
          "params": {
            "additionalProperties": true,
            "type": "object",
            "title": "Params"
          },
          "dry_run": {
            "type": "boolean",
            "title": "Dry Run"
          },
          "status": {
            "type": "string",
            "title": "Status"
          },
          "result": {
            "anyOf": [
              {
                "additionalProperties": true,
                "type": "object"
              },
              {
                "type": "null"
              }
            ],
            "title": "Result"
          },
          "approved_by": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Approved By"
          },
          "created_at": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Created At"
          }
        },
        "type": "object",
        "required": [
          "id",
          "action_type",
          "params",
          "dry_run",
          "status",
          "result",
          "approved_by",
          "created_at"
        ],
        "title": "ActionHistoryItem",
        "description": "Historical action execution."
      },
      "ActionItem": {
        "properties": {
          "action": {
            "type": "string",
            "title": "Action",
            "description": "Action type (archive_email, unsubscribe_via_header, etc.)"
          },
          "email_id": {
            "type": "string",
            "title": "Email Id",
            "description": "Email ID to perform action on"
          },
          "params": {
            "additionalProperties": true,
            "type": "object",
            "title": "Params",
            "description": "Action-specific parameters"
          }
        },
        "type": "object",
        "required": [
          "action",
          "email_id"
        ],
        "title": "ActionItem",
        "description": "Proposed action on an email."
      },
      "ActionRow": {
        "properties": {
          "message_id": {
            "type": "string",
            "title": "Message Id"
          },
          "from_name": {
            "type": "string",
            "title": "From Name"
          },
          "from_email": {
            "type": "string",
            "title": "From Email"
          },
          "subject": {
            "type": "string",
            "title": "Subject"
          },
          "received_at": {
            "type": "string",
            "title": "Received At"
          },
          "labels": {
            "items": {
              "type": "string"
            },
            "type": "array",
            "title": "Labels"
          },
          "reason": {
            "additionalProperties": true,
            "type": "object",
            "title": "Reason"
          },
          "allowed_actions": {
            "items": {
              "type": "string"
            },
            "type": "array",
            "title": "Allowed Actions"
          },
          "archived": {
            "type": "boolean",
            "title": "Archived",
            "default": false
          },
          "quarantined": {
            "type": "boolean",
            "title": "Quarantined",
            "default": false
          },
          "muted": {
            "type": "boolean",
            "title": "Muted",
            "default": false
          },
          "user_overrode_safe": {
            "type": "boolean",
            "title": "User Overrode Safe",
            "default": false
          },
          "risk_score": {
            "type": "integer",
            "title": "Risk Score",
            "default": 0
          },
          "unread": {
            "type": "boolean",
            "title": "Unread",
            "default": true
          }
        },
        "type": "object",
        "required": [
          "message_id",
          "from_name",
          "from_email",
          "subject",
          "received_at",
          "labels",
          "reason",
          "allowed_actions"
        ],
        "title": "ActionRow",
        "description": "Email row for inbox actions page."
      },
      "ActionType": {
        "type": "string",
        "enum": [
          "label_email",
          "archive_email",
          "move_to_folder",
          "unsubscribe_via_header",
          "create_calendar_event",
          "create_task",
          "block_sender",
          "quarantine_attachment"
        ],
        "title": "ActionType",
        "description": "Available action types for agentic automation"
      },
      "AgentHealthStatus": {
        "properties": {
          "agent": {
            "type": "string",
            "title": "Agent"
          },
          "status": {
            "type": "string",
            "title": "Status"
          },
          "success_rate": {
            "type": "number",
            "title": "Success Rate"
          },
          "quality_score": {
            "anyOf": [
              {
                "type": "number"
              },
              {
                "type": "null"
              }
            ],
            "title": "Quality Score"
          },
          "issues": {
            "items": {
              "type": "string"
            },
            "type": "array",
            "title": "Issues"
          }
        },
        "type": "object",
        "required": [
          "agent",
          "status",
          "success_rate",
          "quality_score",
          "issues"
        ],
        "title": "AgentHealthStatus",
        "description": "Health status for an agent."
      },
      "AgentMetricsResponse": {
        "properties": {
          "agent": {
            "type": "string",
            "title": "Agent"
          },
          "start_date": {
            "type": "string",
            "format": "date-time",
            "title": "Start Date"
          },
          "end_date": {
            "type": "string",
            "format": "date-time",
            "title": "End Date"
          },
          "total_runs": {
            "type": "integer",
            "title": "Total Runs"
          },
          "success_rate": {
            "type": "number",
            "title": "Success Rate"
          },
          "avg_quality_score": {
            "anyOf": [
              {
                "type": "number"
              },
              {
                "type": "null"
              }
            ],
            "title": "Avg Quality Score"
          },
          "satisfaction_rate": {
            "anyOf": [
              {
                "type": "number"
              },
              {
                "type": "null"
              }
            ],
            "title": "Satisfaction Rate"
          },
          "avg_latency_ms": {
            "anyOf": [
              {
                "type": "number"
              },
              {
                "type": "null"
              }
            ],
            "title": "Avg Latency Ms"
          },
          "total_cost_weight": {
            "type": "number",
            "title": "Total Cost Weight"
          },
          "invariants_failed_count": {
            "type": "integer",
            "title": "Invariants Failed Count"
          },
          "failed_invariant_ids": {
            "items": {
              "type": "string"
            },
            "type": "array",
            "title": "Failed Invariant Ids"
          }
        },
        "type": "object",
        "required": [
          "agent",
          "start_date",
          "end_date",
          "total_runs",
          "success_rate",
          "avg_quality_score",
          "satisfaction_rate",
          "avg_latency_ms",
          "total_cost_weight",
          "invariants_failed_count",
          "failed_invariant_ids"
        ],
        "title": "AgentMetricsResponse",
        "description": "Agent metrics for a date range."
      },
      "AlertSummary": {
        "properties": {
          "total_alerts": {
            "type": "integer",
            "title": "Total Alerts",
            "description": "Total active alerts"
          },
          "critical_alerts": {
            "type": "integer",
            "title": "Critical Alerts",
            "description": "Critical severity alerts"
          },
          "warning_alerts": {
            "type": "integer",
            "title": "Warning Alerts",
            "description": "Warning severity alerts"
          },
          "alerts_by_agent": {
            "additionalProperties": {
              "type": "integer"
            },
            "type": "object",
            "title": "Alerts By Agent",
            "description": "Alerts grouped by agent"
          },
          "alerts_by_type": {
            "additionalProperties": {
              "type": "integer"
            },
            "type": "object",
            "title": "Alerts By Type",
            "description": "Alerts grouped by type"
          }
        },
        "type": "object",
        "required": [
          "total_alerts",
          "critical_alerts",
          "warning_alerts",
          "alerts_by_agent",
          "alerts_by_type"
        ],
        "title": "AlertSummary",
        "description": "Summary of active alerts."
      },
      "AllAgentsHealthResponse": {
        "properties": {
          "timestamp": {
            "type": "string",
            "format": "date-time",
            "title": "Timestamp"
          },
          "agents": {
            "items": {
              "$ref": "#/components/schemas/AgentHealthStatus"
            },
            "type": "array",
            "title": "Agents"
          },
          "overall_status": {
            "type": "string",
            "title": "Overall Status"
          }
        },
        "type": "object",
        "required": [
          "timestamp",
          "agents",
          "overall_status"
        ],
        "title": "AllAgentsHealthResponse",
        "description": "Health status across all agents."
      },
      "AlwaysRequest": {
        "properties": {
          "rationale_features": {
            "additionalProperties": true,
            "type": "object",
            "title": "Rationale Features"
          }
        },
        "type": "object",
        "title": "AlwaysRequest",
        "description": "Request to create a policy from this action (Always do this)."
      },
      "Application": {
        "properties": {
          "id": {
            "type": "string",
            "title": "Id"
          },
          "company": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Company"
          },
          "role": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Role"
          },
          "status": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Status"
          },
          "applied_at": {
            "anyOf": [
              {
                "type": "string",
                "format": "date-time"
              },
              {
                "type": "null"
              }
            ],
            "title": "Applied At"
          },
          "updated_at": {
            "anyOf": [
              {
                "type": "string",
                "format": "date-time"
              },
              {
                "type": "null"
              }
            ],
            "title": "Updated At"
          },
          "source": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Source"
          }
        },
        "type": "object",
        "required": [
          "id"
        ],
        "title": "Application"
      },
      "ApplicationListResponse": {
        "properties": {
          "items": {
            "items": {
              "$ref": "#/components/schemas/Application"
            },
            "type": "array",
            "title": "Items"
          },
          "next_cursor": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Next Cursor"
          },
          "sort": {
            "type": "string",
            "title": "Sort"
          },
          "order": {
            "type": "string",
            "title": "Order"
          },
          "total": {
            "anyOf": [
              {
                "type": "integer"
              },
              {
                "type": "null"
              }
            ],
            "title": "Total"
          }
        },
        "type": "object",
        "required": [
          "items",
          "sort",
          "order"
        ],
        "title": "ApplicationListResponse"
      },
      "ApplicationResponse": {
        "properties": {
          "id": {
            "type": "integer",
            "title": "Id"
          },
          "company": {
            "type": "string",
            "title": "Company"
          },
          "role": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Role"
          },
          "source": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Source"
          },
          "source_confidence": {
            "type": "number",
            "title": "Source Confidence",
            "default": 0.5
          },
          "status": {
            "type": "string",
            "title": "Status"
          },
          "notes": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Notes"
          },
          "thread_id": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Thread Id"
          },
          "gmail_thread_id": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Gmail Thread Id"
          },
          "created_at": {
            "type": "string",
            "title": "Created At"
          },
          "updated_at": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Updated At"
          }
        },
        "type": "object",
        "required": [
          "id",
          "company",
          "status",
          "created_at"
        ],
        "title": "ApplicationResponse",
        "description": "Application model for responses."
      },
      "ApplicationRow": {
        "properties": {
          "id": {
            "type": "string",
            "title": "Id"
          },
          "company": {
            "type": "string",
            "title": "Company"
          },
          "role": {
            "type": "string",
            "title": "Role"
          },
          "stage": {
            "type": "string",
            "title": "Stage"
          },
          "source": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Source"
          },
          "last_activity_at": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Last Activity At"
          }
        },
        "type": "object",
        "required": [
          "id",
          "company",
          "role",
          "stage",
          "source",
          "last_activity_at"
        ],
        "title": "ApplicationRow",
        "description": "Single application in tracker view."
      },
      "ApprovalActionRequest": {
        "properties": {
          "approver": {
            "type": "string",
            "title": "Approver"
          },
          "rationale": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Rationale"
          }
        },
        "type": "object",
        "required": [
          "approver"
        ],
        "title": "ApprovalActionRequest"
      },
      "ApprovalActionResponse": {
        "properties": {
          "status": {
            "type": "string",
            "title": "Status"
          },
          "message": {
            "type": "string",
            "title": "Message"
          }
        },
        "type": "object",
        "required": [
          "status",
          "message"
        ],
        "title": "ApprovalActionResponse"
      },
      "ApprovalDecision": {
        "properties": {
          "decision": {
            "type": "string",
            "title": "Decision",
            "description": "'approve' or 'reject'"
          },
          "comment": {
            "anyOf": [
              {
                "type": "string",
                "maxLength": 1024
              },
              {
                "type": "null"
              }
            ],
            "title": "Comment",
            "description": "Optional comment"
          },
          "reviewed_by": {
            "type": "string",
            "title": "Reviewed By",
            "description": "User email making the decision"
          }
        },
        "type": "object",
        "required": [
          "decision",
          "reviewed_by"
        ],
        "title": "ApprovalDecision",
        "description": "Approve or reject an approval request."
      },
      "ApprovalRequest": {
        "properties": {
          "agent": {
            "type": "string",
            "title": "Agent",
            "description": "Agent requesting approval"
          },
          "action": {
            "type": "string",
            "title": "Action",
            "description": "Action requiring approval"
          },
          "context": {
            "additionalProperties": true,
            "type": "object",
            "title": "Context",
            "description": "Action parameters"
          },
          "reason": {
            "type": "string",
            "title": "Reason",
            "description": "Why approval is needed"
          },
          "policy_rule_id": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Policy Rule Id",
            "description": "Policy rule that triggered approval requirement"
          },
          "requested_by": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Requested By",
            "description": "User email who triggered the action"
          },
          "expires_in_hours": {
            "type": "integer",
            "maximum": 168.0,
            "minimum": 1.0,
            "title": "Expires In Hours",
            "description": "Hours until approval expires (1-168)",
            "default": 24
          }
        },
        "type": "object",
        "required": [
          "agent",
          "action",
          "reason"
        ],
        "title": "ApprovalRequest",
        "description": "Request for agent action approval."
      },
      "ApprovalResponse": {
        "properties": {
          "request_id": {
            "type": "string",
            "title": "Request Id",
            "description": "Unique approval request ID"
          },
          "agent": {
            "type": "string",
            "title": "Agent"
          },
          "action": {
            "type": "string",
            "title": "Action"
          },
          "context": {
            "additionalProperties": true,
            "type": "object",
            "title": "Context"
          },
          "reason": {
            "type": "string",
            "title": "Reason"
          },
          "policy_rule_id": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Policy Rule Id"
          },
          "status": {
            "type": "string",
            "title": "Status",
            "description": "pending, approved, rejected, canceled, expired"
          },
          "requested_by": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Requested By"
          },
          "requested_at": {
            "type": "string",
            "format": "date-time",
            "title": "Requested At"
          },
          "reviewed_by": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Reviewed By"
          },
          "reviewed_at": {
            "anyOf": [
              {
                "type": "string",
                "format": "date-time"
              },
              {
                "type": "null"
              }
            ],
            "title": "Reviewed At"
          },
          "expires_at": {
            "anyOf": [
              {
                "type": "string",
                "format": "date-time"
              },
              {
                "type": "null"
              }
            ],
            "title": "Expires At"
          },
          "signature": {
            "type": "string",
            "title": "Signature",
            "description": "HMAC-SHA256 signature"
          },
          "nonce": {
            "type": "string",
            "title": "Nonce",
            "description": "One-time use nonce"
          },
          "executed": {
            "type": "boolean",
            "title": "Executed",
            "default": false
          },
          "executed_at": {
            "anyOf": [
              {
                "type": "string",
                "format": "date-time"
              },
              {
                "type": "null"
              }
            ],
            "title": "Executed At"
          },
          "execution_result": {
            "anyOf": [
              {
                "additionalProperties": true,
                "type": "object"
              },
              {
                "type": "null"
              }
            ],
            "title": "Execution Result"
          },
          "created_at": {
            "type": "string",
            "format": "date-time",
            "title": "Created At"
          },
          "updated_at": {
            "type": "string",
            "format": "date-time",
            "title": "Updated At"
          }
        },
        "type": "object",
        "required": [
          "request_id",
          "agent",
          "action",
          "context",
          "reason",
          "policy_rule_id",
          "status",
          "requested_by",
          "requested_at",
          "signature",
          "nonce",
          "created_at",
          "updated_at"
        ],
        "title": "ApprovalResponse",
        "description": "Response containing approval request details and signature."
      },
      "ApprovalSignature": {
        "properties": {
          "request_id": {
            "type": "string",
            "title": "Request Id",
            "description": "Approval request ID"
          },
          "nonce": {
            "type": "string",
            "title": "Nonce",
            "description": "One-time nonce"
          },
          "signature": {
            "type": "string",
            "title": "Signature",
            "description": "HMAC-SHA256 signature to verify"
          }
        },
        "type": "object",
        "required": [
          "request_id",
          "nonce",
          "signature"
        ],
        "title": "ApprovalSignature",
        "description": "Signature verification for approval links."
      },
      "ApprovalsList": {
        "properties": {
          "approvals": {
            "items": {
              "$ref": "#/components/schemas/ApprovalResponse"
            },
            "type": "array",
            "title": "Approvals"
          },
          "total": {
            "type": "integer",
            "title": "Total"
          },
          "pending": {
            "type": "integer",
            "title": "Pending"
          },
          "approved": {
            "type": "integer",
            "title": "Approved"
          },
          "rejected": {
            "type": "integer",
            "title": "Rejected"
          }
        },
        "type": "object",
        "required": [
          "approvals",
          "total",
          "pending",
          "approved",
          "rejected"
        ],
        "title": "ApprovalsList",
        "description": "List of approval requests."
      },
      "ApproveReject": {
        "properties": {
          "ids": {
            "items": {
              "type": "integer"
            },
            "type": "array",
            "title": "Ids"
          }
        },
        "type": "object",
        "required": [
          "ids"
        ],
        "title": "ApproveReject",
        "description": "Approve or reject actions by ID."
      },
      "ApproveRequest": {
        "properties": {
          "screenshot_data_url": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Screenshot Data Url",
            "description": "Base64 data URL of screenshot"
          }
        },
        "type": "object",
        "title": "ApproveRequest",
        "description": "Request to approve an action with optional screenshot."
      },
      "AssistantActionPerformed": {
        "properties": {
          "type": {
            "type": "string",
            "title": "Type"
          },
          "status": {
            "type": "string",
            "title": "Status"
          },
          "target": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Target"
          }
        },
        "type": "object",
        "required": [
          "type",
          "status"
        ],
        "title": "AssistantActionPerformed"
      },
      "AssistantEmailSource": {
        "properties": {
          "id": {
            "type": "string",
            "title": "Id"
          },
          "sender": {
            "type": "string",
            "title": "Sender"
          },
          "subject": {
            "type": "string",
            "title": "Subject"
          },
          "timestamp": {
            "type": "string",
            "title": "Timestamp"
          },
          "risk_score": {
            "anyOf": [
              {
                "type": "number"
              },
              {
                "type": "null"
              }
            ],
            "title": "Risk Score"
          },
          "quarantined": {
            "anyOf": [
              {
                "type": "boolean"
              },
              {
                "type": "null"
              }
            ],
            "title": "Quarantined"
          },
          "amount": {
            "anyOf": [
              {
                "type": "number"
              },
              {
                "type": "null"
              }
            ],
            "title": "Amount"
          },
          "due_date": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Due Date"
          },
          "unsubscribe_candidate": {
            "anyOf": [
              {
                "type": "boolean"
              },
              {
                "type": "null"
              }
            ],
            "title": "Unsubscribe Candidate"
          },
          "reply_needed": {
            "anyOf": [
              {
                "type": "boolean"
              },
              {
                "type": "null"
              }
            ],
            "title": "Reply Needed"
          }
        },
        "type": "object",
        "required": [
          "id",
          "sender",
          "subject",
          "timestamp"
        ],
        "title": "AssistantEmailSource"
      },
      "AssistantQueryRequest": {
        "properties": {
          "user_query": {
            "type": "string",
            "title": "User Query"
          },
          "time_window_days": {
            "type": "integer",
            "title": "Time Window Days",
            "default": 30
          },
          "mode": {
            "type": "string",
            "enum": [
              "off",
              "run"
            ],
            "title": "Mode",
            "default": "off"
          },
          "memory_opt_in": {
            "type": "boolean",
            "title": "Memory Opt In",
            "default": false
          },
          "account": {
            "type": "string",
            "title": "Account"
          },
          "context_hint": {
            "anyOf": [
              {
                "$ref": "#/components/schemas/ContextHint"
              },
              {
                "type": "null"
              }
            ]
          }
        },
        "type": "object",
        "required": [
          "user_query",
          "account"
        ],
        "title": "AssistantQueryRequest"
      },
      "AssistantQueryResponse": {
        "properties": {
          "intent": {
            "type": "string",
            "title": "Intent"
          },
          "summary": {
            "type": "string",
            "title": "Summary"
          },
          "sources": {
            "items": {
              "$ref": "#/components/schemas/AssistantEmailSource"
            },
            "type": "array",
            "title": "Sources"
          },
          "suggested_actions": {
            "items": {
              "$ref": "#/components/schemas/AssistantSuggestedAction"
            },
            "type": "array",
            "title": "Suggested Actions"
          },
          "actions_performed": {
            "items": {
              "$ref": "#/components/schemas/AssistantActionPerformed"
            },
            "type": "array",
            "title": "Actions Performed",
            "default": []
          },
          "next_steps": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Next Steps"
          },
          "followup_prompt": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Followup Prompt"
          },
          "llm_used": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Llm Used"
          }
        },
        "type": "object",
        "required": [
          "intent",
          "summary",
          "sources",
          "suggested_actions"
        ],
        "title": "AssistantQueryResponse"
      },
      "AssistantSuggestedAction": {
        "properties": {
          "label": {
            "type": "string",
            "title": "Label"
          },
          "kind": {
            "type": "string",
            "enum": [
              "external_link",
              "unsubscribe",
              "mark_safe",
              "archive",
              "follow_up",
              "draft_reply"
            ],
            "title": "Kind"
          },
          "email_id": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Email Id"
          },
          "link": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Link"
          },
          "sender": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Sender"
          },
          "subject": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Subject"
          }
        },
        "type": "object",
        "required": [
          "label",
          "kind"
        ],
        "title": "AssistantSuggestedAction"
      },
      "AutoUnsubscribeConfig": {
        "properties": {
          "enabled": {
            "type": "boolean",
            "title": "Enabled"
          },
          "threshold": {
            "type": "integer",
            "title": "Threshold"
          }
        },
        "type": "object",
        "required": [
          "enabled",
          "threshold"
        ],
        "title": "AutoUnsubscribeConfig"
      },
      "AvailableAction": {
        "properties": {
          "action_type": {
            "type": "string",
            "title": "Action Type"
          },
          "display_name": {
            "type": "string",
            "title": "Display Name"
          },
          "description": {
            "type": "string",
            "title": "Description"
          },
          "params": {
            "additionalProperties": true,
            "type": "object",
            "title": "Params"
          },
          "requires_approval": {
            "type": "boolean",
            "title": "Requires Approval"
          }
        },
        "type": "object",
        "required": [
          "action_type",
          "display_name",
          "description",
          "params",
          "requires_approval"
        ],
        "title": "AvailableAction",
        "description": "Available action for incident."
      },
      "BackfillPayload": {
        "properties": {
          "gmail_thread_id": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Gmail Thread Id"
          },
          "user_email": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "User Email"
          },
          "subject": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Subject"
          },
          "from": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "From"
          },
          "headers": {
            "anyOf": [
              {
                "additionalProperties": {
                  "type": "string"
                },
                "type": "object"
              },
              {
                "type": "null"
              }
            ],
            "title": "Headers"
          },
          "text": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Text"
          },
          "html": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Html"
          },
          "attachments": {
            "anyOf": [
              {
                "items": {
                  "additionalProperties": true,
                  "type": "object"
                },
                "type": "array"
              },
              {
                "type": "null"
              }
            ],
            "title": "Attachments"
          },
          "defaults": {
            "anyOf": [
              {
                "additionalProperties": true,
                "type": "object"
              },
              {
                "type": "null"
              }
            ],
            "title": "Defaults"
          },
          "company": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Company"
          },
          "role": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Role"
          },
          "source": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Source"
          }
        },
        "type": "object",
        "title": "BackfillPayload",
        "description": "Request payload for /backfill-from-email endpoint."
      },
      "BackfillResp": {
        "properties": {
          "inserted": {
            "type": "integer",
            "title": "Inserted"
          },
          "days": {
            "type": "integer",
            "title": "Days"
          },
          "user_email": {
            "type": "string",
            "title": "User Email"
          }
        },
        "type": "object",
        "required": [
          "inserted",
          "days",
          "user_email"
        ],
        "title": "BackfillResp"
      },
      "BackfillResponse": {
        "properties": {
          "saved": {
            "$ref": "#/components/schemas/ApplicationResponse"
          },
          "extracted": {
            "$ref": "#/components/schemas/ExtractResponse"
          },
          "updated": {
            "type": "boolean",
            "title": "Updated",
            "default": false
          }
        },
        "type": "object",
        "required": [
          "saved",
          "extracted"
        ],
        "title": "BackfillResponse",
        "description": "Response from /backfill-from-email endpoint."
      },
      "BudgetResponse": {
        "properties": {
          "budget": {
            "$ref": "#/components/schemas/BudgetSchema"
          },
          "is_default": {
            "type": "boolean",
            "title": "Is Default"
          }
        },
        "type": "object",
        "required": [
          "budget",
          "is_default"
        ],
        "title": "BudgetResponse",
        "description": "Budget response."
      },
      "BudgetSchema": {
        "properties": {
          "agent": {
            "type": "string",
            "title": "Agent"
          },
          "min_quality_score": {
            "anyOf": [
              {
                "type": "number",
                "maximum": 100.0,
                "minimum": 0.0
              },
              {
                "type": "null"
              }
            ],
            "title": "Min Quality Score"
          },
          "min_success_rate": {
            "anyOf": [
              {
                "type": "number",
                "maximum": 1.0,
                "minimum": 0.0
              },
              {
                "type": "null"
              }
            ],
            "title": "Min Success Rate"
          },
          "max_avg_latency_ms": {
            "anyOf": [
              {
                "type": "number",
                "exclusiveMinimum": 0.0
              },
              {
                "type": "null"
              }
            ],
            "title": "Max Avg Latency Ms"
          },
          "max_p95_latency_ms": {
            "anyOf": [
              {
                "type": "number",
                "exclusiveMinimum": 0.0
              },
              {
                "type": "null"
              }
            ],
            "title": "Max P95 Latency Ms"
          },
          "max_p99_latency_ms": {
            "anyOf": [
              {
                "type": "number",
                "exclusiveMinimum": 0.0
              },
              {
                "type": "null"
              }
            ],
            "title": "Max P99 Latency Ms"
          },
          "max_avg_cost_weight": {
            "anyOf": [
              {
                "type": "number",
                "exclusiveMinimum": 0.0
              },
              {
                "type": "null"
              }
            ],
            "title": "Max Avg Cost Weight"
          },
          "max_invariant_failures": {
            "type": "integer",
            "minimum": 0.0,
            "title": "Max Invariant Failures",
            "default": 0
          },
          "description": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Description"
          },
          "enabled": {
            "type": "boolean",
            "title": "Enabled",
            "default": true
          }
        },
        "type": "object",
        "required": [
          "agent"
        ],
        "title": "BudgetSchema",
        "description": "Budget configuration."
      },
      "BulkActionRequest": {
        "properties": {
          "message_ids": {
            "items": {
              "type": "string"
            },
            "type": "array",
            "title": "Message Ids"
          }
        },
        "type": "object",
        "required": [
          "message_ids"
        ],
        "title": "BulkActionRequest",
        "description": "Request body for bulk triage operations."
      },
      "BulkActionResponse": {
        "properties": {
          "updated": {
            "items": {
              "type": "string"
            },
            "type": "array",
            "title": "Updated"
          },
          "failed": {
            "items": {
              "type": "string"
            },
            "type": "array",
            "title": "Failed",
            "default": []
          }
        },
        "type": "object",
        "required": [
          "updated"
        ],
        "title": "BulkActionResponse",
        "description": "Response for bulk operations."
      },
      "BulkPropose": {
        "properties": {
          "items": {
            "items": {
              "$ref": "#/components/schemas/Proposed"
            },
            "type": "array",
            "title": "Items"
          }
        },
        "type": "object",
        "required": [
          "items"
        ],
        "title": "BulkPropose",
        "description": "Bulk propose multiple actions."
      },
      "BundleApplyRequest": {
        "properties": {
          "canary_percent": {
            "anyOf": [
              {
                "type": "integer"
              },
              {
                "type": "null"
              }
            ],
            "title": "Canary Percent"
          }
        },
        "type": "object",
        "title": "BundleApplyRequest"
      },
      "BundleApplyResponse": {
        "properties": {
          "status": {
            "type": "string",
            "title": "Status"
          },
          "canary_percent": {
            "anyOf": [
              {
                "type": "integer"
              },
              {
                "type": "null"
              }
            ],
            "title": "Canary Percent"
          }
        },
        "type": "object",
        "required": [
          "status"
        ],
        "title": "BundleApplyResponse"
      },
      "BundleCreateRequest": {
        "properties": {
          "agent": {
            "type": "string",
            "title": "Agent"
          },
          "min_examples": {
            "type": "integer",
            "title": "Min Examples",
            "default": 50
          },
          "model_type": {
            "type": "string",
            "title": "Model Type",
            "default": "logistic"
          }
        },
        "type": "object",
        "required": [
          "agent"
        ],
        "title": "BundleCreateRequest"
      },
      "BundleCreateResponse": {
        "properties": {
          "bundle_id": {
            "type": "string",
            "title": "Bundle Id"
          },
          "agent": {
            "type": "string",
            "title": "Agent"
          },
          "training_count": {
            "type": "integer",
            "title": "Training Count"
          },
          "accuracy": {
            "type": "number",
            "title": "Accuracy"
          },
          "thresholds": {
            "additionalProperties": true,
            "type": "object",
            "title": "Thresholds"
          }
        },
        "type": "object",
        "required": [
          "bundle_id",
          "agent",
          "training_count",
          "accuracy",
          "thresholds"
        ],
        "title": "BundleCreateResponse"
      },
      "BundleProposeRequest": {
        "properties": {
          "agent": {
            "type": "string",
            "title": "Agent"
          },
          "bundle_id": {
            "type": "string",
            "title": "Bundle Id"
          },
          "proposer": {
            "type": "string",
            "title": "Proposer",
            "default": "system"
          }
        },
        "type": "object",
        "required": [
          "agent",
          "bundle_id"
        ],
        "title": "BundleProposeRequest"
      },
      "BundleProposeResponse": {
        "properties": {
          "approval_id": {
            "type": "string",
            "title": "Approval Id"
          }
        },
        "type": "object",
        "required": [
          "approval_id"
        ],
        "title": "BundleProposeResponse"
      },
      "CalendarEvent": {
        "properties": {
          "email_id": {
            "type": "string",
            "title": "Email Id"
          },
          "title": {
            "type": "string",
            "title": "Title"
          },
          "start_time": {
            "type": "string",
            "title": "Start Time"
          },
          "end_time": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "End Time"
          },
          "location": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Location"
          },
          "description": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Description"
          },
          "attendees": {
            "anyOf": [
              {
                "items": {
                  "type": "string"
                },
                "type": "array"
              },
              {
                "type": "null"
              }
            ],
            "title": "Attendees"
          }
        },
        "type": "object",
        "required": [
          "email_id",
          "title",
          "start_time"
        ],
        "title": "CalendarEvent",
        "description": "Calendar event to create from email."
      },
      "CanaryPerformanceResponse": {
        "properties": {
          "has_regression": {
            "type": "boolean",
            "title": "Has Regression"
          },
          "quality_delta": {
            "type": "number",
            "title": "Quality Delta"
          },
          "latency_delta": {
            "type": "number",
            "title": "Latency Delta"
          },
          "recommendation": {
            "type": "string",
            "title": "Recommendation"
          },
          "reason": {
            "type": "string",
            "title": "Reason"
          }
        },
        "type": "object",
        "required": [
          "has_regression",
          "quality_delta",
          "latency_delta",
          "recommendation",
          "reason"
        ],
        "title": "CanaryPerformanceResponse"
      },
      "CanaryPromoteRequest": {
        "properties": {
          "target_percent": {
            "type": "integer",
            "title": "Target Percent",
            "default": 100
          }
        },
        "type": "object",
        "title": "CanaryPromoteRequest"
      },
      "CancelResp": {
        "properties": {
          "ok": {
            "type": "boolean",
            "title": "Ok"
          },
          "error": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Error"
          }
        },
        "type": "object",
        "required": [
          "ok"
        ],
        "title": "CancelResp"
      },
      "ChatRequest": {
        "properties": {
          "messages": {
            "items": {
              "$ref": "#/components/schemas/Message"
            },
            "type": "array",
            "title": "Messages",
            "description": "Conversation history with last message being user query"
          },
          "filters": {
            "additionalProperties": true,
            "type": "object",
            "title": "Filters",
            "description": "Optional structured filters: category, risk_min, sender_domain, date_from, date_to, labels"
          },
          "max_results": {
            "type": "integer",
            "maximum": 100.0,
            "minimum": 1.0,
            "title": "Max Results",
            "description": "Maximum number of emails to search",
            "default": 50
          },
          "window_days": {
            "anyOf": [
              {
                "type": "integer",
                "maximum": 365.0,
                "minimum": 1.0
              },
              {
                "type": "null"
              }
            ],
            "title": "Window Days",
            "description": "Time window in days to search (default: 30)",
            "default": 30
          }
        },
        "type": "object",
        "required": [
          "messages"
        ],
        "title": "ChatRequest",
        "description": "Request for chat endpoint."
      },
      "ChatResponse": {
        "properties": {
          "intent": {
            "type": "string",
            "title": "Intent",
            "description": "Detected user intent"
          },
          "intent_explanation": {
            "type": "string",
            "title": "Intent Explanation",
            "description": "What the intent does"
          },
          "answer": {
            "type": "string",
            "title": "Answer",
            "description": "Natural language response"
          },
          "actions": {
            "items": {
              "$ref": "#/components/schemas/ActionItem"
            },
            "type": "array",
            "title": "Actions",
            "description": "Proposed actions"
          },
          "citations": {
            "items": {
              "$ref": "#/components/schemas/app__routers__chat__Citation"
            },
            "type": "array",
            "title": "Citations",
            "description": "Email sources used"
          },
          "search_stats": {
            "additionalProperties": true,
            "type": "object",
            "title": "Search Stats",
            "description": "Search metadata (total results, query, filters)"
          },
          "timing": {
            "additionalProperties": true,
            "type": "object",
            "title": "Timing",
            "description": "Performance timing (es_ms, llm_ms)"
          }
        },
        "type": "object",
        "required": [
          "intent",
          "intent_explanation",
          "answer"
        ],
        "title": "ChatResponse",
        "description": "Response from chat endpoint."
      },
      "ConnectionStatus": {
        "properties": {
          "connected": {
            "type": "boolean",
            "title": "Connected"
          },
          "user_email": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "User Email"
          },
          "provider": {
            "type": "string",
            "title": "Provider",
            "default": "google"
          },
          "has_refresh_token": {
            "type": "boolean",
            "title": "Has Refresh Token",
            "default": false
          },
          "total": {
            "anyOf": [
              {
                "type": "integer"
              },
              {
                "type": "null"
              }
            ],
            "title": "Total"
          }
        },
        "type": "object",
        "required": [
          "connected"
        ],
        "title": "ConnectionStatus"
      },
      "ContextHint": {
        "properties": {
          "previous_intent": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Previous Intent"
          },
          "previous_email_ids": {
            "items": {
              "type": "string"
            },
            "type": "array",
            "title": "Previous Email Ids",
            "default": []
          }
        },
        "type": "object",
        "title": "ContextHint",
        "description": "Short-term memory hint from previous interaction."
      },
      "CreateEventsRequest": {
        "properties": {
          "items": {
            "items": {
              "$ref": "#/components/schemas/CalendarEvent"
            },
            "type": "array",
            "title": "Items"
          }
        },
        "type": "object",
        "title": "CreateEventsRequest",
        "description": "Batch create calendar events request."
      },
      "CreateRemindersRequest": {
        "properties": {
          "items": {
            "items": {
              "$ref": "#/components/schemas/Reminder"
            },
            "type": "array",
            "title": "Items"
          }
        },
        "type": "object",
        "title": "CreateRemindersRequest",
        "description": "Batch create reminders request."
      },
      "DashboardStatus": {
        "properties": {
          "agents": {
            "items": {
              "type": "string"
            },
            "type": "array",
            "title": "Agents",
            "description": "List of monitored agents"
          },
          "total_agents": {
            "type": "integer",
            "title": "Total Agents",
            "description": "Total number of agents"
          },
          "passing_gates": {
            "type": "integer",
            "title": "Passing Gates",
            "description": "Agents passing quality gates"
          },
          "failing_gates": {
            "type": "integer",
            "title": "Failing Gates",
            "description": "Agents failing quality gates"
          },
          "active_violations": {
            "type": "integer",
            "title": "Active Violations",
            "description": "Active budget violations"
          },
          "last_updated": {
            "type": "string",
            "format": "date-time",
            "title": "Last Updated",
            "description": "Last metrics update"
          }
        },
        "type": "object",
        "required": [
          "agents",
          "total_agents",
          "passing_gates",
          "failing_gates",
          "active_violations",
          "last_updated"
        ],
        "title": "DashboardStatus",
        "description": "Dashboard health status."
      },
      "DraftReplyRequest": {
        "properties": {
          "email_id": {
            "type": "string",
            "title": "Email Id"
          },
          "sender": {
            "type": "string",
            "title": "Sender"
          },
          "subject": {
            "type": "string",
            "title": "Subject"
          },
          "account": {
            "type": "string",
            "title": "Account"
          },
          "thread_summary": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Thread Summary"
          },
          "tone": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Tone"
          }
        },
        "type": "object",
        "required": [
          "email_id",
          "sender",
          "subject",
          "account"
        ],
        "title": "DraftReplyRequest"
      },
      "DraftReplyResponse": {
        "properties": {
          "email_id": {
            "type": "string",
            "title": "Email Id"
          },
          "draft": {
            "type": "string",
            "title": "Draft"
          },
          "sender": {
            "type": "string",
            "title": "Sender"
          },
          "subject": {
            "type": "string",
            "title": "Subject"
          }
        },
        "type": "object",
        "required": [
          "email_id",
          "draft",
          "sender",
          "subject"
        ],
        "title": "DraftReplyResponse"
      },
      "EmailItem": {
        "properties": {
          "id": {
            "type": "integer",
            "title": "Id"
          },
          "gmail_id": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Gmail Id"
          },
          "thread_id": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Thread Id"
          },
          "subject": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Subject"
          },
          "body_preview": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Body Preview"
          },
          "sender": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Sender"
          },
          "recipient": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Recipient"
          },
          "received_at": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Received At"
          },
          "labels": {
            "anyOf": [
              {
                "items": {
                  "type": "string"
                },
                "type": "array"
              },
              {
                "type": "null"
              }
            ],
            "title": "Labels"
          },
          "label_heuristics": {
            "anyOf": [
              {
                "items": {
                  "type": "string"
                },
                "type": "array"
              },
              {
                "type": "null"
              }
            ],
            "title": "Label Heuristics"
          },
          "company": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Company"
          },
          "role": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Role"
          },
          "source": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Source"
          },
          "application_id": {
            "anyOf": [
              {
                "type": "integer"
              },
              {
                "type": "null"
              }
            ],
            "title": "Application Id"
          }
        },
        "type": "object",
        "required": [
          "id",
          "gmail_id",
          "thread_id",
          "subject",
          "body_preview",
          "sender",
          "recipient",
          "received_at",
          "labels",
          "label_heuristics"
        ],
        "title": "EmailItem"
      },
      "EmailOut": {
        "properties": {
          "id": {
            "type": "integer",
            "title": "Id"
          },
          "gmail_id": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Gmail Id"
          },
          "thread_id": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Thread Id"
          },
          "subject": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Subject"
          },
          "sender": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Sender"
          },
          "recipient": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Recipient"
          },
          "received_at": {
            "anyOf": [
              {
                "type": "string",
                "format": "date-time"
              },
              {
                "type": "null"
              }
            ],
            "title": "Received At"
          },
          "owner_email": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Owner Email"
          },
          "company": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Company"
          },
          "role": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Role"
          },
          "category": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Category"
          }
        },
        "type": "object",
        "required": [
          "id"
        ],
        "title": "EmailOut"
      },
      "EvaluateRequest": {
        "properties": {
          "agent": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Agent"
          },
          "lookback_days": {
            "type": "integer",
            "maximum": 90.0,
            "minimum": 1.0,
            "title": "Lookback Days",
            "default": 7
          },
          "baseline_days": {
            "type": "integer",
            "maximum": 180.0,
            "minimum": 1.0,
            "title": "Baseline Days",
            "default": 14
          }
        },
        "type": "object",
        "title": "EvaluateRequest",
        "description": "Gate evaluation request."
      },
      "EvaluationResponse": {
        "properties": {
          "passed": {
            "type": "boolean",
            "title": "Passed"
          },
          "violations": {
            "items": {
              "$ref": "#/components/schemas/ViolationSchema"
            },
            "type": "array",
            "title": "Violations"
          },
          "current_metrics": {
            "anyOf": [
              {
                "additionalProperties": true,
                "type": "object"
              },
              {
                "type": "null"
              }
            ],
            "title": "Current Metrics"
          },
          "baseline_metrics": {
            "anyOf": [
              {
                "additionalProperties": true,
                "type": "object"
              },
              {
                "type": "null"
              }
            ],
            "title": "Baseline Metrics"
          },
          "agent": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Agent"
          },
          "total_violations": {
            "anyOf": [
              {
                "type": "integer"
              },
              {
                "type": "null"
              }
            ],
            "title": "Total Violations"
          },
          "critical_violations": {
            "anyOf": [
              {
                "type": "integer"
              },
              {
                "type": "null"
              }
            ],
            "title": "Critical Violations"
          },
          "evaluated_agents": {
            "anyOf": [
              {
                "items": {
                  "type": "string"
                },
                "type": "array"
              },
              {
                "type": "null"
              }
            ],
            "title": "Evaluated Agents"
          }
        },
        "type": "object",
        "required": [
          "passed",
          "violations"
        ],
        "title": "EvaluationResponse",
        "description": "Gate evaluation response."
      },
      "ExecuteGroup": {
        "properties": {
          "domain": {
            "type": "string",
            "title": "Domain"
          },
          "email_ids": {
            "items": {
              "type": "string"
            },
            "type": "array",
            "title": "Email Ids"
          },
          "params": {
            "additionalProperties": true,
            "type": "object",
            "title": "Params"
          }
        },
        "type": "object",
        "required": [
          "domain",
          "email_ids",
          "params"
        ],
        "title": "ExecuteGroup",
        "description": "Execute unsubscribe for a group of emails from same domain."
      },
      "ExecuteRequest": {
        "properties": {
          "items": {
            "items": {
              "$ref": "#/components/schemas/Proposed"
            },
            "type": "array",
            "title": "Items"
          }
        },
        "type": "object",
        "required": [
          "items"
        ],
        "title": "ExecuteRequest",
        "description": "Execute approved actions."
      },
      "ExplainRequest": {
        "properties": {
          "message_id": {
            "type": "string",
            "title": "Message Id"
          }
        },
        "type": "object",
        "required": [
          "message_id"
        ],
        "title": "ExplainRequest",
        "description": "Request to explain why an email needs action."
      },
      "ExtractPayload": {
        "properties": {
          "gmail_thread_id": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Gmail Thread Id"
          },
          "user_email": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "User Email"
          },
          "subject": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Subject"
          },
          "from": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "From"
          },
          "headers": {
            "anyOf": [
              {
                "additionalProperties": {
                  "type": "string"
                },
                "type": "object"
              },
              {
                "type": "null"
              }
            ],
            "title": "Headers"
          },
          "text": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Text"
          },
          "html": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Html"
          },
          "attachments": {
            "anyOf": [
              {
                "items": {
                  "additionalProperties": true,
                  "type": "object"
                },
                "type": "array"
              },
              {
                "type": "null"
              }
            ],
            "title": "Attachments"
          }
        },
        "type": "object",
        "title": "ExtractPayload",
        "description": "Request payload for /extract endpoint."
      },
      "ExtractResponse": {
        "properties": {
          "company": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Company"
          },
          "role": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Role"
          },
          "source": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Source"
          },
          "source_confidence": {
            "type": "number",
            "title": "Source Confidence",
            "default": 0.5
          },
          "debug": {
            "additionalProperties": true,
            "type": "object",
            "title": "Debug",
            "default": {}
          }
        },
        "type": "object",
        "title": "ExtractResponse",
        "description": "Response from /extract endpoint."
      },
      "FeedbackRequest": {
        "properties": {
          "agent": {
            "type": "string",
            "title": "Agent",
            "description": "Agent identifier"
          },
          "run_id": {
            "type": "string",
            "title": "Run Id",
            "description": "Unique run identifier"
          },
          "feedback_type": {
            "type": "string",
            "title": "Feedback Type",
            "description": "thumbs_up or thumbs_down"
          },
          "comment": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Comment",
            "description": "Optional user comment"
          },
          "context": {
            "anyOf": [
              {
                "additionalProperties": true,
                "type": "object"
              },
              {
                "type": "null"
              }
            ],
            "title": "Context",
            "description": "Additional context"
          }
        },
        "type": "object",
        "required": [
          "agent",
          "run_id",
          "feedback_type"
        ],
        "title": "FeedbackRequest",
        "description": "User feedback on an agent run."
      },
      "FeedbackResponse": {
        "properties": {
          "status": {
            "type": "string",
            "title": "Status",
            "default": "success"
          },
          "message": {
            "type": "string",
            "title": "Message",
            "default": "Feedback recorded"
          }
        },
        "type": "object",
        "title": "FeedbackResponse",
        "description": "Feedback submission response."
      },
      "FlagConfig": {
        "properties": {
          "enabled": {
            "type": "boolean",
            "title": "Enabled"
          },
          "rollout_percent": {
            "type": "integer",
            "maximum": 100.0,
            "minimum": 0.0,
            "title": "Rollout Percent",
            "description": "Rollout percentage (0-100)"
          }
        },
        "type": "object",
        "required": [
          "enabled",
          "rollout_percent"
        ],
        "title": "FlagConfig",
        "description": "Feature flag configuration"
      },
      "HTTPValidationError": {
        "properties": {
          "detail": {
            "items": {
              "$ref": "#/components/schemas/ValidationError"
            },
            "type": "array",
            "title": "Detail"
          }
        },
        "type": "object",
        "title": "HTTPValidationError"
      },
      "Heartbeat": {
        "properties": {
          "page": {
            "type": "string",
            "title": "Page"
          },
          "ts": {
            "type": "number",
            "title": "Ts"
          },
          "meta": {
            "anyOf": [
              {
                "additionalProperties": true,
                "type": "object"
              },
              {
                "type": "null"
              }
            ],
            "title": "Meta"
          }
        },
        "type": "object",
        "required": [
          "page",
          "ts"
        ],
        "title": "Heartbeat",
        "description": "Heartbeat payload from client."
      },
      "InboxResponse": {
        "properties": {
          "emails": {
            "items": {
              "$ref": "#/components/schemas/EmailItem"
            },
            "type": "array",
            "title": "Emails"
          },
          "total": {
            "type": "integer",
            "title": "Total"
          },
          "page": {
            "type": "integer",
            "title": "Page"
          },
          "limit": {
            "type": "integer",
            "title": "Limit"
          }
        },
        "type": "object",
        "required": [
          "emails",
          "total",
          "page",
          "limit"
        ],
        "title": "InboxResponse"
      },
      "InboxSummary": {
        "properties": {
          "archived": {
            "type": "integer",
            "title": "Archived"
          },
          "quarantined": {
            "type": "integer",
            "title": "Quarantined"
          },
          "muted_senders": {
            "type": "integer",
            "title": "Muted Senders"
          },
          "safe_senders": {
            "type": "integer",
            "title": "Safe Senders"
          }
        },
        "type": "object",
        "required": [
          "archived",
          "quarantined",
          "muted_senders",
          "safe_senders"
        ],
        "title": "InboxSummary",
        "description": "Summary metrics for inbox actions."
      },
      "IncidentListResponse": {
        "properties": {
          "incidents": {
            "items": {
              "$ref": "#/components/schemas/IncidentResponse"
            },
            "type": "array",
            "title": "Incidents"
          },
          "total": {
            "type": "integer",
            "title": "Total"
          },
          "page": {
            "type": "integer",
            "title": "Page"
          },
          "per_page": {
            "type": "integer",
            "title": "Per Page"
          }
        },
        "type": "object",
        "required": [
          "incidents",
          "total",
          "page",
          "per_page"
        ],
        "title": "IncidentListResponse"
      },
      "IncidentResponse": {
        "properties": {
          "id": {
            "type": "integer",
            "title": "Id"
          },
          "kind": {
            "type": "string",
            "title": "Kind"
          },
          "key": {
            "type": "string",
            "title": "Key"
          },
          "severity": {
            "type": "string",
            "title": "Severity"
          },
          "status": {
            "type": "string",
            "title": "Status"
          },
          "summary": {
            "type": "string",
            "title": "Summary"
          },
          "details": {
            "additionalProperties": true,
            "type": "object",
            "title": "Details"
          },
          "issue_url": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Issue Url"
          },
          "playbooks": {
            "items": {
              "type": "string"
            },
            "type": "array",
            "title": "Playbooks"
          },
          "assigned_to": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Assigned To"
          },
          "parent_id": {
            "anyOf": [
              {
                "type": "integer"
              },
              {
                "type": "null"
              }
            ],
            "title": "Parent Id"
          },
          "created_at": {
            "type": "string",
            "title": "Created At"
          },
          "acknowledged_at": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Acknowledged At"
          },
          "mitigated_at": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Mitigated At"
          },
          "resolved_at": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Resolved At"
          },
          "closed_at": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Closed At"
          },
          "metadata": {
            "additionalProperties": true,
            "type": "object",
            "title": "Metadata"
          }
        },
        "type": "object",
        "required": [
          "id",
          "kind",
          "key",
          "severity",
          "status",
          "summary",
          "details",
          "issue_url",
          "playbooks",
          "assigned_to",
          "parent_id",
          "created_at",
          "acknowledged_at",
          "mitigated_at",
          "resolved_at",
          "closed_at",
          "metadata"
        ],
        "title": "IncidentResponse"
      },
      "IncidentUpdate": {
        "properties": {
          "summary": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Summary"
          },
          "assigned_to": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Assigned To"
          },
          "playbooks": {
            "anyOf": [
              {
                "items": {
                  "type": "string"
                },
                "type": "array"
              },
              {
                "type": "null"
              }
            ],
            "title": "Playbooks"
          },
          "metadata": {
            "anyOf": [
              {
                "additionalProperties": true,
                "type": "object"
              },
              {
                "type": "null"
              }
            ],
            "title": "Metadata"
          }
        },
        "type": "object",
        "title": "IncidentUpdate"
      },
      "LabeledStatsResponse": {
        "properties": {
          "total": {
            "type": "integer",
            "title": "Total"
          },
          "by_source": {
            "additionalProperties": true,
            "type": "object",
            "title": "By Source"
          },
          "by_agent": {
            "additionalProperties": true,
            "type": "object",
            "title": "By Agent"
          },
          "recent_7d": {
            "type": "integer",
            "title": "Recent 7D"
          }
        },
        "type": "object",
        "required": [
          "total",
          "by_source",
          "by_agent",
          "recent_7d"
        ],
        "title": "LabeledStatsResponse"
      },
      "Message": {
        "properties": {
          "role": {
            "type": "string",
            "enum": [
              "user",
              "assistant",
              "system"
            ],
            "title": "Role"
          },
          "content": {
            "type": "string",
            "title": "Content"
          },
          "timestamp": {
            "anyOf": [
              {
                "type": "string",
                "format": "date-time"
              },
              {
                "type": "null"
              }
            ],
            "title": "Timestamp"
          }
        },
        "type": "object",
        "required": [
          "role",
          "content"
        ],
        "title": "Message",
        "description": "A single message in the conversation."
      },
      "MessageDetailResponse": {
        "properties": {
          "message_id": {
            "type": "string",
            "title": "Message Id"
          },
          "from_name": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "From Name"
          },
          "from_email": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "From Email"
          },
          "to_email": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "To Email"
          },
          "subject": {
            "type": "string",
            "title": "Subject"
          },
          "received_at": {
            "type": "string",
            "title": "Received At"
          },
          "risk_score": {
            "anyOf": [
              {
                "type": "integer"
              },
              {
                "type": "null"
              }
            ],
            "title": "Risk Score"
          },
          "quarantined": {
            "anyOf": [
              {
                "type": "boolean"
              },
              {
                "type": "null"
              }
            ],
            "title": "Quarantined"
          },
          "category": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Category"
          },
          "html_body": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Html Body"
          },
          "text_body": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Text Body"
          }
        },
        "type": "object",
        "required": [
          "message_id",
          "subject",
          "received_at"
        ],
        "title": "MessageDetailResponse",
        "description": "Full message detail for drawer view."
      },
      "MetricsExportResponse": {
        "properties": {
          "success": {
            "type": "boolean",
            "title": "Success",
            "description": "Export succeeded"
          },
          "agents_exported": {
            "type": "integer",
            "title": "Agents Exported",
            "description": "Number of agents exported"
          },
          "metrics_exported": {
            "type": "integer",
            "title": "Metrics Exported",
            "description": "Number of metric records processed"
          },
          "days_covered": {
            "type": "integer",
            "title": "Days Covered",
            "description": "Days of data covered"
          },
          "exported_at": {
            "type": "string",
            "format": "date-time",
            "title": "Exported At",
            "description": "Export timestamp"
          }
        },
        "type": "object",
        "required": [
          "success",
          "agents_exported",
          "metrics_exported",
          "days_covered",
          "exported_at"
        ],
        "title": "MetricsExportResponse",
        "description": "Response from metrics export."
      },
      "NLQuery": {
        "properties": {
          "text": {
            "type": "string",
            "title": "Text"
          }
        },
        "type": "object",
        "required": [
          "text"
        ],
        "title": "NLQuery",
        "description": "Natural language query from user."
      },
      "PolicyCreate": {
        "properties": {
          "name": {
            "type": "string",
            "maxLength": 255,
            "minLength": 1,
            "title": "Name"
          },
          "enabled": {
            "type": "boolean",
            "title": "Enabled",
            "default": true
          },
          "priority": {
            "type": "integer",
            "maximum": 1000.0,
            "minimum": 1.0,
            "title": "Priority",
            "default": 100
          },
          "condition": {
            "additionalProperties": true,
            "type": "object",
            "title": "Condition",
            "description": "Yardstick DSL condition"
          },
          "action": {
            "$ref": "#/components/schemas/ActionType"
          },
          "confidence_threshold": {
            "type": "number",
            "maximum": 1.0,
            "minimum": 0.0,
            "title": "Confidence Threshold",
            "default": 0.7
          }
        },
        "type": "object",
        "required": [
          "name",
          "condition",
          "action"
        ],
        "title": "PolicyCreate",
        "description": "Request to create a new policy."
      },
      "PolicyRunRequest": {
        "properties": {
          "policy_set": {
            "$ref": "#/components/schemas/PolicySet"
          },
          "es_filter": {
            "additionalProperties": true,
            "type": "object",
            "title": "Es Filter"
          },
          "limit": {
            "anyOf": [
              {
                "type": "integer"
              },
              {
                "type": "null"
              }
            ],
            "title": "Limit",
            "default": 300
          }
        },
        "type": "object",
        "required": [
          "policy_set",
          "es_filter"
        ],
        "title": "PolicyRunRequest",
        "description": "Request to run a policy set against an email collection."
      },
      "PolicyRunResponse": {
        "properties": {
          "policy_set_id": {
            "type": "string",
            "title": "Policy Set Id"
          },
          "evaluated": {
            "type": "integer",
            "title": "Evaluated"
          },
          "proposed_actions": {
            "items": {
              "additionalProperties": true,
              "type": "object"
            },
            "type": "array",
            "title": "Proposed Actions"
          }
        },
        "type": "object",
        "required": [
          "policy_set_id",
          "evaluated",
          "proposed_actions"
        ],
        "title": "PolicyRunResponse",
        "description": "Response containing proposed actions for approval."
      },
      "PolicySet": {
        "properties": {
          "id": {
            "type": "string",
            "title": "Id"
          },
          "policies": {
            "items": {
              "additionalProperties": true,
              "type": "object"
            },
            "type": "array",
            "title": "Policies"
          }
        },
        "type": "object",
        "required": [
          "id",
          "policies"
        ],
        "title": "PolicySet",
        "description": "A named collection of policies."
      },
      "PolicyTestRequest": {
        "properties": {
          "email_ids": {
            "items": {
              "type": "integer"
            },
            "type": "array",
            "title": "Email Ids"
          },
          "limit": {
            "type": "integer",
            "maximum": 100.0,
            "minimum": 1.0,
            "title": "Limit",
            "default": 10
          }
        },
        "type": "object",
        "title": "PolicyTestRequest",
        "description": "Request to test a policy against emails."
      },
      "PolicyUpdate": {
        "properties": {
          "name": {
            "anyOf": [
              {
                "type": "string",
                "maxLength": 255,
                "minLength": 1
              },
              {
                "type": "null"
              }
            ],
            "title": "Name"
          },
          "enabled": {
            "anyOf": [
              {
                "type": "boolean"
              },
              {
                "type": "null"
              }
            ],
            "title": "Enabled"
          },
          "priority": {
            "anyOf": [
              {
                "type": "integer",
                "maximum": 1000.0,
                "minimum": 1.0
              },
              {
                "type": "null"
              }
            ],
            "title": "Priority"
          },
          "condition": {
            "anyOf": [
              {
                "additionalProperties": true,
                "type": "object"
              },
              {
                "type": "null"
              }
            ],
            "title": "Condition"
          },
          "action": {
            "anyOf": [
              {
                "$ref": "#/components/schemas/ActionType"
              },
              {
                "type": "null"
              }
            ]
          },
          "confidence_threshold": {
            "anyOf": [
              {
                "type": "number",
                "maximum": 1.0,
                "minimum": 0.0
              },
              {
                "type": "null"
              }
            ],
            "title": "Confidence Threshold"
          }
        },
        "type": "object",
        "title": "PolicyUpdate",
        "description": "Request to update an existing policy."
      },
      "ProposeRequest": {
        "properties": {
          "email_ids": {
            "items": {
              "type": "integer"
            },
            "type": "array",
            "title": "Email Ids",
            "description": "Specific email IDs"
          },
          "query": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Query",
            "description": "ES query to find candidate emails"
          },
          "limit": {
            "type": "integer",
            "maximum": 1000.0,
            "minimum": 1.0,
            "title": "Limit",
            "description": "Max emails to process",
            "default": 100
          }
        },
        "type": "object",
        "title": "ProposeRequest",
        "description": "Request to propose actions for emails."
      },
      "Proposed": {
        "properties": {
          "email_id": {
            "type": "string",
            "title": "Email Id"
          },
          "action": {
            "type": "string",
            "title": "Action"
          },
          "policy_id": {
            "type": "string",
            "title": "Policy Id"
          },
          "confidence": {
            "type": "number",
            "title": "Confidence"
          },
          "rationale": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Rationale"
          },
          "params": {
            "anyOf": [
              {
                "additionalProperties": true,
                "type": "object"
              },
              {
                "type": "null"
              }
            ],
            "title": "Params"
          }
        },
        "type": "object",
        "required": [
          "email_id",
          "action",
          "policy_id",
          "confidence"
        ],
        "title": "Proposed",
        "description": "A single proposed action from policy engine."
      },
      "RagHit": {
        "properties": {
          "thread_id": {
            "type": "string",
            "title": "Thread Id"
          },
          "message_id": {
            "type": "string",
            "title": "Message Id"
          },
          "score": {
            "type": "number",
            "title": "Score"
          },
          "highlights": {
            "items": {
              "type": "string"
            },
            "type": "array",
            "title": "Highlights",
            "description": "Highlighted snippets"
          },
          "sender": {
            "type": "string",
            "title": "Sender"
          },
          "subject": {
            "type": "string",
            "title": "Subject"
          },
          "date": {
            "type": "string",
            "title": "Date"
          }
        },
        "type": "object",
        "required": [
          "thread_id",
          "message_id",
          "score",
          "sender",
          "subject",
          "date"
        ],
        "title": "RagHit",
        "description": "Single search result with highlights",
        "example": {
          "date": "2025-01-15T10:30:00Z",
          "highlights": [
            "...scheduling <em>conflict</em> next week..."
          ],
          "message_id": "msg-123",
          "score": 0.85,
          "sender": "john@example.com",
          "subject": "Re: Interview Schedule",
          "thread_id": "thread-abc"
        }
      },
      "RagQueryRequest": {
        "properties": {
          "q": {
            "type": "string",
            "maxLength": 500,
            "minLength": 1,
            "title": "Q",
            "description": "Search query"
          },
          "k": {
            "type": "integer",
            "maximum": 20.0,
            "minimum": 1.0,
            "title": "K",
            "description": "Number of results to return",
            "default": 5
          }
        },
        "type": "object",
        "required": [
          "q"
        ],
        "title": "RagQueryRequest",
        "description": "Request for semantic search",
        "example": {
          "k": 5,
          "q": "interview scheduling conflict"
        }
      },
      "RagQueryResponse": {
        "properties": {
          "hits": {
            "items": {
              "$ref": "#/components/schemas/RagHit"
            },
            "type": "array",
            "title": "Hits"
          },
          "total": {
            "type": "integer",
            "title": "Total",
            "description": "Total number of matching documents"
          }
        },
        "type": "object",
        "required": [
          "hits",
          "total"
        ],
        "title": "RagQueryResponse",
        "description": "Response with search results",
        "example": {
          "hits": [
            {
              "date": "2025-01-15T10:30:00Z",
              "highlights": [
                "...scheduling <em>conflict</em>..."
              ],
              "message_id": "msg-123",
              "score": 0.85,
              "sender": "john@example.com",
              "subject": "Interview Schedule",
              "thread_id": "thread-abc"
            }
          ],
          "total": 12
        }
      },
      "RampEvent": {
        "properties": {
          "flag": {
            "type": "string",
            "title": "Flag"
          },
          "from_percent": {
            "type": "integer",
            "title": "From Percent"
          },
          "to_percent": {
            "type": "integer",
            "title": "To Percent"
          },
          "timestamp": {
            "type": "string",
            "format": "date-time",
            "title": "Timestamp"
          },
          "user": {
            "type": "string",
            "title": "User",
            "default": "admin"
          }
        },
        "type": "object",
        "required": [
          "flag",
          "from_percent",
          "to_percent",
          "timestamp"
        ],
        "title": "RampEvent",
        "description": "Feature flag ramp audit event"
      },
      "RedTeamRunResponse": {
        "properties": {
          "run_id": {
            "type": "string",
            "title": "Run Id"
          },
          "total_tasks": {
            "type": "integer",
            "title": "Total Tasks"
          },
          "passed": {
            "type": "integer",
            "title": "Passed"
          },
          "failed": {
            "type": "integer",
            "title": "Failed"
          },
          "success_rate": {
            "type": "number",
            "title": "Success Rate"
          },
          "avg_quality_score": {
            "type": "number",
            "title": "Avg Quality Score"
          },
          "failed_task_ids": {
            "items": {
              "type": "string"
            },
            "type": "array",
            "title": "Failed Task Ids"
          }
        },
        "type": "object",
        "required": [
          "run_id",
          "total_tasks",
          "passed",
          "failed",
          "success_rate",
          "avg_quality_score",
          "failed_task_ids"
        ],
        "title": "RedTeamRunResponse",
        "description": "Red-team evaluation run response."
      },
      "Reminder": {
        "properties": {
          "email_id": {
            "type": "string",
            "title": "Email Id"
          },
          "title": {
            "type": "string",
            "title": "Title"
          },
          "due_at": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Due At"
          },
          "source": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Source",
            "default": "mailbox"
          },
          "notes": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Notes"
          }
        },
        "type": "object",
        "required": [
          "email_id",
          "title"
        ],
        "title": "Reminder",
        "description": "Single reminder/task to create."
      },
      "ReportRequest": {
        "properties": {
          "week_start": {
            "anyOf": [
              {
                "type": "string",
                "format": "date-time"
              },
              {
                "type": "null"
              }
            ],
            "title": "Week Start",
            "description": "Start of week (Monday). Defaults to last Monday."
          },
          "format": {
            "type": "string",
            "title": "Format",
            "description": "Output format: 'markdown' or 'html'",
            "default": "markdown"
          }
        },
        "type": "object",
        "title": "ReportRequest",
        "description": "Request to generate a report."
      },
      "ReportResponse": {
        "properties": {
          "week_start": {
            "type": "string",
            "format": "date-time",
            "title": "Week Start",
            "description": "Week start date"
          },
          "week_end": {
            "type": "string",
            "format": "date-time",
            "title": "Week End",
            "description": "Week end date"
          },
          "generated_at": {
            "type": "string",
            "format": "date-time",
            "title": "Generated At",
            "description": "Report generation timestamp"
          },
          "format": {
            "type": "string",
            "title": "Format",
            "description": "Report format"
          },
          "content": {
            "type": "string",
            "title": "Content",
            "description": "Report content"
          },
          "summary": {
            "additionalProperties": true,
            "type": "object",
            "title": "Summary",
            "description": "Report summary statistics"
          }
        },
        "type": "object",
        "required": [
          "week_start",
          "week_end",
          "generated_at",
          "format",
          "content",
          "summary"
        ],
        "title": "ReportResponse",
        "description": "Generated report response."
      },
      "ReportSummary": {
        "properties": {
          "week_start": {
            "type": "string",
            "format": "date-time",
            "title": "Week Start"
          },
          "generated_at": {
            "type": "string",
            "format": "date-time",
            "title": "Generated At"
          },
          "total_agents": {
            "type": "integer",
            "title": "Total Agents"
          },
          "passing_agents": {
            "type": "integer",
            "title": "Passing Agents"
          },
          "total_violations": {
            "type": "integer",
            "title": "Total Violations"
          },
          "critical_violations": {
            "type": "integer",
            "title": "Critical Violations"
          },
          "status": {
            "type": "string",
            "title": "Status"
          }
        },
        "type": "object",
        "required": [
          "week_start",
          "generated_at",
          "total_agents",
          "passing_agents",
          "total_violations",
          "critical_violations",
          "status"
        ],
        "title": "ReportSummary",
        "description": "Summary of a generated report."
      },
      "ReviewQueueStatsResponse": {
        "properties": {
          "total_unlabeled": {
            "type": "integer",
            "title": "Total Unlabeled"
          },
          "by_agent": {
            "additionalProperties": true,
            "type": "object",
            "title": "By Agent"
          },
          "total_eval_results": {
            "type": "integer",
            "title": "Total Eval Results"
          },
          "total_labeled": {
            "type": "integer",
            "title": "Total Labeled"
          }
        },
        "type": "object",
        "required": [
          "total_unlabeled",
          "by_agent",
          "total_eval_results",
          "total_labeled"
        ],
        "title": "ReviewQueueStatsResponse"
      },
      "RiskRescanRequest": {
        "properties": {
          "email_id": {
            "type": "string",
            "title": "Email Id"
          }
        },
        "type": "object",
        "required": [
          "email_id"
        ],
        "title": "RiskRescanRequest"
      },
      "RiskResponse": {
        "properties": {
          "ok": {
            "type": "boolean",
            "title": "Ok"
          },
          "email_id": {
            "type": "string",
            "title": "Email Id"
          },
          "suspicious": {
            "type": "boolean",
            "title": "Suspicious"
          },
          "risk_score": {
            "type": "integer",
            "title": "Risk Score"
          },
          "flags": {
            "items": {
              "type": "string"
            },
            "type": "array",
            "title": "Flags"
          },
          "evidence": {
            "items": {
              "type": "string"
            },
            "type": "array",
            "title": "Evidence"
          },
          "version": {
            "type": "string",
            "title": "Version"
          }
        },
        "type": "object",
        "required": [
          "ok",
          "email_id",
          "suspicious",
          "risk_score",
          "flags",
          "evidence",
          "version"
        ],
        "title": "RiskResponse"
      },
      "SearchHit": {
        "properties": {
          "id": {
            "anyOf": [
              {
                "type": "integer"
              },
              {
                "type": "null"
              }
            ],
            "title": "Id"
          },
          "gmail_id": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Gmail Id"
          },
          "thread_id": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Thread Id"
          },
          "subject": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Subject"
          },
          "sender": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Sender"
          },
          "recipient": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Recipient"
          },
          "labels": {
            "items": {
              "type": "string"
            },
            "type": "array",
            "title": "Labels",
            "default": []
          },
          "label_heuristics": {
            "items": {
              "type": "string"
            },
            "type": "array",
            "title": "Label Heuristics",
            "default": []
          },
          "received_at": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Received At"
          },
          "company": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Company"
          },
          "role": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Role"
          },
          "source": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Source"
          },
          "score": {
            "type": "number",
            "title": "Score"
          },
          "snippet": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Snippet"
          },
          "highlight": {
            "additionalProperties": true,
            "type": "object",
            "title": "Highlight",
            "default": {}
          },
          "subject_highlight": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Subject Highlight"
          },
          "body_highlight": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Body Highlight"
          },
          "first_user_reply_at": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "First User Reply At"
          },
          "user_reply_count": {
            "type": "integer",
            "title": "User Reply Count",
            "default": 0
          },
          "replied": {
            "type": "boolean",
            "title": "Replied",
            "default": false
          },
          "time_to_response_hours": {
            "anyOf": [
              {
                "type": "number"
              },
              {
                "type": "null"
              }
            ],
            "title": "Time To Response Hours"
          },
          "category": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Category"
          },
          "expires_at": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Expires At"
          },
          "event_start_at": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Event Start At"
          },
          "event_end_at": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Event End At"
          },
          "interests": {
            "items": {
              "type": "string"
            },
            "type": "array",
            "title": "Interests",
            "default": []
          },
          "confidence": {
            "anyOf": [
              {
                "type": "number"
              },
              {
                "type": "null"
              }
            ],
            "title": "Confidence"
          }
        },
        "type": "object",
        "required": [
          "score"
        ],
        "title": "SearchHit",
        "description": "Single search result."
      },
      "SearchResponse": {
        "properties": {
          "total": {
            "type": "integer",
            "title": "Total"
          },
          "hits": {
            "items": {
              "$ref": "#/components/schemas/SearchHit"
            },
            "type": "array",
            "title": "Hits"
          },
          "info": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Info"
          }
        },
        "type": "object",
        "required": [
          "total",
          "hits"
        ],
        "title": "SearchResponse",
        "description": "Search response with results and metadata."
      },
      "SecurityPoliciesIn": {
        "properties": {
          "auto_quarantine_high_risk": {
            "type": "boolean",
            "title": "Auto Quarantine High Risk"
          },
          "auto_archive_expired_promos": {
            "type": "boolean",
            "title": "Auto Archive Expired Promos"
          },
          "auto_unsubscribe_inactive": {
            "anyOf": [
              {
                "$ref": "#/components/schemas/AutoUnsubscribeConfig"
              },
              {
                "type": "null"
              }
            ]
          }
        },
        "type": "object",
        "required": [
          "auto_quarantine_high_risk",
          "auto_archive_expired_promos"
        ],
        "title": "SecurityPoliciesIn"
      },
      "SecurityPoliciesOut": {
        "properties": {
          "autoQuarantineHighRisk": {
            "type": "boolean",
            "title": "Autoquarantinehighrisk"
          },
          "autoArchiveExpiredPromos": {
            "type": "boolean",
            "title": "Autoarchiveexpiredpromos"
          },
          "autoUnsubscribeInactive": {
            "additionalProperties": true,
            "type": "object",
            "title": "Autounsubscribeinactive"
          }
        },
        "type": "object",
        "required": [
          "autoQuarantineHighRisk",
          "autoArchiveExpiredPromos",
          "autoUnsubscribeInactive"
        ],
        "title": "SecurityPoliciesOut"
      },
      "SeedCountRequest": {
        "properties": {
          "count": {
            "type": "integer",
            "title": "Count",
            "default": 40
          }
        },
        "type": "object",
        "title": "SeedCountRequest"
      },
      "SeedResult": {
        "properties": {
          "ok": {
            "type": "boolean",
            "title": "Ok"
          },
          "count": {
            "type": "integer",
            "title": "Count"
          }
        },
        "type": "object",
        "required": [
          "ok",
          "count"
        ],
        "title": "SeedResult"
      },
      "SeedThread": {
        "properties": {
          "thread_id": {
            "type": "string",
            "title": "Thread Id"
          },
          "subject": {
            "type": "string",
            "title": "Subject"
          },
          "from_addr": {
            "type": "string",
            "title": "From Addr"
          },
          "risk_level": {
            "type": "string",
            "title": "Risk Level"
          },
          "summary_headline": {
            "type": "string",
            "title": "Summary Headline"
          },
          "summary_details": {
            "items": {
              "type": "string"
            },
            "type": "array",
            "title": "Summary Details"
          }
        },
        "type": "object",
        "required": [
          "thread_id",
          "subject",
          "from_addr",
          "risk_level",
          "summary_headline",
          "summary_details"
        ],
        "title": "SeedThread"
      },
      "SenderOverride": {
        "properties": {
          "id": {
            "type": "string",
            "title": "Id"
          },
          "sender": {
            "type": "string",
            "title": "Sender"
          },
          "muted": {
            "type": "boolean",
            "title": "Muted"
          },
          "safe": {
            "type": "boolean",
            "title": "Safe"
          },
          "created_at": {
            "type": "string",
            "format": "date-time",
            "title": "Created At"
          },
          "updated_at": {
            "type": "string",
            "format": "date-time",
            "title": "Updated At"
          }
        },
        "type": "object",
        "required": [
          "id",
          "sender",
          "muted",
          "safe",
          "created_at",
          "updated_at"
        ],
        "title": "SenderOverride",
        "description": "Sender override preference."
      },
      "SenderOverrideCreateRequest": {
        "properties": {
          "sender": {
            "type": "string",
            "title": "Sender"
          }
        },
        "type": "object",
        "required": [
          "sender"
        ],
        "title": "SenderOverrideCreateRequest",
        "description": "Request to create/update a sender override."
      },
      "SenderOverrideDeleteResponse": {
        "properties": {
          "ok": {
            "type": "boolean",
            "title": "Ok"
          },
          "deleted_id": {
            "type": "string",
            "title": "Deleted Id"
          }
        },
        "type": "object",
        "required": [
          "ok",
          "deleted_id"
        ],
        "title": "SenderOverrideDeleteResponse",
        "description": "Delete response."
      },
      "SenderOverrideListResponse": {
        "properties": {
          "overrides": {
            "items": {
              "$ref": "#/components/schemas/SenderOverride"
            },
            "type": "array",
            "title": "Overrides"
          }
        },
        "type": "object",
        "required": [
          "overrides"
        ],
        "title": "SenderOverrideListResponse",
        "description": "List response wrapper."
      },
      "SessionResponse": {
        "properties": {
          "ok": {
            "type": "boolean",
            "title": "Ok",
            "default": true
          },
          "user": {
            "anyOf": [
              {
                "$ref": "#/components/schemas/UserSchema"
              },
              {
                "type": "null"
              }
            ]
          }
        },
        "type": "object",
        "title": "SessionResponse",
        "description": "Session response schema."
      },
      "StartResp": {
        "properties": {
          "job_id": {
            "type": "string",
            "title": "Job Id"
          },
          "started": {
            "type": "boolean",
            "title": "Started"
          }
        },
        "type": "object",
        "required": [
          "job_id",
          "started"
        ],
        "title": "StartResp"
      },
      "StateTransitionRequest": {
        "properties": {
          "notes": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Notes"
          },
          "assigned_to": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Assigned To"
          }
        },
        "type": "object",
        "title": "StateTransitionRequest"
      },
      "StatusResp": {
        "properties": {
          "job_id": {
            "type": "string",
            "title": "Job Id"
          },
          "state": {
            "type": "string",
            "title": "State"
          },
          "processed": {
            "type": "integer",
            "title": "Processed",
            "default": 0
          },
          "total": {
            "anyOf": [
              {
                "type": "integer"
              },
              {
                "type": "null"
              }
            ],
            "title": "Total"
          },
          "error": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Error"
          },
          "inserted": {
            "anyOf": [
              {
                "type": "integer"
              },
              {
                "type": "null"
              }
            ],
            "title": "Inserted"
          },
          "started_at": {
            "anyOf": [
              {
                "type": "number"
              },
              {
                "type": "null"
              }
            ],
            "title": "Started At"
          },
          "completed_at": {
            "anyOf": [
              {
                "type": "number"
              },
              {
                "type": "null"
              }
            ],
            "title": "Completed At"
          }
        },
        "type": "object",
        "required": [
          "job_id",
          "state"
        ],
        "title": "StatusResp"
      },
      "SummarizeRequest": {
        "properties": {
          "thread_id": {
            "type": "string",
            "title": "Thread Id",
            "description": "Thread ID to summarize"
          },
          "max_citations": {
            "type": "integer",
            "maximum": 5.0,
            "minimum": 0.0,
            "title": "Max Citations",
            "description": "Maximum citations to return",
            "default": 3
          }
        },
        "type": "object",
        "required": [
          "thread_id"
        ],
        "title": "SummarizeRequest",
        "description": "Request to summarize an email thread."
      },
      "SummarizeResponse": {
        "properties": {
          "bullets": {
            "items": {
              "type": "string"
            },
            "type": "array",
            "title": "Bullets",
            "description": "Summary bullets (max 5)"
          },
          "citations": {
            "items": {
              "$ref": "#/components/schemas/app__routers__ai__Citation"
            },
            "type": "array",
            "title": "Citations",
            "description": "Supporting citations"
          }
        },
        "type": "object",
        "required": [
          "bullets"
        ],
        "title": "SummarizeResponse",
        "description": "Response from summarization."
      },
      "SummaryFeedbackRequest": {
        "properties": {
          "message_id": {
            "type": "string",
            "title": "Message Id"
          },
          "helpful": {
            "type": "boolean",
            "title": "Helpful"
          },
          "reason": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Reason"
          }
        },
        "type": "object",
        "required": [
          "message_id",
          "helpful"
        ],
        "title": "SummaryFeedbackRequest",
        "description": "Request to record feedback on AI summary quality."
      },
      "SummaryFeedbackResponse": {
        "properties": {
          "ok": {
            "type": "boolean",
            "title": "Ok"
          }
        },
        "type": "object",
        "required": [
          "ok"
        ],
        "title": "SummaryFeedbackResponse",
        "description": "Response from summary feedback endpoint."
      },
      "TrackerListResponse": {
        "properties": {
          "applications": {
            "items": {
              "$ref": "#/components/schemas/ApplicationRow"
            },
            "type": "array",
            "title": "Applications"
          }
        },
        "type": "object",
        "required": [
          "applications"
        ],
        "title": "TrackerListResponse",
        "description": "List of applications."
      },
      "TrackerRow": {
        "properties": {
          "company": {
            "type": "string",
            "title": "Company"
          },
          "role": {
            "type": "string",
            "title": "Role"
          },
          "source": {
            "type": "string",
            "title": "Source"
          },
          "status": {
            "type": "string",
            "title": "Status"
          },
          "last_update": {
            "type": "string",
            "title": "Last Update"
          }
        },
        "type": "object",
        "required": [
          "company",
          "role",
          "source",
          "status",
          "last_update"
        ],
        "title": "TrackerRow",
        "description": "Application row for the Tracker page"
      },
      "UnsubCandidate": {
        "properties": {
          "email_id": {
            "type": "string",
            "title": "Email Id"
          },
          "sender_domain": {
            "type": "string",
            "title": "Sender Domain"
          },
          "headers": {
            "additionalProperties": {
              "type": "string"
            },
            "type": "object",
            "title": "Headers"
          }
        },
        "type": "object",
        "required": [
          "email_id",
          "sender_domain",
          "headers"
        ],
        "title": "UnsubCandidate",
        "description": "Single email candidate for unsubscribe."
      },
      "UnsubRequest": {
        "properties": {
          "email_id": {
            "type": "string",
            "title": "Email Id"
          },
          "headers": {
            "additionalProperties": {
              "type": "string"
            },
            "type": "object",
            "title": "Headers"
          }
        },
        "type": "object",
        "required": [
          "email_id",
          "headers"
        ],
        "title": "UnsubRequest",
        "description": "Request model for unsubscribe operations."
      },
      "UserSchema": {
        "properties": {
          "id": {
            "type": "string",
            "title": "Id"
          },
          "email": {
            "type": "string",
            "title": "Email"
          },
          "name": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Name"
          },
          "picture_url": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Picture Url"
          },
          "is_demo": {
            "type": "boolean",
            "title": "Is Demo",
            "default": false
          }
        },
        "type": "object",
        "required": [
          "id",
          "email"
        ],
        "title": "UserSchema",
        "description": "User response schema."
      },
      "ValidationError": {
        "properties": {
          "loc": {
            "items": {
              "anyOf": [
                {
                  "type": "string"
                },
                {
                  "type": "integer"
                }
              ]
            },
            "type": "array",
            "title": "Location"
          },
          "msg": {
            "type": "string",
            "title": "Message"
          },
          "type": {
            "type": "string",
            "title": "Error Type"
          }
        },
        "type": "object",
        "required": [
          "loc",
          "msg",
          "type"
        ],
        "title": "ValidationError"
      },
      "ViolationSchema": {
        "properties": {
          "agent": {
            "type": "string",
            "title": "Agent"
          },
          "budget_type": {
            "type": "string",
            "title": "Budget Type"
          },
          "threshold": {
            "type": "number",
            "title": "Threshold"
          },
          "actual": {
            "type": "number",
            "title": "Actual"
          },
          "severity": {
            "type": "string",
            "title": "Severity"
          },
          "message": {
            "type": "string",
            "title": "Message"
          },
          "date": {
            "type": "string",
            "format": "date-time",
            "title": "Date"
          }
        },
        "type": "object",
        "required": [
          "agent",
          "budget_type",
          "threshold",
          "actual",
          "severity",
          "message",
          "date"
        ],
        "title": "ViolationSchema",
        "description": "Budget violation."
      },
      "app__routers__ai__Citation": {
        "properties": {
          "snippet": {
            "type": "string",
            "title": "Snippet",
            "description": "Quoted text snippet (<=160 chars)"
          },
          "message_id": {
            "type": "string",
            "title": "Message Id",
            "description": "Source message ID"
          },
          "offset": {
            "anyOf": [
              {
                "type": "integer"
              },
              {
                "type": "null"
              }
            ],
            "title": "Offset",
            "description": "Character offset in message"
          }
        },
        "type": "object",
        "required": [
          "snippet",
          "message_id"
        ],
        "title": "Citation",
        "description": "Citation to a specific part of the thread."
      },
      "app__routers__chat__Citation": {
        "properties": {
          "id": {
            "type": "string",
            "title": "Id"
          },
          "subject": {
            "type": "string",
            "title": "Subject"
          },
          "sender": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Sender"
          },
          "received_at": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Received At"
          },
          "category": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Category"
          },
          "risk_score": {
            "anyOf": [
              {
                "type": "integer"
              },
              {
                "type": "null"
              }
            ],
            "title": "Risk Score"
          }
        },
        "type": "object",
        "required": [
          "id",
          "subject"
        ],
        "title": "Citation",
        "description": "Email citation with key metadata."
      },
      "app__routers__inbox_actions__ActionRequest": {
        "properties": {
          "message_id": {
            "type": "string",
            "title": "Message Id"
          }
        },
        "type": "object",
        "required": [
          "message_id"
        ],
        "title": "ActionRequest",
        "description": "Request to perform an action on an email."
      },
      "app__routers__inbox_actions__ActionResponse": {
        "properties": {
          "ok": {
            "type": "boolean",
            "title": "Ok"
          },
          "message_id": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Message Id"
          },
          "new_risk_score": {
            "anyOf": [
              {
                "type": "integer"
              },
              {
                "type": "null"
              }
            ],
            "title": "New Risk Score"
          },
          "quarantined": {
            "anyOf": [
              {
                "type": "boolean"
              },
              {
                "type": "null"
              }
            ],
            "title": "Quarantined"
          },
          "archived": {
            "anyOf": [
              {
                "type": "boolean"
              },
              {
                "type": "null"
              }
            ],
            "title": "Archived"
          },
          "muted": {
            "anyOf": [
              {
                "type": "boolean"
              },
              {
                "type": "null"
              }
            ],
            "title": "Muted"
          },
          "user_overrode_safe": {
            "anyOf": [
              {
                "type": "boolean"
              },
              {
                "type": "null"
              }
            ],
            "title": "User Overrode Safe"
          }
        },
        "type": "object",
        "required": [
          "ok"
        ],
        "title": "ActionResponse",
        "description": "Response from action."
      },
      "app__routers__inbox_actions__ExplainResponse": {
        "properties": {
          "summary": {
            "type": "string",
            "title": "Summary"
          }
        },
        "type": "object",
        "required": [
          "summary"
        ],
        "title": "ExplainResponse",
        "description": "Response with explanation."
      },
      "app__routers__playbooks__ActionRequest": {
        "properties": {
          "action_type": {
            "type": "string",
            "title": "Action Type",
            "description": "Type of action to execute"
          },
          "params": {
            "additionalProperties": true,
            "type": "object",
            "title": "Params",
            "description": "Action parameters"
          },
          "approved_by": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Approved By",
            "description": "User who approved (required if approval needed)"
          }
        },
        "type": "object",
        "required": [
          "action_type"
        ],
        "title": "ActionRequest",
        "description": "Request to execute an action."
      },
      "app__routers__playbooks__ActionResponse": {
        "properties": {
          "status": {
            "type": "string",
            "title": "Status"
          },
          "message": {
            "type": "string",
            "title": "Message"
          },
          "details": {
            "additionalProperties": true,
            "type": "object",
            "title": "Details"
          },
          "estimated_duration": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Estimated Duration"
          },
          "estimated_cost": {
            "anyOf": [
              {
                "type": "number"
              },
              {
                "type": "null"
              }
            ],
            "title": "Estimated Cost"
          },
          "changes": {
            "items": {
              "type": "string"
            },
            "type": "array",
            "title": "Changes"
          },
          "actual_duration": {
            "anyOf": [
              {
                "type": "number"
              },
              {
                "type": "null"
              }
            ],
            "title": "Actual Duration"
          },
          "logs_url": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Logs Url"
          },
          "rollback_available": {
            "type": "boolean",
            "title": "Rollback Available"
          },
          "rollback_action": {
            "anyOf": [
              {
                "additionalProperties": true,
                "type": "object"
              },
              {
                "type": "null"
              }
            ],
            "title": "Rollback Action"
          }
        },
        "type": "object",
        "required": [
          "status",
          "message",
          "details",
          "estimated_duration",
          "estimated_cost",
          "changes",
          "actual_duration",
          "logs_url",
          "rollback_available",
          "rollback_action"
        ],
        "title": "ActionResponse",
        "description": "Response from action execution."
      },
      "app__routers__search__ActionRequest": {
        "properties": {
          "doc_id": {
            "type": "string",
            "title": "Doc Id"
          },
          "note": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Note"
          }
        },
        "type": "object",
        "required": [
          "doc_id"
        ],
        "title": "ActionRequest",
        "description": "Request body for quick actions."
      },
      "app__routers__search__ActionResponse": {
        "properties": {
          "status": {
            "type": "string",
            "title": "Status"
          },
          "action": {
            "type": "string",
            "title": "Action"
          },
          "doc_id": {
            "type": "string",
            "title": "Doc Id"
          },
          "message": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Message"
          }
        },
        "type": "object",
        "required": [
          "status",
          "action",
          "doc_id"
        ],
        "title": "ActionResponse",
        "description": "Response for quick actions."
      },
      "app__routers__search__ExplainResponse": {
        "properties": {
          "id": {
            "type": "string",
            "title": "Id"
          },
          "reason": {
            "type": "string",
            "title": "Reason"
          },
          "evidence": {
            "additionalProperties": true,
            "type": "object",
            "title": "Evidence"
          }
        },
        "type": "object",
        "required": [
          "id",
          "reason",
          "evidence"
        ],
        "title": "ExplainResponse",
        "description": "Explanation of why an email was categorized."
      }
    }
  }
}
